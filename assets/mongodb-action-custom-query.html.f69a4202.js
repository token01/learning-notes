import{_ as a}from"./_plugin-vue_export-helper.cdc0426e.js";import{o as t,c as e,a as n,b as p,d as o,f as c,r as i}from"./app.59d8da70.js";const l={},u=c(`<h1 id="spring-data-mongodb\u7684\u81EA\u5B9A\u4E49query\u67E5\u8BE2" tabindex="-1"><a class="header-anchor" href="#spring-data-mongodb\u7684\u81EA\u5B9A\u4E49query\u67E5\u8BE2" aria-hidden="true">#</a> spring-data-mongodb\u7684\u81EA\u5B9A\u4E49Query\u67E5\u8BE2</h1><h2 id="_1-\u80CC\u666F" tabindex="-1"><a class="header-anchor" href="#_1-\u80CC\u666F" aria-hidden="true">#</a> 1. \u80CC\u666F</h2><p>\u6211\u4EECspring-data-mongodb \u9ED8\u8BA4\u7684 <code>MongoRepository</code>\u63A5\u53E3\u53EA\u80FD\u5B9E\u73B0\u4E00\u4E9B\u7B80\u5355\u7684\u56FA\u5B9A\u67E5\u8BE2\u3002\u5982\u679C\u9047\u5230\u590D\u6742\u7684\u60C5\u51B5\u5B8C\u5168\u5E94\u4ED8\u4E0D\u8FC7\u6765\u3002</p><h3 id="_1-1-\u573A\u666F\u9700\u6C42" tabindex="-1"><a class="header-anchor" href="#_1-1-\u573A\u666F\u9700\u6C42" aria-hidden="true">#</a> 1.1 \u573A\u666F\u9700\u6C42</h3><p>\u4F8B\u5982\uFF1A\u6211\u4EEC\u8981\u67E5\u8BE2\u7528\u6237\u7684\u9700\u6C42</p><ol><li>\u9ED8\u8BA4\u67E5\u8BE2\u6240\u6709\u7528\u6237</li><li>\u53EF\u4EE5\u6839\u636E\u7528\u6237\u540D\u6A21\u7CCA\u67E5\u8BE2</li><li>\u6839\u636E\u90E8\u95E8\u3001\u7528\u6237\u72B6\u6001\u67E5\u8BE2</li></ol><p>\u8FD9\u51E0\u79CD\u60C5\u51B5\uFF0C\u53EF\u80FD\u53EA\u6267\u884C\u4E00\u79CD\uFF0C\u6216\u8981\u7EC4\u5408\u5176\u4ED6\u51E0\u79CD\u3002</p><p>\u5E38\u7528\u7684MongoRepository \u7684\u5B9E\u73B0\u5982\u4E0B</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * \u67E5\u8BE2\u7528\u6237
 * <span class="token keyword">@author</span> zsz
 * <span class="token keyword">@date</span> 2021-16-16
 */</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserRepository</span> <span class="token keyword">extends</span> <span class="token class-name">MongoRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token doc-comment comment">/**
     * \u6839\u636E\u7528\u6237\u540D\u6A21\u7CCA\u67E5\u8BE2\u7528\u6237(\u65B9\u5F0F\u4E00)
     * <span class="token keyword">@param</span> <span class="token parameter">username</span>
     * <span class="token keyword">@param</span> <span class="token parameter">pageable</span>
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">findByUsernameLike</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">,</span> <span class="token class-name">Pageable</span> pageable<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * \u4F7F\u7528\u6B63\u5219\u8868\u8FBE\u5F0F\u6A21\u7CCA\u67E5\u8BE2\uFF08\u65B9\u5F0F\u4E8C\uFF09
     */</span>
    <span class="token annotation punctuation">@Query</span><span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token string">&quot; { &#39;username&#39;: ?#{ ([0].username == null) or ([0].username.length() == 0)  ? {$exists:true} : {$regex: [0].username } } } &quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">selectUserByUsernameLike2</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">,</span> <span class="token class-name">Pageable</span> pageable<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>\u65B9\u5F0F\u4E00\u7F3A\u70B9\uFF1A <ul><li>\u91C7\u7528\u81EA\u5E26\u7684\u5B9E\u73B0\u8BED\u53E5\u975E\u5E38\u56FA\u5B9A\uFF0C\u7F3A\u4E4F\u7075\u6D3B</li><li>\u65E0\u6CD5\u6EE1\u8DB3\u591A\u4E2A\u6761\u4EF6\u7B5B\u9009\uFF08\u65B9\u6CD5\u540D\u5C06\u4F1A\u975E\u5E38\u957F\uFF09</li><li>\u5982\u679C\u4E0D\u9700\u8981\u8FC7\u6EE4\u67D0\u4E2A\u53C2\u6570\uFF0C\u53EF\u80FD\u8FD8\u4F1A\u5BFC\u81F4\u62A5\u9519</li></ul></li><li>\u65B9\u5F0F\u4E8C\u7F3A\u70B9\uFF1A <ul><li>\u8FC7\u6EE4\u592A\u590D\u6742\uFF0C\u4E14\u9EBB\u70E6\u3002</li><li>\u53EF\u8BFB\u6027\u8FD8\u5DEE</li></ul></li></ul><p>\u6211\u4EEC\u8FD8\u662F\u63A8\u8350\u4F7F\u7528\u5B9E\u73B0\u81EA\u5B9A\u4E49\u67E5\u8BE2</p><h2 id="_2-\u6570\u636E\u51C6\u5907" tabindex="-1"><a class="header-anchor" href="#_2-\u6570\u636E\u51C6\u5907" aria-hidden="true">#</a> 2. \u6570\u636E\u51C6\u5907</h2><h3 id="_2-1-\u6784\u5EFA\u7528\u6237domain" tabindex="-1"><a class="header-anchor" href="#_2-1-\u6784\u5EFA\u7528\u6237domain" aria-hidden="true">#</a> 2.1 \u6784\u5EFA\u7528\u6237domain</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@Accessors</span><span class="token punctuation">(</span>chain <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Document</span><span class="token punctuation">(</span>collection <span class="token operator">=</span> <span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> serialVersionUID <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">7229906944062898852L</span><span class="token punctuation">;</span>

    <span class="token doc-comment comment">/** ID */</span>
    <span class="token annotation punctuation">@Id</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> _id<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/** \u7528\u6237\u540D */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> username<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/** \u5E74\u9F84 */</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> age<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/** \u6CE8\u518C\u65F6\u95F4 */</span>
    <span class="token keyword">private</span> <span class="token class-name">Date</span> registerTime<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-2-\u5B9E\u73B0mongorepository" tabindex="-1"><a class="header-anchor" href="#_2-2-\u5B9E\u73B0mongorepository" aria-hidden="true">#</a> 2.2 \u5B9E\u73B0MongoRepository</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserRepository</span> <span class="token keyword">extends</span> <span class="token class-name">MongoRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-3-\u521D\u59CB\u5316\u6570\u636E\u4E0Econtroller" tabindex="-1"><a class="header-anchor" href="#_2-3-\u521D\u59CB\u5316\u6570\u636E\u4E0Econtroller" aria-hidden="true">#</a> 2.3 \u521D\u59CB\u5316\u6570\u636E\u4E0Econtroller</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/user&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">UserRepository</span> userRepository<span class="token punctuation">;</span>

      <span class="token annotation punctuation">@PostConstruct</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> all <span class="token operator">=</span> userRepository<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>all<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        userRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">&quot;\u5F20\u4E09&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAge</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setRegisterTime</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> users <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">User</span> u0 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">&quot;\u5F20\u4E09&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAge</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setRegisterTime</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">User</span> u1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">&quot;\u674E\u56DB&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAge</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setRegisterTime</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">User</span> u2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">&quot;\u738B\u4E94&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAge</span><span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setRegisterTime</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">User</span> u3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">&quot;\u8D75\u516D&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAge</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setRegisterTime</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        users<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>u0<span class="token punctuation">)</span><span class="token punctuation">;</span>
        users<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>u1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        users<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>u2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        users<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>u3<span class="token punctuation">)</span><span class="token punctuation">;</span>
        userRepository<span class="token punctuation">.</span><span class="token function">saveAll</span><span class="token punctuation">(</span>users<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;\u67E5\u8BE2\u7528\u6237\u5217\u8868\u5217\u8868&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/list&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">Pageable</span> pageable <span class="token operator">=</span>  <span class="token class-name">PageRequest</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> userRepository<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span>pageable<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> list<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6709\u4E24\u4E2A\u5F20\u4E09\uFF0C\u4E00\u4E2A20\u5C81\u7684\u5E74\u8F7B\u5C0F\u4F19\u5F20\u4E09\uFF0C\u4E00\u4E2A80\u5C81\u7684\u5927\u7237\u5F20\u4E09</p><h2 id="_3-\u5B9E\u73B0\u81EA\u5B9A\u4E49\u67E5\u8BE2-\u590D\u6742\u573A\u666F" tabindex="-1"><a class="header-anchor" href="#_3-\u5B9E\u73B0\u81EA\u5B9A\u4E49\u67E5\u8BE2-\u590D\u6742\u573A\u666F" aria-hidden="true">#</a> 3. \u5B9E\u73B0\u81EA\u5B9A\u4E49\u67E5\u8BE2\uFF08\u590D\u6742\u573A\u666F\uFF09</h2><h3 id="_3-1-\u521B\u5EFA\u63A5\u53E3" tabindex="-1"><a class="header-anchor" href="#_3-1-\u521B\u5EFA\u63A5\u53E3" aria-hidden="true">#</a> 3.1 \u521B\u5EFA\u63A5\u53E3</h3><ul><li><p>\u5728\u539F\u6709UserRepository \u57FA\u7840\u4E0A\uFF0C\u5199\u81EA\u5DF1\u9700\u8981\u5B9E\u73B0\u7684\u65B9\u6CD5\u3002\u5728\u540E\u7EED\u7684Impl\u4E2D\u53BB\u5B9E\u73B0\u3002</p><blockquote><p>\u6CE8\uFF1A\u5177\u4F53\u5B9E\u73B0\u4E2D\u662F\u6CA1\u6709\u7EE7\u627F\u6216\u5B9E\u73B0UserRepository \u63A5\u53E3\u7684\uFF0C\u4F1A\u6BD4\u8F83\u5947\u602A\u3002\u53EF\u4EE5\u4F7F\u7528 @see \u5199\u4E0A\u5177\u4F53\u5728\u54EA\u5B9E\u73B0\uFF0C\u65B9\u4FBF\u540E\u9762\u67E5\u770B</p></blockquote></li></ul><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserRepository</span> <span class="token keyword">extends</span> <span class="token class-name">MongoRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    
    <span class="token doc-comment comment">/**
     * \u67E5\u8BE2\u7528\u6237\u5217\u8868
     * <span class="token keyword">@see</span> <span class="token reference"><span class="token class-name">UserRepositoryImpl</span><span class="token punctuation">#</span><span class="token field">selectUserList</span></span>
     * <span class="token keyword">@param</span> <span class="token parameter">user</span> \u7528\u6237
     * <span class="token keyword">@return</span> \u7528\u6237\u96C6\u5408
     */</span>
    <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">selectUserList</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">,</span> <span class="token class-name">Pageable</span> pageable<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-2-\u521B\u5EFA\u5B9E\u73B0\u7C7B-\u547D\u540D\u4E0E\u63A5\u53E3\u540D\u4E00\u81F4-\u4E14\u4EE5impl\u7ED3\u5C3E" tabindex="-1"><a class="header-anchor" href="#_3-2-\u521B\u5EFA\u5B9E\u73B0\u7C7B-\u547D\u540D\u4E0E\u63A5\u53E3\u540D\u4E00\u81F4-\u4E14\u4EE5impl\u7ED3\u5C3E" aria-hidden="true">#</a> 3.2 \u521B\u5EFA\u5B9E\u73B0\u7C7B \uFF08\u547D\u540D\u4E0E\u63A5\u53E3\u540D\u4E00\u81F4\uFF0C\u4E14\u4EE5Impl\u7ED3\u5C3E\uFF09</h3><ul><li>\u5728\u5B9E\u73B0\u7C7B\u4E2D\u5B9E\u73B0\u65B9\u6CD5\uFF0C \u53EF\u4EE5\u4F7F\u7528MongoTemplate \u6216 \u5176\u4ED6\u6570\u636E\u6E90\u7684\u6A21\u677F</li><li>\u4E0D\u5199@Component \u4E5F\u662F\u53EF\u4EE5\u7684</li></ul><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>public class UserRepositoryImpl {

    @Autowired
    protected MongoTemplate mongoTemplate;

    /**
     * \u67E5\u8BE2\u7528\u6237\u5217\u8868
     *
     * @param user \u67E5\u8BE2\u7528\u6237\u6761\u4EF6
     * @return \u7528\u6237\u96C6\u5408
     */
    public Page&lt;User&gt; selectUserList(User user, Pageable pageable) {
        Query query = new Query();
        Criteria criteria = new Criteria();
        List&lt;Criteria&gt; criteriaList = new ArrayList&lt;&gt;();

        if (StringUtils.isNotBlank(user.getUsername())) {
            Criteria usernameCriteria = Criteria.where(&quot;username&quot;).regex(user.getUsername());
            criteriaList.add(usernameCriteria);
        }
        if (user.getAge() != null) {
            Criteria ageCriteria = new Criteria();
            ageCriteria.and(&quot;age&quot;).is(user.getAge());
            criteriaList.add(ageCriteria);
        }
        if (criteriaList.size() &gt; 0) {
            criteria.andOperator(criteriaList);
        }

        query.addCriteria(criteria);
        // \u5206\u9875 \u548C \u6392\u5E8F
        query.with(pageable);
        query.with(Sort.by(Sort.Direction.DESC, &quot;registerTime&quot;));

        long totoal = this.mongoTemplate.count(query, User.class);

        log.debug(&quot;\u67E5\u8BE2\u7EDF\u8BA1\u603B\u6761\u6570 :&quot; + totoal);


        List&lt;User&gt; res = this.mongoTemplate.find(query, User.class);

        log.debug(&quot;\u67E5\u8BE2\u7ED3\u675F\uFF1A&quot; + res.size());

        return new PageImpl&lt;User&gt;(res, pageable, totoal);
    }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_4-\u81EA\u5B9A\u4E49query-\u57FA\u672C\u7528\u6CD5" tabindex="-1"><a class="header-anchor" href="#_4-\u81EA\u5B9A\u4E49query-\u57FA\u672C\u7528\u6CD5" aria-hidden="true">#</a> 4. \u81EA\u5B9A\u4E49Query \u57FA\u672C\u7528\u6CD5</h2><h3 id="_4-1-\u6839\u636E\u5B57\u6BB5\u8FDB\u884C\u5168\u5339\u914D\u67E5\u8BE2" tabindex="-1"><a class="header-anchor" href="#_4-1-\u6839\u636E\u5B57\u6BB5\u8FDB\u884C\u5168\u5339\u914D\u67E5\u8BE2" aria-hidden="true">#</a> 4.1. \u6839\u636E\u5B57\u6BB5\u8FDB\u884C\u5168\u5339\u914D\u67E5\u8BE2</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * \u5168\u5339\u914D\u67E5\u8BE2
 */</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">fullMatchingQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Query</span> query <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Query</span><span class="token punctuation">(</span><span class="token class-name">Criteria</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">is</span><span class="token punctuation">(</span><span class="token string">&quot;\u5F20\u4E09&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// \u67E5\u8BE2\u4E00\u6761\u6EE1\u8DB3\u6761\u4EF6\u7684\u6570\u636E</span>
    <span class="token class-name">User</span> result <span class="token operator">=</span> mongoTemplate<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> <span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u67E5\u8BE2\u8BED\u53E5: &quot;</span> <span class="token operator">+</span> query <span class="token operator">+</span> <span class="token string">&quot; | \u67E5\u8BE2\u4E00\u6761\u6570\u636E: &quot;</span> <span class="token operator">+</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u6EE1\u8DB3\u6240\u6709\u6761\u4EF6\u7684\u6570\u636E</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> ans <span class="token operator">=</span> mongoTemplate<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> <span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u67E5\u8BE2\u8BED\u53E5: &quot;</span> <span class="token operator">+</span> query <span class="token operator">+</span> <span class="token string">&quot; | \u67E5\u8BE2\u6240\u6709: &quot;</span> <span class="token operator">+</span> ans<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>Criteria.where(xxx).is(xxx)</code>\u6765\u6307\u5B9A\u5177\u4F53\u7684\u67E5\u8BE2\u6761\u4EF6</li><li>\u5C01\u88C5Query\u5BF9\u8C61 <code>new Query(criteria)</code></li><li>\u501F\u52A9<code>mongoTemplate</code>\u6267\u884C\u67E5\u8BE2 <code>mongoTemplate.findOne(query, resultType, collectionName)</code></li></ul><p>\u8F93\u51FA\u7ED3\u679C\uFF1A</p><p>\u6709\u4E24\u4E2A\u5F20\u4E09\uFF0C\u4E00\u4E2A20\u5C81\u7684\u5E74\u8F7B\u5C0F\u4F19\u5F20\u4E09\uFF0C\u4E00\u4E2A80\u5C81\u7684\u5927\u7237\u5F20\u4E09</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>\u67E5\u8BE2\u8BED\u53E5: Query: { &quot;username&quot; : &quot;\u5F20\u4E09&quot;}, Fields: {}, Sort: {} | \u67E5\u8BE2\u4E00\u6761\u6570\u636E: User(_id=61bdbf83b9b3e519516eac0f, username=\u5F20\u4E09, age=20, registerTime=Sat Dec 18 19:01:23 CST 2021)

\u67E5\u8BE2\u8BED\u53E5: Query: { &quot;username&quot; : &quot;\u5F20\u4E09&quot;}, Fields: {}, Sort: {} | \u67E5\u8BE2\u6240\u6709: [User(_id=61bdbf83b9b3e519516eac0f, username=\u5F20\u4E09, age=20, registerTime=Sat Dec 18 19:01:23 CST 2021), User(_id=61bdbf83b9b3e519516eac10, username=\u5F20\u4E09, age=80, registerTime=Sat Dec 18 19:01:23 CST 2021)]

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-2-and\u591A\u6761\u4EF6\u67E5\u8BE2" tabindex="-1"><a class="header-anchor" href="#_4-2-and\u591A\u6761\u4EF6\u67E5\u8BE2" aria-hidden="true">#</a> 4.2 and\u591A\u6761\u4EF6\u67E5\u8BE2</h3><p>\u524D\u9762\u662F\u53EA\u6709\u4E00\u4E2A\u6761\u4EF6\u6EE1\u8DB3\uFF0C\u73B0\u5728\u5982\u679C\u662F\u8981\u6C42\u540C\u65F6\u6EE1\u8DB3\u591A\u4E2A\u6761\u4EF6\uFF0C\u5219\u5229\u7528<code>org.springframework.data.mongodb.core.query.Criteria#and</code>\u6765\u659C\u8857\u591A\u4E2A\u67E5\u8BE2\u6761\u4EF6</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>  <span class="token doc-comment comment">/**
     * \u591A\u4E2A\u67E5\u8BE2\u6761\u4EF6\u540C\u65F6\u6EE1\u8DB3
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">andQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Query</span> query <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Criteria</span> criteria <span class="token operator">=</span> <span class="token class-name">Criteria</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">is</span><span class="token punctuation">(</span><span class="token string">&quot;\u5F20\u4E09&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">is</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        query<span class="token punctuation">.</span><span class="token function">addCriteria</span><span class="token punctuation">(</span>criteria<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">User</span> result <span class="token operator">=</span> mongoTemplate<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> <span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u67E5\u8BE2\u8BED\u53E5: &quot;</span> <span class="token operator">+</span> query <span class="token operator">+</span> <span class="token string">&quot; \\n \u591A\u4E2A\u67E5\u8BE2\u6761\u4EF6\u540C\u65F6\u6EE1\u8DB3: &quot;</span> <span class="token operator">+</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8F93\u51FA\u7ED3\u679C</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>\u67E5\u8BE2\u8BED\u53E5: Query: { &quot;username&quot; : &quot;\u5F20\u4E09&quot;, &quot;age&quot; : 20}, Fields: {}, Sort: {} 
 \u591A\u4E2A\u67E5\u8BE2\u6761\u4EF6\u540C\u65F6\u6EE1\u8DB3: User(_id=61bdbf83b9b3e519516eac0f, username=\u5F20\u4E09, age=20, registerTime=Sat Dec 18 19:01:23 CST 2021)

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-3-or\u6216\u67E5\u8BE2" tabindex="-1"><a class="header-anchor" href="#_4-3-or\u6216\u67E5\u8BE2" aria-hidden="true">#</a> 4.3 or\u6216\u67E5\u8BE2</h3><p>and\u5BF9\u5E94\u7684\u5C31\u662For\uFF0C\u591A\u4E2A\u6761\u4EF6\u4E2D\u53EA\u8981\u4E00\u4E2A\u6EE1\u8DB3\u5373\u53EF\uFF0C\u8FD9\u4E2A\u4E0Eand\u7684\u4F7F\u7528\u6709\u4E9B\u533A\u522B, \u501F\u52A9<code>org.springframework.data.mongodb.core.query.Criteria#orOperator</code>\u6765\u5B9E\u73B0\uFF0C\u4F20\u53C2\u4E3A\u591A\u4E2A<code>Criteria</code>\u5BF9\u8C61\uFF0C\u5176\u4E2D\u6BCF\u4E00\u4E2A\u8868\u793A\u4E00\u79CD\u67E5\u8BE2\u6761\u4EF6</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * \u6216\u67E5\u8BE2
 */</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">orQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u7B49\u540C\u4E8E db.getCollection(&#39;demo&#39;).find({&quot;username&quot;: &quot;\u5F20\u4E09&quot;, $or: [{ &quot;age&quot;: 20}, { &quot;sign&quot;: {$exists: true}}]})</span>
    <span class="token class-name">Query</span> query <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Query</span><span class="token punctuation">(</span><span class="token class-name">Criteria</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">is</span><span class="token punctuation">(</span><span class="token string">&quot;\u5F20\u4E09&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">orOperator</span><span class="token punctuation">(</span><span class="token class-name">Criteria</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">is</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Criteria</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&quot;sign&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> mongoTemplate<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> <span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;query: &quot;</span> <span class="token operator">+</span> query <span class="token operator">+</span> <span class="token string">&quot; \\n \u5305\u542Band\u7684\u6216\u67E5\u8BE2: &quot;</span> <span class="token operator">+</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u5355\u72EC\u7684or\u67E5\u8BE2</span>
    <span class="token comment">// \u7B49\u540C\u4E8EQuery: { &quot;$or&quot; : [{ &quot;age&quot; : 18 }, { &quot;sign&quot; : { &quot;$exists&quot; : true } }] }, Fields: { }, Sort: { }</span>
    query <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Query</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Criteria</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">orOperator</span><span class="token punctuation">(</span><span class="token class-name">Criteria</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">is</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Criteria</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&quot;sign&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    result <span class="token operator">=</span> mongoTemplate<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> <span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;query: &quot;</span> <span class="token operator">+</span> query <span class="token operator">+</span> <span class="token string">&quot; \\n \u5355\u72EC\u7684or\u67E5\u8BE2: &quot;</span> <span class="token operator">+</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8F93\u51FA\u7ED3\u679C\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>query: Query: { &quot;username&quot; : &quot;\u5F20\u4E09&quot;, &quot;$or&quot; : [{ &quot;age&quot; : 20}, { &quot;sign&quot; : { &quot;$exists&quot; : true}}]}, Fields: {}, Sort: {} 
 \u5305\u542Band\u7684\u6216\u67E5\u8BE2: [User(_id=61bdc39756a94a3a56b958f9, username=\u5F20\u4E09, age=20, sign=null, registerTime=Sat Dec 18 19:18:47 CST 2021), User(_id=61bdc39756a94a3a56b958fa, username=\u5F20\u4E09, age=80, sign=\u6CD5\u5916\u72C2\u5F92, registerTime=Sat Dec 18 19:18:47 CST 2021)]
query: Query: { &quot;$or&quot; : [{ &quot;age&quot; : 18}, { &quot;sign&quot; : { &quot;$exists&quot; : true}}]}, Fields: {}, Sort: {} 
 \u5355\u72EC\u7684or\u67E5\u8BE2: [User(_id=61bdc39756a94a3a56b958fa, username=\u5F20\u4E09, age=80, sign=\u6CD5\u5916\u72C2\u5F92, registerTime=Sat Dec 18 19:18:47 CST 2021)]

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-4-in\u67E5\u8BE2" tabindex="-1"><a class="header-anchor" href="#_4-4-in\u67E5\u8BE2" aria-hidden="true">#</a> 4.4 in\u67E5\u8BE2</h3><p>\u6807\u51C6\u7684in\u67E5\u8BE2case</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>
    <span class="token doc-comment comment">/**
     * in\u67E5\u8BE2
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">inQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u76F8\u5F53\u4E8E:</span>
        <span class="token class-name">Query</span> query <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Query</span><span class="token punctuation">(</span><span class="token class-name">Criteria</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">in</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> mongoTemplate<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> <span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;query: &quot;</span> <span class="token operator">+</span> query <span class="token operator">+</span> <span class="token string">&quot;\\n in\u67E5\u8BE2: &quot;</span> <span class="token operator">+</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8F93\u51FA\u7ED3\u679C</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>query: Query: { &quot;age&quot; : { &quot;$in&quot; : [18, 20, 30]}}, Fields: {}, Sort: {}
 in\u67E5\u8BE2: [User(_id=61bdc39756a94a3a56b958f9, username=\u5F20\u4E09, age=20, sign=null, registerTime=Sat Dec 18 19:18:47 CST 2021), User(_id=61bdc39756a94a3a56b958fb, username=\u674E\u56DB, age=30, sign=null, registerTime=Sat Dec 18 19:18:47 CST 2021)]

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-5-\u6570\u503C\u6BD4\u8F83" tabindex="-1"><a class="header-anchor" href="#_4-5-\u6570\u503C\u6BD4\u8F83" aria-hidden="true">#</a> 4.5 \u6570\u503C\u6BD4\u8F83</h3><p>\u6570\u503C\u7684\u6BD4\u8F83\u5927\u5C0F\uFF0C\u4E3B\u8981\u4F7F\u7528\u7684\u662F <code>get</code>, <code>gt</code>, <code>lt</code>, <code>let</code></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code> <span class="token doc-comment comment">/**
     * \u6570\u5B57\u7C7B\u578B\uFF0C\u6BD4\u8F83\u67E5\u8BE2 &gt;
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">compareBigQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// age &gt; 30</span>
        <span class="token class-name">Query</span> query <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Query</span><span class="token punctuation">(</span><span class="token class-name">Criteria</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">gt</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> mongoTemplate<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> <span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;query: &quot;</span> <span class="token operator">+</span> query <span class="token operator">+</span> <span class="token string">&quot;\\n \u6570\u5B57\u7C7B\u578B\uFF0C\u6BD4\u8F83\u67E5\u8BE2 &gt;: &quot;</span> <span class="token operator">+</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// age &gt;= 30</span>
        query <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Query</span><span class="token punctuation">(</span><span class="token class-name">Criteria</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">gte</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        result <span class="token operator">=</span> mongoTemplate<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> <span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;query: &quot;</span> <span class="token operator">+</span> query <span class="token operator">+</span> <span class="token string">&quot;\\n \u6570\u5B57\u7C7B\u578B\uFF0C\u6BD4\u8F83\u67E5\u8BE2 &gt; &quot;</span> <span class="token operator">+</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * \u6570\u5B57\u7C7B\u578B\uFF0C\u6BD4\u8F83\u67E5\u8BE2 &lt;
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">compareSmallQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// age &lt; 30</span>
        <span class="token class-name">Query</span> query <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Query</span><span class="token punctuation">(</span><span class="token class-name">Criteria</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lt</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> mongoTemplate<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> <span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;query: &quot;</span> <span class="token operator">+</span> query <span class="token operator">+</span> <span class="token string">&quot;\\n \u6570\u5B57\u7C7B\u578B\uFF0C\u6BD4\u8F83\u67E5\u8BE2 &lt;: &quot;</span> <span class="token operator">+</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// age &lt;= 30</span>
        query <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Query</span><span class="token punctuation">(</span><span class="token class-name">Criteria</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lte</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        result <span class="token operator">=</span> mongoTemplate<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> <span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;query: &quot;</span> <span class="token operator">+</span> query <span class="token operator">+</span> <span class="token string">&quot; \\n \u6570\u5B57\u7C7B\u578B\uFF0C\u6BD4\u8F83\u67E5\u8BE2 &lt;=: &quot;</span> <span class="token operator">+</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8F93\u51FA\u7ED3\u679C</p><p>\u6570\u5B57\u7C7B\u578B\uFF0C\u6BD4\u8F83\u67E5\u8BE2 &gt;</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>query: Query: { &quot;age&quot; : { &quot;$gt&quot; : 30}}, Fields: {}, Sort: {}
 \u6570\u5B57\u7C7B\u578B\uFF0C\u6BD4\u8F83\u67E5\u8BE2 &gt;: [User(_id=61bdc39756a94a3a56b958fa, username=\u5F20\u4E09, age=80, sign=\u6CD5\u5916\u72C2\u5F92, registerTime=Sat Dec 18 19:18:47 CST 2021), User(_id=61bdc39756a94a3a56b958fc, username=\u738B\u4E94, age=40, sign=null, registerTime=Sat Dec 18 19:18:47 CST 2021), User(_id=61bdc39756a94a3a56b958fd, username=\u8D75\u516D, age=50, sign=null, registerTime=Sat Dec 18 19:18:47 CST 2021)]
query: Query: { &quot;age&quot; : { &quot;$gte&quot; : 30}}, Fields: {}, Sort: {}
 
 \u6570\u5B57\u7C7B\u578B\uFF0C\u6BD4\u8F83\u67E5\u8BE2 &gt;= [User(_id=61bdc39756a94a3a56b958fa, username=\u5F20\u4E09, age=80, sign=\u6CD5\u5916\u72C2\u5F92, registerTime=Sat Dec 18 19:18:47 CST 2021), User(_id=61bdc39756a94a3a56b958fb, username=\u674E\u56DB, age=30, sign=null, registerTime=Sat Dec 18 19:18:47 CST 2021), User(_id=61bdc39756a94a3a56b958fc, username=\u738B\u4E94, age=40, sign=null, registerTime=Sat Dec 18 19:18:47 CST 2021), User(_id=61bdc39756a94a3a56b958fd, username=\u8D75\u516D, age=50, sign=null, registerTime=Sat Dec 18 19:18:47 CST 2021)]

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6570\u5B57\u7C7B\u578B\uFF0C\u6BD4\u8F83\u67E5\u8BE2 &lt;</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>query: Query: { &quot;age&quot; : { &quot;$lt&quot; : 30}}, Fields: {}, Sort: {}
 \u6570\u5B57\u7C7B\u578B\uFF0C\u6BD4\u8F83\u67E5\u8BE2 &lt;: [User(_id=61bdc39756a94a3a56b958f9, username=\u5F20\u4E09, age=20, sign=null, registerTime=Sat Dec 18 19:18:47 CST 2021)]
query: Query: { &quot;age&quot; : { &quot;$lte&quot; : 30}}, Fields: {}, Sort: {} 
 \u6570\u5B57\u7C7B\u578B\uFF0C\u6BD4\u8F83\u67E5\u8BE2 &lt;=: [User(_id=61bdc39756a94a3a56b958f9, username=\u5F20\u4E09, age=20, sign=null, registerTime=Sat Dec 18 19:18:47 CST 2021), User(_id=61bdc39756a94a3a56b958fb, username=\u674E\u56DB, age=30, sign=null, registerTime=Sat Dec 18 19:18:47 CST 2021)]

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-6-\u6B63\u5219\u67E5\u8BE2" tabindex="-1"><a class="header-anchor" href="#_4-6-\u6B63\u5219\u67E5\u8BE2" aria-hidden="true">#</a> 4.6 \u6B63\u5219\u67E5\u8BE2</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * \u6B63\u5219\u67E5\u8BE2
 */</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">regexQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Query</span> query <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Query</span><span class="token punctuation">(</span><span class="token class-name">Criteria</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">regex</span><span class="token punctuation">(</span><span class="token string">&quot;.\u56DB&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> mongoTemplate<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> <span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;query: &quot;</span> <span class="token operator">+</span> query <span class="token operator">+</span> <span class="token string">&quot; \\n \u6B63\u5219\u67E5\u8BE2: &quot;</span> <span class="token operator">+</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8F93\u51FA\u7ED3\u679C</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>query: Query: { &quot;username&quot; : { &quot;$regularExpression&quot; : { &quot;pattern&quot; : &quot;.\u56DB&quot;, &quot;options&quot; : &quot;&quot;}}}, Fields: {}, Sort: {} 

 \u6B63\u5219\u67E5\u8BE2: [User(_id=61bdc39756a94a3a56b958fb, username=\u674E\u56DB, age=30, sign=null, registerTime=Sat Dec 18 19:18:47 CST 2021)]

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-7-\u67E5\u8BE2\u603B\u6570" tabindex="-1"><a class="header-anchor" href="#_4-7-\u67E5\u8BE2\u603B\u6570" aria-hidden="true">#</a> 4.7 \u67E5\u8BE2\u603B\u6570</h3><p>\u7EDF\u8BA1\u5E38\u7528\uFF0C\u8FD9\u4E2A\u4E3B\u8981\u5229\u7528\u7684\u662F<code>mongoTemplate.count</code>\u65B9\u6CD5</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>   <span class="token doc-comment comment">/**
     * \u67E5\u8BE2\u603B\u6570
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">countQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Query</span> query <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Query</span><span class="token punctuation">(</span><span class="token class-name">Criteria</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">is</span><span class="token punctuation">(</span><span class="token string">&quot;\u5F20\u4E09&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">long</span> cnt <span class="token operator">=</span> mongoTemplate<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span><span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;query: &quot;</span> <span class="token operator">+</span> query <span class="token operator">+</span> <span class="token string">&quot;\\n \u67E5\u8BE2\u603B\u6570 &quot;</span> <span class="token operator">+</span> cnt<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8F93\u51FA\u7ED3\u679C</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>query: Query: { &quot;username&quot; : &quot;\u5F20\u4E09&quot;}, Fields: {}, Sort: {}
 \u67E5\u8BE2\u603B\u6570 2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-8-\u5206\u7EC4\u67E5\u8BE2" tabindex="-1"><a class="header-anchor" href="#_4-8-\u5206\u7EC4\u67E5\u8BE2" aria-hidden="true">#</a> 4.8 \u5206\u7EC4\u67E5\u8BE2</h3><p>\u8FD9\u4E2A\u5BF9\u5E94\u7684\u662Fmysql\u4E2D\u7684group\u67E5\u8BE2\uFF0C\u4F46\u662F\u5728mongodb\u4E2D\uFF0C\u66F4\u591A\u7684\u662F\u901A\u8FC7\u805A\u5408\u67E5\u8BE2\uFF0C\u53EF\u4EE5\u5B8C\u6210\u5F88\u591A\u7C7B\u4F3C\u7684\u64CD\u4F5C\uFF0C\u4E0B\u9762\u501F\u52A9\u805A\u5408\uFF0C\u6765\u770B\u4E00\u4E0B\u5206\u7EC4\u8BA1\u7B97\u603B\u6570\u600E\u4E48\u73A9</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * \u5206\u7EC4\u67E5\u8BE2
 */</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">groupQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u6839\u636E\u7528\u6237\u540D\u8FDB\u884C\u5206\u7EC4\u7EDF\u8BA1\uFF0C\u6BCF\u4E2A\u7528\u6237\u540D\u5BF9\u5E94\u7684\u6570\u91CF</span>
    <span class="token comment">// aggregate([ { &quot;$group&quot; : { &quot;_id&quot; : &quot;user&quot; , &quot;userCount&quot; : { &quot;$sum&quot; : 1}}}] )</span>
    <span class="token class-name">Aggregation</span> aggregation <span class="token operator">=</span> <span class="token class-name">Aggregation</span><span class="token punctuation">.</span><span class="token function">newAggregation</span><span class="token punctuation">(</span><span class="token class-name">Aggregation</span><span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">as</span><span class="token punctuation">(</span><span class="token string">&quot;userCount&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">AggregationResults</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map</span><span class="token punctuation">&gt;</span></span> ans <span class="token operator">=</span> mongoTemplate<span class="token punctuation">.</span><span class="token function">aggregate</span><span class="token punctuation">(</span>aggregation<span class="token punctuation">,</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">,</span>  <span class="token class-name">Map</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;query: &quot;</span> <span class="token operator">+</span> aggregation <span class="token operator">+</span> <span class="token string">&quot;\\n \u5206\u7EC4\u67E5\u8BE2 &quot;</span> <span class="token operator">+</span> ans<span class="token punctuation">.</span><span class="token function">getMappedResults</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8F93\u51FA\u7ED3\u679C</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>query: { &quot;aggregate&quot; : &quot;__collection__&quot;, &quot;pipeline&quot; : [{ &quot;$group&quot; : { &quot;_id&quot; : &quot;$username&quot;, &quot;userCount&quot; : { &quot;$sum&quot; : 1}}}]}
 
 \u5206\u7EC4\u67E5\u8BE2 [{_id=\u674E\u56DB, userCount=1}, {_id=\u5F20\u4E09, userCount=2}, {_id=\u738B\u4E94, userCount=1}, {_id=\u8D75\u516D, userCount=1}]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-9-\u6392\u5E8F" tabindex="-1"><a class="header-anchor" href="#_4-9-\u6392\u5E8F" aria-hidden="true">#</a> 4.9 \u6392\u5E8F</h3><p>sort\uFF0C\u6BD4\u8F83\u5E38\u89C1\u7684\u4E86\uFF0C\u5728mongodb\u4E2D\u6709\u4E2A\u6709\u610F\u601D\u7684\u5730\u65B9\u5728\u4E8E\u67D0\u4E2A\u5B57\u6BB5\uFF0Cdocument\u4E2D\u5E76\u4E0D\u4E00\u5B9A\u5B58\u5728\uFF0C\u8FD9\u662F\u4F1A\u600E\u6837\u5462\uFF1F</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * \u6392\u5E8F\u67E5\u8BE2
 */</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sortQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// sort\u67E5\u8BE2\u6761\u4EF6\uFF0C\u9700\u8981\u7528with\u6765\u8854\u63A5</span>
    <span class="token class-name">Query</span> query <span class="token operator">=</span> <span class="token class-name">Query</span><span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token class-name">Criteria</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">is</span><span class="token punctuation">(</span><span class="token string">&quot;\u5F20\u4E09&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">with</span><span class="token punctuation">(</span><span class="token class-name">Sort</span><span class="token punctuation">.</span><span class="token function">by</span><span class="token punctuation">(</span><span class="token class-name">Sort<span class="token punctuation">.</span>Direction</span><span class="token punctuation">.</span><span class="token constant">DESC</span><span class="token punctuation">,</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> mongoTemplate<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> <span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;query: &quot;</span> <span class="token operator">+</span> query <span class="token operator">+</span> <span class="token string">&quot;\\n \u6392\u5E8F\u67E5\u8BE2 &quot;</span> <span class="token operator">+</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8F93\u51FA\u7ED3\u679C</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>query: Query: { &quot;username&quot; : &quot;\u5F20\u4E09&quot;}, Fields: {}, Sort: { &quot;age&quot; : -1}
 \u6392\u5E8F\u67E5\u8BE2 [User(_id=61bdc39756a94a3a56b958fa, username=\u5F20\u4E09, age=80, sign=\u6CD5\u5916\u72C2\u5F92, registerTime=Sat Dec 18 19:18:47 CST 2021), User(_id=61bdc39756a94a3a56b958f9, username=\u5F20\u4E09, age=20, sign=null, registerTime=Sat Dec 18 19:18:47 CST 2021)]

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-10-\u5206\u9875" tabindex="-1"><a class="header-anchor" href="#_4-10-\u5206\u9875" aria-hidden="true">#</a> 4.10 \u5206\u9875</h3><p>\u6570\u636E\u91CF\u591A\u7684\u65F6\u5019\uFF0C\u5206\u9875\u67E5\u8BE2\u6BD4\u8F83\u5E38\u89C1\uFF0C\u7528\u5F97\u591A\u5C31\u662Flimit\u548Cskip\u4E86</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>
    <span class="token doc-comment comment">/**
     * \u5206\u9875\u67E5\u8BE2
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">pageQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// limit\u9650\u5B9A\u67E5\u8BE22\u6761</span>
        <span class="token class-name">Query</span> query <span class="token operator">=</span> <span class="token class-name">Query</span><span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token class-name">Criteria</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">is</span><span class="token punctuation">(</span><span class="token string">&quot;\u5F20\u4E09&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">with</span><span class="token punctuation">(</span><span class="token class-name">Sort</span><span class="token punctuation">.</span><span class="token function">by</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> mongoTemplate<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> <span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;query: &quot;</span> <span class="token operator">+</span> query <span class="token operator">+</span> <span class="token string">&quot; \\n\u5206\u9875\u67E5\u8BE2 &quot;</span> <span class="token operator">+</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>


        <span class="token comment">// skip()\u65B9\u6CD5\u6765\u8DF3\u8FC7\u6307\u5B9A\u6570\u91CF\u7684\u6570\u636E</span>
        query <span class="token operator">=</span> <span class="token class-name">Query</span><span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token class-name">Criteria</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">is</span><span class="token punctuation">(</span><span class="token string">&quot;\u5F20\u4E09&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">with</span><span class="token punctuation">(</span><span class="token class-name">Sort</span><span class="token punctuation">.</span><span class="token function">by</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">skip</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        result <span class="token operator">=</span> mongoTemplate<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> <span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;query: &quot;</span> <span class="token operator">+</span> query <span class="token operator">+</span> <span class="token string">&quot;\\n skip()\u65B9\u6CD5\u6765\u8DF3\u8FC7\u6307\u5B9A\u6570\u91CF\u7684\u6570\u636E &quot;</span> <span class="token operator">+</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8F93\u51FA\u7ED3\u679C</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>query: Query: { &quot;username&quot; : &quot;\u5F20\u4E09&quot;}, Fields: {}, Sort: { &quot;age&quot; : 1} 
\u5206\u9875\u67E5\u8BE2 [User(_id=61bdc39756a94a3a56b958f9, username=\u5F20\u4E09, age=20, sign=null, registerTime=Sat Dec 18 19:18:47 CST 2021), User(_id=61bdc39756a94a3a56b958fa, username=\u5F20\u4E09, age=80, sign=\u6CD5\u5916\u72C2\u5F92, registerTime=Sat Dec 18 19:18:47 CST 2021)]
query: Query: { &quot;username&quot; : &quot;\u5F20\u4E09&quot;}, Fields: {}, Sort: { &quot;age&quot; : 1}

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_5-\u7EFC\u5408\u5206\u9875\u67E5\u8BE2" tabindex="-1"><a class="header-anchor" href="#_5-\u7EFC\u5408\u5206\u9875\u67E5\u8BE2" aria-hidden="true">#</a> 5. \u7EFC\u5408\u5206\u9875\u67E5\u8BE2</h2><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code> <span class="token doc-comment comment">/**
     * \u67E5\u8BE2\u7528\u6237\u5217\u8868
     *
     * <span class="token keyword">@param</span> <span class="token parameter">user</span> \u67E5\u8BE2\u7528\u6237\u6761\u4EF6
     * <span class="token keyword">@return</span> \u7528\u6237\u96C6\u5408
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">selectUserList</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">,</span> <span class="token class-name">Pageable</span> pageable<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Query</span> query <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Criteria</span> criteria <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Criteria</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Criteria</span><span class="token punctuation">&gt;</span></span> criteriaList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isNotBlank</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Criteria</span> usernameCriteria <span class="token operator">=</span> <span class="token class-name">Criteria</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">regex</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            criteriaList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>usernameCriteria<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Criteria</span> ageCriteria <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Criteria</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            ageCriteria<span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">is</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            criteriaList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>ageCriteria<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>criteriaList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            criteria<span class="token punctuation">.</span><span class="token function">andOperator</span><span class="token punctuation">(</span>criteriaList<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        query<span class="token punctuation">.</span><span class="token function">addCriteria</span><span class="token punctuation">(</span>criteria<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u5206\u9875 \u548C \u6392\u5E8F</span>
        query<span class="token punctuation">.</span><span class="token keyword">with</span><span class="token punctuation">(</span>pageable<span class="token punctuation">)</span><span class="token punctuation">;</span>
        query<span class="token punctuation">.</span><span class="token keyword">with</span><span class="token punctuation">(</span><span class="token class-name">Sort</span><span class="token punctuation">.</span><span class="token function">by</span><span class="token punctuation">(</span><span class="token class-name">Sort<span class="token punctuation">.</span>Direction</span><span class="token punctuation">.</span><span class="token constant">DESC</span><span class="token punctuation">,</span> <span class="token string">&quot;registerTime&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">long</span> totoal <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>mongoTemplate<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> <span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;\u67E5\u8BE2\u7EDF\u8BA1\u603B\u6761\u6570 :&quot;</span> <span class="token operator">+</span> totoal<span class="token punctuation">)</span><span class="token punctuation">;</span>


        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> res <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>mongoTemplate<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> <span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;\u67E5\u8BE2\u7ED3\u675F\uFF1A&quot;</span> <span class="token operator">+</span> res<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">PageImpl</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> pageable<span class="token punctuation">,</span> totoal<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="\u53C2\u8003\u6587\u7AE0" tabindex="-1"><a class="header-anchor" href="#\u53C2\u8003\u6587\u7AE0" aria-hidden="true">#</a> \u53C2\u8003\u6587\u7AE0</h2>`,83),r={href:"https://spring.hhui.top/spring-blog/2019/01/13/190113-SpringBoot%E9%AB%98%E7%BA%A7%E7%AF%87MongoDB%E4%B9%8B%E6%9F%A5%E8%AF%A2%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8%E5%A7%BF%E5%8A%BF/#10-%E5%88%86%E9%A1%B5",target:"_blank",rel:"noopener noreferrer"};function k(d,m){const s=i("ExternalLinkIcon");return t(),e("div",null,[u,n("p",null,[n("a",r,[p("MongoDB\u4E4B\u67E5\u8BE2\u57FA\u672C\u4F7F\u7528\u59FF\u52BF"),o(s)])])])}const g=a(l,[["render",k],["__file","mongodb-action-custom-query.html.vue"]]);export{g as default};
