import{_ as a}from"./_plugin-vue_export-helper.cdc0426e.js";import{o as e,c as t,a as n,b as p,d as o,f as c,r as i}from"./app.f6fb4051.js";const l={},u=c(`<h1 id="spring\u5B9E\u6218-\u8FC7\u6EE4\u5668\u548C\u62E6\u622A\u5668\u533A\u522B" tabindex="-1"><a class="header-anchor" href="#spring\u5B9E\u6218-\u8FC7\u6EE4\u5668\u548C\u62E6\u622A\u5668\u533A\u522B" aria-hidden="true">#</a> Spring\u5B9E\u6218 - \u8FC7\u6EE4\u5668\u548C\u62E6\u622A\u5668\u533A\u522B</h1><h2 id="_1-\u57FA\u7840\u4F7F\u7528" tabindex="-1"><a class="header-anchor" href="#_1-\u57FA\u7840\u4F7F\u7528" aria-hidden="true">#</a> 1. \u57FA\u7840\u4F7F\u7528</h2><p>\u6211\u4EEC\u5728\u9879\u76EE\u4E2D\u540C\u65F6\u914D\u7F6E <code>\u62E6\u622A\u5668</code> \u548C <code>\u8FC7\u6EE4\u5668</code>\u3002</p><h3 id="_1-1-\u8FC7\u6EE4\u5668-filter" tabindex="-1"><a class="header-anchor" href="#_1-1-\u8FC7\u6EE4\u5668-filter" aria-hidden="true">#</a> 1.1 \u8FC7\u6EE4\u5668 (Filter)</h3><p>\u8FC7\u6EE4\u5668\u7684\u914D\u7F6E\u6BD4\u8F83\u7B80\u5355\uFF0C\u76F4\u63A5\u5B9E\u73B0<code>Filter</code> \u63A5\u53E3\u5373\u53EF\uFF0C\u4E5F\u53EF\u4EE5\u901A\u8FC7<code>@WebFilter</code>\u6CE8\u89E3\u5B9E\u73B0\u5BF9\u7279\u5B9A<code>URL</code>\u62E6\u622A\uFF0C\u770B\u5230<code>Filter</code> \u63A5\u53E3\u4E2D\u5B9A\u4E49\u4E86\u4E09\u4E2A\u65B9\u6CD5\u3002</p><ul><li><code>init()</code> \uFF1A\u8BE5\u65B9\u6CD5\u5728\u5BB9\u5668\u542F\u52A8\u521D\u59CB\u5316\u8FC7\u6EE4\u5668\u65F6\u88AB\u8C03\u7528\uFF0C\u5B83\u5728 <code>Filter</code> \u7684\u6574\u4E2A\u751F\u547D\u5468\u671F\u53EA\u4F1A\u88AB\u8C03\u7528\u4E00\u6B21\u3002<strong>\u6CE8\u610F</strong>\uFF1A\u8FD9\u4E2A\u65B9\u6CD5\u5FC5\u987B\u6267\u884C\u6210\u529F\uFF0C\u5426\u5219\u8FC7\u6EE4\u5668\u4F1A\u4E0D\u8D77\u4F5C\u7528\u3002</li><li><code>doFilter()</code> \uFF1A\u5BB9\u5668\u4E2D\u7684\u6BCF\u4E00\u6B21\u8BF7\u6C42\u90FD\u4F1A\u8C03\u7528\u8BE5\u65B9\u6CD5\uFF0C <code>FilterChain</code> \u7528\u6765\u8C03\u7528\u4E0B\u4E00\u4E2A\u8FC7\u6EE4\u5668 <code>Filter</code>\u3002</li><li><code>destroy()</code>\uFF1A \u5F53\u5BB9\u5668\u9500\u6BC1 \u8FC7\u6EE4\u5668\u5B9E\u4F8B\u65F6\u8C03\u7528\u8BE5\u65B9\u6CD5\uFF0C\u4E00\u822C\u5728\u65B9\u6CD5\u4E2D\u9500\u6BC1\u6216\u5173\u95ED\u8D44\u6E90\uFF0C\u5728\u8FC7\u6EE4\u5668 <code>Filter</code> \u7684\u6574\u4E2A\u751F\u547D\u5468\u671F\u4E5F\u53EA\u4F1A\u88AB\u8C03\u7528\u4E00\u6B21</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>@Component
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyFilter</span> <span class="token keyword">implements</span> <span class="token class-name">Filter</span> <span class="token punctuation">{</span>
    
    @Override
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span>FilterConfig filterConfig<span class="token punctuation">)</span> throws ServletException <span class="token punctuation">{</span>

        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Filter \u524D\u7F6E&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    @Override
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doFilter</span><span class="token punctuation">(</span>ServletRequest servletRequest<span class="token punctuation">,</span> ServletResponse servletResponse<span class="token punctuation">,</span> FilterChain filterChain<span class="token punctuation">)</span> throws IOException<span class="token punctuation">,</span> ServletException <span class="token punctuation">{</span>

        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Filter \u5904\u7406\u4E2D&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        filterChain<span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>servletRequest<span class="token punctuation">,</span> servletResponse<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    @Override
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Filter \u540E\u7F6E&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1-2-\u62E6\u622A\u5668-interceptor" tabindex="-1"><a class="header-anchor" href="#_1-2-\u62E6\u622A\u5668-interceptor" aria-hidden="true">#</a> 1.2 \u62E6\u622A\u5668 (Interceptor)</h3><p>\u62E6\u622A\u5668\u5B83\u662F\u94FE\u5F0F\u8C03\u7528\uFF0C\u4E00\u4E2A\u5E94\u7528\u4E2D\u53EF\u4EE5\u540C\u65F6\u5B58\u5728\u591A\u4E2A\u62E6\u622A\u5668<code>Interceptor</code>\uFF0C \u4E00\u4E2A\u8BF7\u6C42\u4E5F\u53EF\u4EE5\u89E6\u53D1\u591A\u4E2A\u62E6\u622A\u5668 \uFF0C\u800C\u6BCF\u4E2A\u62E6\u622A\u5668\u7684\u8C03\u7528\u4F1A\u4F9D\u636E\u5B83\u7684\u58F0\u660E\u987A\u5E8F\u4F9D\u6B21\u6267\u884C\u3002</p><p>\u9996\u5148\u7F16\u5199\u4E00\u4E2A\u7B80\u5355\u7684\u62E6\u622A\u5668\u5904\u7406\u7C7B\uFF0C\u8BF7\u6C42\u7684\u62E6\u622A\u662F\u901A\u8FC7<code>HandlerInterceptor</code> \u6765\u5B9E\u73B0\uFF0C\u770B\u5230<code>HandlerInterceptor</code> \u63A5\u53E3\u4E2D\u4E5F\u5B9A\u4E49\u4E86\u4E09\u4E2A\u65B9\u6CD5\u3002</p><ul><li><code>preHandle()</code> \uFF1A\u8FD9\u4E2A\u65B9\u6CD5\u5C06\u5728\u8BF7\u6C42\u5904\u7406\u4E4B\u524D\u8FDB\u884C\u8C03\u7528\u3002<strong>\u6CE8\u610F</strong>\uFF1A\u5982\u679C\u8BE5\u65B9\u6CD5\u7684\u8FD4\u56DE\u503C\u4E3A<code>false</code> \uFF0C\u5C06\u89C6\u4E3A\u5F53\u524D\u8BF7\u6C42\u7ED3\u675F\uFF0C\u4E0D\u4EC5\u81EA\u8EAB\u7684\u62E6\u622A\u5668\u4F1A\u5931\u6548\uFF0C\u8FD8\u4F1A\u5BFC\u81F4\u5176\u4ED6\u7684\u62E6\u622A\u5668\u4E5F\u4E0D\u518D\u6267\u884C\u3002</li><li><code>postHandle()</code>\uFF1A\u53EA\u6709\u5728 <code>preHandle()</code> \u65B9\u6CD5\u8FD4\u56DE\u503C\u4E3A<code>true</code> \u65F6\u624D\u4F1A\u6267\u884C\u3002\u4F1A\u5728Controller \u4E2D\u7684\u65B9\u6CD5\u8C03\u7528\u4E4B\u540E\uFF0CDispatcherServlet \u8FD4\u56DE\u6E32\u67D3\u89C6\u56FE\u4E4B\u524D\u88AB\u8C03\u7528\u3002 <strong>\u6709\u610F\u601D\u7684\u662F</strong>\uFF1A<code>postHandle()</code> \u65B9\u6CD5\u88AB\u8C03\u7528\u7684\u987A\u5E8F\u8DDF <code>preHandle()</code> \u662F\u76F8\u53CD\u7684\uFF0C\u5148\u58F0\u660E\u7684\u62E6\u622A\u5668 <code>preHandle()</code> \u65B9\u6CD5\u5148\u6267\u884C\uFF0C\u800C<code>postHandle()</code>\u65B9\u6CD5\u53CD\u800C\u4F1A\u540E\u6267\u884C\u3002</li><li><code>afterCompletion()</code>\uFF1A\u53EA\u6709\u5728 <code>preHandle()</code> \u65B9\u6CD5\u8FD4\u56DE\u503C\u4E3A<code>true</code> \u65F6\u624D\u4F1A\u6267\u884C\u3002\u5728\u6574\u4E2A\u8BF7\u6C42\u7ED3\u675F\u4E4B\u540E\uFF0C DispatcherServlet \u6E32\u67D3\u4E86\u5BF9\u5E94\u7684\u89C6\u56FE\u4E4B\u540E\u6267\u884C\u3002</li></ul><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyInterceptor</span> <span class="token keyword">implements</span> <span class="token class-name">HandlerInterceptor</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">preHandle</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">Object</span> handler<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Interceptor \u524D\u7F6E&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">postHandle</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">Object</span> handler<span class="token punctuation">,</span> <span class="token class-name">ModelAndView</span> modelAndView<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Interceptor \u5904\u7406\u4E2D&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">afterCompletion</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">Object</span> handler<span class="token punctuation">,</span> <span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Interceptor \u540E\u7F6E&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5C06\u81EA\u5B9A\u4E49\u597D\u7684\u62E6\u622A\u5668\u5904\u7406\u7C7B\u8FDB\u884C\u6CE8\u518C\uFF0C\u5E76\u901A\u8FC7<code>addPathPatterns</code>\u3001<code>excludePathPatterns</code>\u7B49\u5C5E\u6027\u8BBE\u7F6E\u9700\u8981\u62E6\u622A\u6216\u9700\u8981\u6392\u9664\u7684 <code>URL</code>\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyMvcConfig</span> <span class="token keyword">implements</span> <span class="token class-name">WebMvcConfigurer</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addInterceptors</span><span class="token punctuation">(</span><span class="token class-name">InterceptorRegistry</span> registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        registry<span class="token punctuation">.</span><span class="token function">addInterceptor</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addPathPatterns</span><span class="token punctuation">(</span><span class="token string">&quot;/**&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        registry<span class="token punctuation">.</span><span class="token function">addInterceptor</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyInterceptor1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addPathPatterns</span><span class="token punctuation">(</span><span class="token string">&quot;/**&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_2-\u533A\u522B" tabindex="-1"><a class="header-anchor" href="#_2-\u533A\u522B" aria-hidden="true">#</a> 2. \u533A\u522B</h2><p>\u8FC7\u6EE4\u5668 \u548C \u62E6\u622A\u5668 \u5747\u4F53\u73B0\u4E86<code>AOP</code>\u7684\u7F16\u7A0B\u601D\u60F3\uFF0C\u90FD\u53EF\u4EE5\u5B9E\u73B0\u8BF8\u5982\u65E5\u5FD7\u8BB0\u5F55\u3001\u767B\u5F55\u9274\u6743\u7B49\u529F\u80FD\uFF0C\u4F46\u4E8C\u8005\u7684\u4E0D\u540C\u70B9\u4E5F\u662F\u6BD4\u8F83\u591A\u7684\uFF0C\u63A5\u4E0B\u6765\u4E00\u4E00\u8BF4\u660E\u3002</p><h3 id="_2-1-\u5B9E\u73B0\u539F\u7406\u4E0D\u540C" tabindex="-1"><a class="header-anchor" href="#_2-1-\u5B9E\u73B0\u539F\u7406\u4E0D\u540C" aria-hidden="true">#</a> 2.1 \u5B9E\u73B0\u539F\u7406\u4E0D\u540C</h3><p>\u8FC7\u6EE4\u5668\u548C\u62E6\u622A\u5668 \u5E95\u5C42\u5B9E\u73B0\u65B9\u5F0F\u5927\u4E0D\u76F8\u540C\uFF0C</p><ul><li><code>\u8FC7\u6EE4\u5668</code> \u662F\u57FA\u4E8E\u51FD\u6570\u56DE\u8C03\u7684</li><li><code>\u62E6\u622A\u5668</code> \u5219\u662F\u57FA\u4E8EJava\u7684\u53CD\u5C04\u673A\u5236\uFF08\u52A8\u6001\u4EE3\u7406\uFF09\u5B9E\u73B0\u7684\u3002</li></ul><p>\u8FD9\u91CC\u91CD\u70B9\u8BF4\u4E0B\u8FC7\u6EE4\u5668\uFF01</p><p>\u5728\u6211\u4EEC\u81EA\u5B9A\u4E49\u7684\u8FC7\u6EE4\u5668\u4E2D\u90FD\u4F1A\u5B9E\u73B0\u4E00\u4E2A <code>doFilter()</code>\u65B9\u6CD5\uFF0C\u8FD9\u4E2A\u65B9\u6CD5\u6709\u4E00\u4E2A<code>FilterChain</code> \u53C2\u6570\uFF0C\u800C\u5B9E\u9645\u4E0A\u5B83\u662F\u4E00\u4E2A\u56DE\u8C03\u63A5\u53E3\u3002<code>ApplicationFilterChain</code>\u662F\u5B83\u7684\u5B9E\u73B0\u7C7B\uFF0C \u8FD9\u4E2A\u5B9E\u73B0\u7C7B\u5185\u90E8\u4E5F\u6709\u4E00\u4E2A <code>doFilter()</code> \u65B9\u6CD5\u5C31\u662F\u56DE\u8C03\u65B9\u6CD5\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">FilterChain</span> <span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token function">doFilter</span><span class="token punctuation">(</span><span class="token class-name">ServletRequest</span> var1<span class="token punctuation">,</span> <span class="token class-name">ServletResponse</span> var2<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ServletException</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://abelsun-1256449468.cos.ap-beijing.myqcloud.com/image/image-20221204204745980.png" alt="image-20221204204745980"></p><p><code>ApplicationFilterChain</code>\u91CC\u9762\u80FD\u62FF\u5230\u6211\u4EEC\u81EA\u5B9A\u4E49\u7684<code>xxxFilter</code>\u7C7B\uFF0C\u5728\u5176\u5185\u90E8\u56DE\u8C03\u65B9\u6CD5<code>doFilter()</code>\u91CC\u8C03\u7528\u5404\u4E2A\u81EA\u5B9A\u4E49<code>xxxFilter</code>\u8FC7\u6EE4\u5668\uFF0C\u5E76\u6267\u884C <code>doFilter()</code> \u65B9\u6CD5\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">ApplicationFilterChain</span> <span class="token keyword">implements</span> <span class="token class-name">FilterChain</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doFilter</span><span class="token punctuation">(</span><span class="token class-name">ServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">ServletResponse</span> response<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token comment">//\u7701\u7565</span>
            <span class="token function">internalDoFilter</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
 
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">internalDoFilter</span><span class="token punctuation">(</span><span class="token class-name">ServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">ServletResponse</span> response<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>pos <span class="token operator">&lt;</span> n<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//\u83B7\u53D6\u7B2Cpos\u4E2Afilter    </span>
            <span class="token class-name">ApplicationFilterConfig</span> filterConfig <span class="token operator">=</span> filters<span class="token punctuation">[</span>pos<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        
            <span class="token class-name">Filter</span> filter <span class="token operator">=</span> filterConfig<span class="token punctuation">.</span><span class="token function">getFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
            filter<span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
 
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u800C\u6BCF\u4E2A<code>xxxFilter</code> \u4F1A\u5148\u6267\u884C\u81EA\u8EAB\u7684 <code>doFilter()</code> \u8FC7\u6EE4\u903B\u8F91\uFF0C\u6700\u540E\u5728\u6267\u884C\u7ED3\u675F\u524D\u4F1A\u6267\u884C<code>filterChain.doFilter(servletRequest, servletResponse)</code>\uFF0C\u4E5F\u5C31\u662F\u56DE\u8C03<code>ApplicationFilterChain</code>\u7684<code>doFilter()</code> \u65B9\u6CD5\uFF0C\u4EE5\u6B64\u5FAA\u73AF\u6267\u884C\u5B9E\u73B0\u51FD\u6570\u56DE\u8C03\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doFilter</span><span class="token punctuation">(</span><span class="token class-name">ServletRequest</span> servletRequest<span class="token punctuation">,</span> <span class="token class-name">ServletResponse</span> servletResponse<span class="token punctuation">,</span> <span class="token class-name">FilterChain</span> filterChain<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ServletException</span> <span class="token punctuation">{</span>

        filterChain<span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>servletRequest<span class="token punctuation">,</span> servletResponse<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-2-\u89E6\u53D1\u65F6\u673A\u4E0D\u540C" tabindex="-1"><a class="header-anchor" href="#_2-2-\u89E6\u53D1\u65F6\u673A\u4E0D\u540C" aria-hidden="true">#</a> 2.2 \u89E6\u53D1\u65F6\u673A\u4E0D\u540C</h3><p><code>\u8FC7\u6EE4\u5668</code> \u548C <code>\u62E6\u622A\u5668</code>\u7684\u89E6\u53D1\u65F6\u673A\u4E5F\u4E0D\u540C\uFF0C\u6211\u4EEC\u770B\u4E0B\u8FB9\u8FD9\u5F20\u56FE\u3002</p><p><img src="https://abelsun-1256449468.cos.ap-beijing.myqcloud.com/image/image-20221204205032541.png" alt="image-20221204205032541"></p><ul><li><p>\u8FC7\u6EE4\u5668<code>Filter</code>\u662F\u5728\u8BF7\u6C42\u8FDB\u5165\u5BB9\u5668\u540E\uFF0C\u4F46\u5728\u8FDB\u5165<code>servlet</code>\u4E4B\u524D\u8FDB\u884C\u9884\u5904\u7406\uFF0C\u8BF7\u6C42\u7ED3\u675F\u662F\u5728<code>servlet</code>\u5904\u7406\u5B8C\u4EE5\u540E\u3002</p></li><li><p>\u62E6\u622A\u5668 <code>Interceptor</code> \u662F\u5728\u8BF7\u6C42\u8FDB\u5165<code>servlet</code>\u540E\uFF0C\u5728\u8FDB\u5165<code>Controller</code>\u4E4B\u524D\u8FDB\u884C\u9884\u5904\u7406\u7684\uFF0C<code>Controller</code> \u4E2D\u6E32\u67D3\u4E86\u5BF9\u5E94\u7684\u89C6\u56FE\u4E4B\u540E\u8BF7\u6C42\u7ED3\u675F\u3002</p></li></ul><h3 id="_2-3-\u62E6\u622A\u7684\u8BF7\u6C42\u8303\u56F4\u4E0D\u540C" tabindex="-1"><a class="header-anchor" href="#_2-3-\u62E6\u622A\u7684\u8BF7\u6C42\u8303\u56F4\u4E0D\u540C" aria-hidden="true">#</a> 2.3 \u62E6\u622A\u7684\u8BF7\u6C42\u8303\u56F4\u4E0D\u540C</h3><p>\u5728\u4E0A\u8FB9\u6211\u4EEC\u5DF2\u7ECF\u540C\u65F6\u914D\u7F6E\u4E86\u8FC7\u6EE4\u5668\u548C\u62E6\u622A\u5668\uFF0C\u518D\u5EFA\u4E00\u4E2A<code>Controller</code>\u63A5\u6536\u8BF7\u6C42\u6D4B\u8BD5\u4E00\u4E0B\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Controller</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/test1&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ResponseBody</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">test1</span><span class="token punctuation">(</span><span class="token class-name">String</span> a<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u6211\u662Fcontroller&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u9879\u76EE\u542F\u52A8\u8FC7\u7A0B\u4E2D\u53D1\u73B0\uFF0C\u8FC7\u6EE4\u5668\u7684<code>init()</code>\u65B9\u6CD5\uFF0C\u968F\u7740\u5BB9\u5668\u7684\u542F\u52A8\u8FDB\u884C\u4E86\u521D\u59CB\u5316\u3002</p><p><img src="https://abelsun-1256449468.cos.ap-beijing.myqcloud.com/image/image-20221204205449938.png" alt="image-20221204205449938"></p><p>\u6B64\u65F6\u6D4F\u89C8\u5668\u53D1\u9001\u8BF7\u6C42\uFF0CF12 \u770B\u5230\u5C45\u7136\u6709\u4E24\u4E2A\u8BF7\u6C42\uFF0C\u4E00\u4E2A\u662F\u6211\u4EEC\u81EA\u5B9A\u4E49\u7684 <code>Controller</code> \u8BF7\u6C42\uFF0C\u53E6\u4E00\u4E2A\u662F\u8BBF\u95EE\u9759\u6001\u56FE\u6807\u8D44\u6E90\u7684\u8BF7\u6C42\u3002</p><p><img src="https://abelsun-1256449468.cos.ap-beijing.myqcloud.com/image/image-20221204205510236.png" alt="image-20221204205510236"></p><p>\u770B\u5230\u63A7\u5236\u53F0\u7684\u6253\u5370\u65E5\u5FD7\u5982\u4E0B\uFF1A</p><p>\u6267\u884C\u987A\u5E8F \uFF1A<code>Filter \u5904\u7406\u4E2D</code> -&gt; <code>Interceptor \u524D\u7F6E</code> -&gt; <code>\u6211\u662Fcontroller</code> -&gt; <code>Interceptor \u5904\u7406\u4E2D</code> -&gt; <code>Interceptor \u5904\u7406\u540E</code></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>Filter \u5904\u7406\u4E2D
Interceptor \u524D\u7F6E
Interceptor \u5904\u7406\u4E2D
Interceptor \u540E\u7F6E
Filter \u5904\u7406\u4E2D
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8FC7\u6EE4\u5668<code>Filter</code>\u6267\u884C\u4E86\u4E24\u6B21\uFF0C\u62E6\u622A\u5668<code>Interceptor</code>\u53EA\u6267\u884C\u4E86\u4E00\u6B21\u3002\u8FD9\u662F\u56E0\u4E3A\u8FC7\u6EE4\u5668\u51E0\u4E4E\u53EF\u4EE5\u5BF9\u6240\u6709\u8FDB\u5165\u5BB9\u5668\u7684\u8BF7\u6C42\u8D77\u4F5C\u7528\uFF0C\u800C\u62E6\u622A\u5668\u53EA\u4F1A\u5BF9<code>Controller</code>\u4E2D\u8BF7\u6C42\u6216\u8BBF\u95EE<code>static</code>\u76EE\u5F55\u4E0B\u7684\u8D44\u6E90\u8BF7\u6C42\u8D77\u4F5C\u7528\u3002</p><h3 id="_2-4-\u6CE8\u5165bean\u60C5\u51B5\u4E0D\u540C" tabindex="-1"><a class="header-anchor" href="#_2-4-\u6CE8\u5165bean\u60C5\u51B5\u4E0D\u540C" aria-hidden="true">#</a> 2.4 \u6CE8\u5165Bean\u60C5\u51B5\u4E0D\u540C</h3><p>\u5728\u5B9E\u9645\u7684\u4E1A\u52A1\u573A\u666F\u4E2D\uFF0C\u5E94\u7528\u5230\u8FC7\u6EE4\u5668\u6216\u62E6\u622A\u5668\uFF0C\u4E3A\u5904\u7406\u4E1A\u52A1\u903B\u8F91\u96BE\u514D\u4F1A\u5F15\u5165\u4E00\u4E9B<code>service</code>\u670D\u52A1\u3002</p><p>\u4E0B\u8FB9\u6211\u4EEC\u5206\u522B\u5728\u8FC7\u6EE4\u5668\u548C\u62E6\u622A\u5668\u4E2D\u90FD\u6CE8\u5165<code>service</code>\uFF0C\u770B\u770B\u6709\u4EC0\u4E48\u4E0D\u540C\uFF1F</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>@Component
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">TestService</span> <span class="token punctuation">{</span>

    @Override
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u6211\u662F\u65B9\u6CD5A&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8FC7\u6EE4\u5668\u4E2D\u6CE8\u5165<code>service</code>\uFF0C\u53D1\u8D77\u8BF7\u6C42\u6D4B\u8BD5\u4E00\u4E0B \uFF0C\u65E5\u5FD7\u6B63\u5E38\u6253\u5370\u51FA<code>\u201C\u6211\u662F\u65B9\u6CD5A\u201D</code>\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">TestService</span> testService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doFilter</span><span class="token punctuation">(</span><span class="token class-name">ServletRequest</span> servletRequest<span class="token punctuation">,</span> <span class="token class-name">ServletResponse</span> servletResponse<span class="token punctuation">,</span> <span class="token class-name">FilterChain</span> filterChain<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ServletException</span> <span class="token punctuation">{</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Filter \u5904\u7406\u4E2D&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        testService<span class="token punctuation">.</span><span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        filterChain<span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>servletRequest<span class="token punctuation">,</span> servletResponse<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token class-name">Filter</span> \u5904\u7406\u4E2D
\u6211\u662F\u65B9\u6CD5<span class="token class-name">A</span>
<span class="token class-name">Interceptor</span> \u524D\u7F6E
\u6211\u662Fcontroller
<span class="token class-name">Interceptor</span> \u5904\u7406\u4E2D
<span class="token class-name">Interceptor</span> \u540E\u7F6E
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5728\u62E6\u622A\u5668\u4E2D\u6CE8\u5165<code>service</code>\uFF0C\u53D1\u8D77\u8BF7\u6C42\u6D4B\u8BD5\u4E00\u4E0B \uFF0C\u7ADF\u7136TM\u7684\u62A5\u9519\u4E86\uFF0C<code>debug</code>\u8DDF\u4E00\u4E0B\u53D1\u73B0\u6CE8\u5165\u7684<code>service</code>\u600E\u4E48\u662F<code>Null</code>\u554A\uFF1F</p><p><img src="https://abelsun-1256449468.cos.ap-beijing.myqcloud.com/image/image-20221204205747716.png" alt="image-20221204205747716"></p><p>\u8FD9\u662F\u56E0\u4E3A\u52A0\u8F7D\u987A\u5E8F\u5BFC\u81F4\u7684\u95EE\u9898\uFF0C<code>\u62E6\u622A\u5668</code>\u52A0\u8F7D\u7684\u65F6\u95F4\u70B9\u5728<code>springcontext</code>\u4E4B\u524D\uFF0C\u800C<code>Bean</code>\u53C8\u662F\u7531<code>spring</code>\u8FDB\u884C\u7BA1\u7406\u3002</p><blockquote><p>\u62E6\u622A\u5668\uFF1A\u8001\u5B50\u4ECA\u5929\u8981\u8FDB\u6D1E\u623F\uFF1B Spring\uFF1A\u5144\u5F1F\u522B\u95F9\uFF0C\u4F60\u5AB3\u5987\u6211\u8FD8\u6CA1\u751F\u51FA\u6765\u5462\uFF01</p></blockquote><p>\u89E3\u51B3\u65B9\u6848\u4E5F\u5F88\u7B80\u5355\uFF0C\u6211\u4EEC\u5728\u6CE8\u518C\u62E6\u622A\u5668\u4E4B\u524D\uFF0C\u5148\u5C06<code>Interceptor</code> \u624B\u52A8\u8FDB\u884C\u6CE8\u5165\u3002<strong>\u6CE8\u610F</strong>\uFF1A\u5728<code>registry.addInterceptor()</code>\u6CE8\u518C\u7684\u662F<code>getMyInterceptor()</code> \u5B9E\u4F8B\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyMvcConfig</span> <span class="token keyword">implements</span> <span class="token class-name">WebMvcConfigurer</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">MyInterceptor</span> <span class="token function">getMyInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u6CE8\u5165\u4E86MyInterceptor&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">MyInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addInterceptors</span><span class="token punctuation">(</span><span class="token class-name">InterceptorRegistry</span> registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        registry<span class="token punctuation">.</span><span class="token function">addInterceptor</span><span class="token punctuation">(</span><span class="token function">getMyInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addPathPatterns</span><span class="token punctuation">(</span><span class="token string">&quot;/**&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-5-\u63A7\u5236\u6267\u884C\u987A\u5E8F\u4E0D\u540C" tabindex="-1"><a class="header-anchor" href="#_2-5-\u63A7\u5236\u6267\u884C\u987A\u5E8F\u4E0D\u540C" aria-hidden="true">#</a> 2.5 \u63A7\u5236\u6267\u884C\u987A\u5E8F\u4E0D\u540C</h3><p>\u5B9E\u9645\u5F00\u53D1\u8FC7\u7A0B\u4E2D\uFF0C\u4F1A\u51FA\u73B0\u591A\u4E2A\u8FC7\u6EE4\u5668\u6216\u62E6\u622A\u5668\u540C\u65F6\u5B58\u5728\u7684\u60C5\u51B5\uFF0C\u4E0D\u8FC7\uFF0C\u6709\u65F6\u6211\u4EEC\u5E0C\u671B\u67D0\u4E2A\u8FC7\u6EE4\u5668\u6216\u62E6\u622A\u5668\u80FD\u4F18\u5148\u6267\u884C\uFF0C\u5C31\u6D89\u53CA\u5230\u5B83\u4EEC\u7684\u6267\u884C\u987A\u5E8F\u3002</p><p>\u8FC7\u6EE4\u5668\u7528<code>@Order</code>\u6CE8\u89E3\u63A7\u5236\u6267\u884C\u987A\u5E8F\uFF0C\u901A\u8FC7<code>@Order</code>\u63A7\u5236\u8FC7\u6EE4\u5668\u7684\u7EA7\u522B\uFF0C\u503C\u8D8A\u5C0F\u7EA7\u522B\u8D8A\u9AD8\u8D8A\u5148\u6267\u884C\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>@<span class="token function">Order</span><span class="token punctuation">(</span>Ordered<span class="token punctuation">.</span><span class="token constant">HIGHEST_PRECEDENCE</span><span class="token punctuation">)</span>
@Component
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyFilter2</span> <span class="token keyword">implements</span> <span class="token class-name">Filter</span> <span class="token punctuation">{</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u62E6\u622A\u5668\u9ED8\u8BA4\u7684\u6267\u884C\u987A\u5E8F\uFF0C\u5C31\u662F\u5B83\u7684\u6CE8\u518C\u987A\u5E8F\uFF0C\u4E5F\u53EF\u4EE5\u901A\u8FC7<code>Order</code>\u624B\u52A8\u8BBE\u7F6E\u63A7\u5236\uFF0C\u503C\u8D8A\u5C0F\u8D8A\u5148\u6267\u884C\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code> @Override
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addInterceptors</span><span class="token punctuation">(</span><span class="token parameter">InterceptorRegistry registry</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        registry<span class="token punctuation">.</span><span class="token function">addInterceptor</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyInterceptor2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addPathPatterns</span><span class="token punctuation">(</span><span class="token string">&quot;/**&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">order</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        registry<span class="token punctuation">.</span><span class="token function">addInterceptor</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyInterceptor1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addPathPatterns</span><span class="token punctuation">(</span><span class="token string">&quot;/**&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">order</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        registry<span class="token punctuation">.</span><span class="token function">addInterceptor</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addPathPatterns</span><span class="token punctuation">(</span><span class="token string">&quot;/**&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">order</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u770B\u5230\u8F93\u51FA\u7ED3\u679C\u53D1\u73B0\uFF0C\u5148\u58F0\u660E\u7684\u62E6\u622A\u5668 <code>preHandle()</code> \u65B9\u6CD5\u5148\u6267\u884C\uFF0C\u800C<code>postHandle()</code>\u65B9\u6CD5\u53CD\u800C\u4F1A\u540E\u6267\u884C\u3002</p><p><code>postHandle()</code> \u65B9\u6CD5\u88AB\u8C03\u7528\u7684\u987A\u5E8F\u8DDF <code>preHandle()</code> \u5C45\u7136\u662F\u76F8\u53CD\u7684\uFF01\u5982\u679C\u5B9E\u9645\u5F00\u53D1\u4E2D\u4E25\u683C\u8981\u6C42\u6267\u884C\u987A\u5E8F\uFF0C\u90A3\u5C31\u9700\u8981\u7279\u522B\u6CE8\u610F\u8FD9\u4E00\u70B9\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>Interceptor1 \u524D\u7F6E
Interceptor2 \u524D\u7F6E
Interceptor \u524D\u7F6E
\u6211\u662Fcontroller
Interceptor \u5904\u7406\u4E2D
Interceptor2 \u5904\u7406\u4E2D
Interceptor1 \u5904\u7406\u4E2D
Interceptor \u540E\u7F6E
Interceptor2 \u5904\u7406\u540E
Interceptor1 \u5904\u7406\u540E
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>\u90A3\u4E3A\u4EC0\u4E48\u4F1A\u8FD9\u6837\u5462\uFF1F</strong> \u5F97\u5230\u7B54\u6848\u5C31\u53EA\u80FD\u770B\u6E90\u7801\u4E86\uFF0C\u6211\u4EEC\u8981\u77E5\u9053<code>controller</code> \u4E2D\u6240\u6709\u7684\u8BF7\u6C42\u90FD\u8981\u7ECF\u8FC7\u6838\u5FC3\u7EC4\u4EF6<code>DispatcherServlet</code>\u8DEF\u7531\uFF0C\u90FD\u4F1A\u6267\u884C\u5B83\u7684 <code>doDispatch()</code> \u65B9\u6CD5\uFF0C\u800C\u62E6\u622A\u5668<code>postHandle()</code>\u3001<code>preHandle()</code>\u65B9\u6CD5\u4FBF\u662F\u5728\u5176\u4E2D\u8C03\u7528\u7684\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doDispatch</span><span class="token punctuation">(</span>HttpServletRequest request<span class="token punctuation">,</span> HttpServletResponse response<span class="token punctuation">)</span> throws Exception <span class="token punctuation">{</span>
    
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
         <span class="token operator">...</span><span class="token operator">...</span><span class="token operator">...</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
           
                <span class="token comment">// \u83B7\u53D6\u53EF\u4EE5\u6267\u884C\u5F53\u524DHandler\u7684\u9002\u914D\u5668</span>
                HandlerAdapter ha <span class="token operator">=</span> <span class="token function">getHandlerAdapter</span><span class="token punctuation">(</span>mappedHandler<span class="token punctuation">.</span><span class="token function">getHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">// Process last-modified header, if supported by the handler.</span>
                String method <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                boolean isGet <span class="token operator">=</span> <span class="token string">&quot;GET&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>isGet <span class="token operator">||</span> <span class="token string">&quot;HEAD&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    long lastModified <span class="token operator">=</span> ha<span class="token punctuation">.</span><span class="token function">getLastModified</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> mappedHandler<span class="token punctuation">.</span><span class="token function">getHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>logger<span class="token punctuation">.</span><span class="token function">isDebugEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        logger<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;Last-Modified value for [&quot;</span> <span class="token operator">+</span> <span class="token function">getRequestUri</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;] is: &quot;</span> <span class="token operator">+</span> lastModified<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ServletWebRequest</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">checkNotModified</span><span class="token punctuation">(</span>lastModified<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> isGet<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token keyword">return</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
                <span class="token comment">// \u6CE8\u610F\uFF1A \u6267\u884CInterceptor\u4E2DPreHandle()\u65B9\u6CD5</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>mappedHandler<span class="token punctuation">.</span><span class="token function">applyPreHandle</span><span class="token punctuation">(</span>processedRequest<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">return</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>

                <span class="token comment">// \u6CE8\u610F\uFF1A\u6267\u884CHandle\u3010\u5305\u62EC\u6211\u4EEC\u7684\u4E1A\u52A1\u903B\u8F91\uFF0C\u5F53\u629B\u51FA\u5F02\u5E38\u65F6\u4F1A\u88ABTry\u3001catch\u5230\u3011</span>
                mv <span class="token operator">=</span> ha<span class="token punctuation">.</span><span class="token function">handle</span><span class="token punctuation">(</span>processedRequest<span class="token punctuation">,</span> response<span class="token punctuation">,</span> mappedHandler<span class="token punctuation">.</span><span class="token function">getHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token keyword">if</span> <span class="token punctuation">(</span>asyncManager<span class="token punctuation">.</span><span class="token function">isConcurrentHandlingStarted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">return</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token function">applyDefaultViewName</span><span class="token punctuation">(</span>processedRequest<span class="token punctuation">,</span> mv<span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">// \u6CE8\u610F\uFF1A\u6267\u884CInterceptor\u4E2DPostHandle \u65B9\u6CD5\u3010\u629B\u51FA\u5F02\u5E38\u65F6\u65E0\u6CD5\u6267\u884C\u3011</span>
                mappedHandler<span class="token punctuation">.</span><span class="token function">applyPostHandle</span><span class="token punctuation">(</span>processedRequest<span class="token punctuation">,</span> response<span class="token punctuation">,</span> mv<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token operator">...</span><span class="token operator">...</span><span class="token operator">...</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u770B\u770B\u4E24\u4E2A\u65B9\u6CD5<code>applyPreHandle(\uFF09</code>\u3001<code>applyPostHandle(\uFF09</code>\u5177\u4F53\u662F\u5982\u4F55\u88AB\u8C03\u7528\u7684\uFF0C\u5C31\u660E\u767D\u4E3A\u4EC0\u4E48<code>postHandle()</code>\u3001<code>preHandle()</code> \u6267\u884C\u987A\u5E8F\u662F\u76F8\u53CD\u7684\u4E86\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>boolean <span class="token function">applyPreHandle</span><span class="token punctuation">(</span>HttpServletRequest request<span class="token punctuation">,</span> HttpServletResponse response<span class="token punctuation">)</span> throws Exception <span class="token punctuation">{</span>
        HandlerInterceptor<span class="token punctuation">[</span><span class="token punctuation">]</span> interceptors <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getInterceptors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>ObjectUtils<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>interceptors<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span><span class="token punctuation">(</span>int i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> interceptors<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>interceptorIndex <span class="token operator">=</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                HandlerInterceptor interceptor <span class="token operator">=</span> interceptors<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>interceptor<span class="token punctuation">.</span><span class="token function">preHandle</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>handler<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">triggerAfterCompletion</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> <span class="token punctuation">(</span>Exception<span class="token punctuation">)</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token function">applyPostHandle</span><span class="token punctuation">(</span>HttpServletRequest request<span class="token punctuation">,</span> HttpServletResponse response<span class="token punctuation">,</span> @Nullable ModelAndView mv<span class="token punctuation">)</span> throws Exception <span class="token punctuation">{</span>
        HandlerInterceptor<span class="token punctuation">[</span><span class="token punctuation">]</span> interceptors <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getInterceptors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>ObjectUtils<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>interceptors<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span><span class="token punctuation">(</span>int i <span class="token operator">=</span> interceptors<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token operator">--</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                HandlerInterceptor interceptor <span class="token operator">=</span> interceptors<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
                interceptor<span class="token punctuation">.</span><span class="token function">postHandle</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>handler<span class="token punctuation">,</span> mv<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u53D1\u73B0\u4E24\u4E2A\u65B9\u6CD5\u4E2D\u5728\u8C03\u7528\u62E6\u622A\u5668\u6570\u7EC4 <code>HandlerInterceptor[]</code> \u65F6\uFF0C\u5FAA\u73AF\u7684\u987A\u5E8F\u7ADF\u7136\u662F\u76F8\u53CD\u7684\u3002\u3002\u3002\uFF0C\u5BFC\u81F4<code>postHandle()</code>\u3001<code>preHandle()</code> \u65B9\u6CD5\u6267\u884C\u7684\u987A\u5E8F\u76F8\u53CD\u3002</p><h2 id="\u53C2\u8003\u6587\u7AE0" tabindex="-1"><a class="header-anchor" href="#\u53C2\u8003\u6587\u7AE0" aria-hidden="true">#</a> \u53C2\u8003\u6587\u7AE0</h2>`,69),r={href:"https://segmentfault.com/a/1190000022833940",target:"_blank",rel:"noopener noreferrer"};function d(k,v){const s=i("ExternalLinkIcon");return e(),t("div",null,[u,n("p",null,[n("a",r,[p("\u8FC7\u6EE4\u5668 \u548C \u62E6\u622A\u5668 6\u4E2A\u533A\u522B\uFF0C\u522B\u518D\u50BB\u50BB\u5206\u4E0D\u6E05\u4E86"),o(s)])])])}const g=a(l,[["render",d],["__file","spring-y-action-filter.html.vue"]]);export{g as default};
