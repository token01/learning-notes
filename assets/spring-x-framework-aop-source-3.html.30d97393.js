import{_ as e}from"./_plugin-vue_export-helper.cdc0426e.js";import{o as c,c as o,a as n,b as s,d as t,f as p,r as l}from"./app.9644bb67.js";const i={},u=p('<h1 id="spring\u8FDB\u9636-spring-aop\u5B9E\u73B0\u539F\u7406\u8BE6\u89E3\u4E4Bcglib\u4EE3\u7406\u5B9E\u73B0" tabindex="-1"><a class="header-anchor" href="#spring\u8FDB\u9636-spring-aop\u5B9E\u73B0\u539F\u7406\u8BE6\u89E3\u4E4Bcglib\u4EE3\u7406\u5B9E\u73B0" aria-hidden="true">#</a> Spring\u8FDB\u9636 - Spring AOP\u5B9E\u73B0\u539F\u7406\u8BE6\u89E3\u4E4BCglib\u4EE3\u7406\u5B9E\u73B0</h1><blockquote><p>\u6211\u4EEC\u5728\u524D\u6587\u4E2D\u5DF2\u7ECF\u4ECB\u7ECD\u4E86SpringAOP\u7684\u5207\u9762\u5B9E\u73B0\u548C\u521B\u5EFA\u52A8\u6001\u4EE3\u7406\u7684\u8FC7\u7A0B\uFF0C\u90A3\u4E48\u52A8\u6001\u4EE3\u7406\u662F\u5982\u4F55\u5DE5\u4F5C\u7684\u5462\uFF1F\u672C\u6587\u4E3B\u8981\u4ECB\u7ECDCglib\u52A8\u6001\u4EE3\u7406\u7684\u6848\u4F8B\u548CSpringAOP\u5B9E\u73B0\u7684\u539F\u7406\u3002</p></blockquote><h2 id="_1-\u5F15\u5165" tabindex="-1"><a class="header-anchor" href="#_1-\u5F15\u5165" aria-hidden="true">#</a> 1. \u5F15\u5165</h2><blockquote><p>\u6211\u4EEC\u5728\u524D\u6587\u4E2D\u5DF2\u7ECF\u4ECB\u7ECD\u4E86SpringAOP\u7684\u5207\u9762\u5B9E\u73B0\u548C\u521B\u5EFA\u52A8\u6001\u4EE3\u7406\u7684\u8FC7\u7A0B\uFF0C\u90A3\u4E48\u52A8\u6001\u4EE3\u7406\u662F\u5982\u4F55\u5DE5\u4F5C\u7684\u5462\uFF1F\u672C\u6587\u4E3B\u8981\u4ECB\u7ECDCglib\u52A8\u6001\u4EE3\u7406\u7684\u6848\u4F8B\u548CSpringAOP\u5B9E\u73B0\u7684\u539F\u7406\u3002</p></blockquote><p>\u8981\u4E86\u89E3\u52A8\u6001\u4EE3\u7406\u662F\u5982\u4F55\u5DE5\u4F5C\u7684\uFF0C\u9996\u5148\u9700\u8981\u4E86\u89E3</p><ul><li>\u4EC0\u4E48\u662F\u4EE3\u7406\u6A21\u5F0F\uFF1F</li><li>\u4EC0\u4E48\u662F\u52A8\u6001\u4EE3\u7406\uFF1F</li><li>\u4EC0\u4E48\u662FCglib\uFF1F</li><li>SpringAOP\u548CCglib\u662F\u4EC0\u4E48\u5173\u7CFB\uFF1F</li></ul><h3 id="_1-1-\u52A8\u6001\u4EE3\u7406\u8981\u89E3\u51B3\u4EC0\u4E48\u95EE\u9898" tabindex="-1"><a class="header-anchor" href="#_1-1-\u52A8\u6001\u4EE3\u7406\u8981\u89E3\u51B3\u4EC0\u4E48\u95EE\u9898" aria-hidden="true">#</a> 1.1 \u52A8\u6001\u4EE3\u7406\u8981\u89E3\u51B3\u4EC0\u4E48\u95EE\u9898\uFF1F</h3><h4 id="_1-1-1-\u4EC0\u4E48\u662F\u4EE3\u7406" tabindex="-1"><a class="header-anchor" href="#_1-1-1-\u4EC0\u4E48\u662F\u4EE3\u7406" aria-hidden="true">#</a> 1.1.1 \u4EC0\u4E48\u662F\u4EE3\u7406\uFF1F</h4><p><strong>\u4EE3\u7406\u6A21\u5F0F</strong>(Proxy pattern): \u4E3A\u53E6\u4E00\u4E2A\u5BF9\u8C61\u63D0\u4F9B\u4E00\u4E2A\u66FF\u8EAB\u6216\u5360\u4F4D\u7B26\u4EE5\u63A7\u5236\u5BF9\u8FD9\u4E2A\u5BF9\u8C61\u7684\u8BBF\u95EE</p><p><img src="https://abelsun-1256449468.cos.ap-beijing.myqcloud.com/image/image-20220712215741243.png" alt="image-20220712215741243"></p><p>\u4E3E\u4E2A\u7B80\u5355\u7684\u4F8B\u5B50\uFF1A</p><p>\u6211(client)\u5982\u679C\u8981\u4E70(doOperation)\u623F\uFF0C\u53EF\u4EE5\u627E\u4E2D\u4ECB(proxy)\u4E70\u623F\uFF0C\u4E2D\u4ECB\u76F4\u63A5\u548C\u5356\u65B9(target)\u4E70\u623F\u3002\u4E2D\u4ECB\u548C\u5356\u65B9\u90FD\u5B9E\u73B0\u4E70\u5356(doOperation)\u7684\u64CD\u4F5C\u3002\u4E2D\u4ECB\u5C31\u662F\u4EE3\u7406(proxy)\u3002</p><h4 id="_1-1-2-\u4EC0\u4E48\u662F\u52A8\u6001\u4EE3\u7406" tabindex="-1"><a class="header-anchor" href="#_1-1-2-\u4EC0\u4E48\u662F\u52A8\u6001\u4EE3\u7406" aria-hidden="true">#</a> 1.1.2 \u4EC0\u4E48\u662F\u52A8\u6001\u4EE3\u7406\uFF1F</h4><blockquote><p>\u52A8\u6001\u4EE3\u7406\u5C31\u662F\uFF0C\u5728\u7A0B\u5E8F\u8FD0\u884C\u671F\uFF0C\u521B\u5EFA\u76EE\u6807\u5BF9\u8C61\u7684\u4EE3\u7406\u5BF9\u8C61\uFF0C\u5E76\u5BF9\u76EE\u6807\u5BF9\u8C61\u4E2D\u7684\u65B9\u6CD5\u8FDB\u884C\u529F\u80FD\u6027\u589E\u5F3A\u7684\u4E00\u79CD\u6280\u672F\u3002</p></blockquote><p>\u5728\u751F\u6210\u4EE3\u7406\u5BF9\u8C61\u7684\u8FC7\u7A0B\u4E2D\uFF0C\u76EE\u6807\u5BF9\u8C61\u4E0D\u53D8\uFF0C\u4EE3\u7406\u5BF9\u8C61\u4E2D\u7684\u65B9\u6CD5\u662F\u76EE\u6807\u5BF9\u8C61\u65B9\u6CD5\u7684\u589E\u5F3A\u65B9\u6CD5\u3002\u53EF\u4EE5\u7406\u89E3\u4E3A\u8FD0\u884C\u671F\u95F4\uFF0C\u5BF9\u8C61\u4E2D\u65B9\u6CD5\u7684\u52A8\u6001\u62E6\u622A\uFF0C\u5728\u62E6\u622A\u65B9\u6CD5\u7684\u524D\u540E\u6267\u884C\u529F\u80FD\u64CD\u4F5C\u3002</p><p><img src="https://abelsun-1256449468.cos.ap-beijing.myqcloud.com/image/image-20220712220855511.png" alt="image-20220712220855511"></p><h3 id="_1-2-\u4EC0\u4E48\u662Fcglib-springaop\u548Ccglib\u662F\u4EC0\u4E48\u5173\u7CFB" tabindex="-1"><a class="header-anchor" href="#_1-2-\u4EC0\u4E48\u662Fcglib-springaop\u548Ccglib\u662F\u4EC0\u4E48\u5173\u7CFB" aria-hidden="true">#</a> 1.2 \u4EC0\u4E48\u662FCglib? SpringAOP\u548CCglib\u662F\u4EC0\u4E48\u5173\u7CFB\uFF1F</h3><blockquote><p>Cglib\u662F\u4E00\u4E2A\u5F3A\u5927\u7684\u3001\u9AD8\u6027\u80FD\u7684\u4EE3\u7801\u751F\u6210\u5305\uFF0C\u5B83\u5E7F\u6CDB\u88AB\u8BB8\u591AAOP\u6846\u67B6\u4F7F\u7528\uFF0C\u4E3A\u4ED6\u4EEC\u63D0\u4F9B\u65B9\u6CD5\u7684\u62E6\u622A\u3002</p></blockquote><p><img src="https://abelsun-1256449468.cos.ap-beijing.myqcloud.com/image/image-20220712220934360.png" alt="image-20220712220934360"></p>',19),k={href:"https://pdai.tech/md/java/jvm/java-jvm-class.html",target:"_blank",rel:"noopener noreferrer"},r=n("li",null,"ASM\u662F\u64CD\u4F5C\u5B57\u8282\u7801\u7684\u5DE5\u5177",-1),d=n("li",null,"cglib\u57FA\u4E8EASM\u5B57\u8282\u7801\u5DE5\u5177\u64CD\u4F5C\u5B57\u8282\u7801\uFF08\u5373\u52A8\u6001\u751F\u6210\u4EE3\u7406\uFF0C\u5BF9\u65B9\u6CD5\u8FDB\u884C\u589E\u5F3A\uFF09",-1),m=n("li",null,[n("strong",null,"SpringAOP\u57FA\u4E8Ecglib\u8FDB\u884C\u5C01\u88C5\uFF0C\u5B9E\u73B0cglib\u65B9\u5F0F\u7684\u52A8\u6001\u4EE3\u7406")],-1),v=p(`<h2 id="_2-cglib\u7B80\u4ECB" tabindex="-1"><a class="header-anchor" href="#_2-cglib\u7B80\u4ECB" aria-hidden="true">#</a> 2. cglib\u7B80\u4ECB</h2><h3 id="_2-1-\u4E3A\u4EC0\u4E48\u5F15\u5165cglib" tabindex="-1"><a class="header-anchor" href="#_2-1-\u4E3A\u4EC0\u4E48\u5F15\u5165cglib" aria-hidden="true">#</a> 2.1 \u4E3A\u4EC0\u4E48\u5F15\u5165cglib</h3><p><strong><code>JDK</code>\u7684\u52A8\u6001\u4EE3\u7406\u5B58\u5728\u9650\u5236\uFF0C\u90A3\u5C31\u662F\u88AB\u4EE3\u7406\u7684\u7C7B\u5FC5\u987B\u662F\u4E00\u4E2A\u5B9E\u73B0\u4E86\u63A5\u53E3\u7684\u7C7B</strong>\uFF0C\u4EE3\u7406\u7C7B\u9700\u8981\u5B9E\u73B0\u76F8\u540C\u7684\u63A5\u53E3\uFF0C\u4EE3\u7406\u63A5\u53E3\u4E2D\u58F0\u660E\u7684\u65B9\u6CD5\u3002\u82E5\u9700\u8981\u4EE3\u7406\u7684\u7C7B\u6CA1\u6709\u5B9E\u73B0\u63A5\u53E3\uFF0C\u6B64\u65F6<code>JDK</code>\u7684\u52A8\u6001\u4EE3\u7406\u5C06\u6CA1\u6709\u529E\u6CD5\u4F7F\u7528\uFF0C\u4E8E\u662F<code>Spring</code>\u4F1A\u4F7F\u7528<code>CGLib</code>\u7684\u52A8\u6001\u4EE3\u7406\u6765\u751F\u6210\u4EE3\u7406\u5BF9\u8C61\u3002<code>CGLib</code>\u76F4\u63A5\u64CD\u4F5C\u5B57\u8282\u7801\uFF0C\u751F\u6210\u7C7B\u7684\u5B50\u7C7B\uFF0C\u91CD\u5199\u7C7B\u7684\u65B9\u6CD5\u5B8C\u6210\u4EE3\u7406\u3002</p><h3 id="_2-2-cglib-\u5B9E\u73B0\u539F\u7406" tabindex="-1"><a class="header-anchor" href="#_2-2-cglib-\u5B9E\u73B0\u539F\u7406" aria-hidden="true">#</a> 2.2 cglib \u5B9E\u73B0\u539F\u7406</h3><p><code>CGLib</code>\u5B9E\u73B0\u52A8\u6001\u4EE3\u7406\u7684\u539F\u7406\u662F\uFF0C\u5E95\u5C42\u91C7\u7528\u4E86<code>ASM</code>\u5B57\u8282\u7801\u751F\u6210\u6846\u67B6\uFF0C\u76F4\u63A5\u5BF9\u9700\u8981\u4EE3\u7406\u7684\u7C7B\u7684\u5B57\u8282\u7801\u8FDB\u884C\u64CD\u4F5C\uFF0C\u751F\u6210\u8FD9\u4E2A\u7C7B\u7684\u4E00\u4E2A\u5B50\u7C7B\uFF0C\u5E76\u91CD\u5199\u4E86\u7C7B\u7684\u6240\u6709\u53EF\u4EE5\u91CD\u5199\u7684\u65B9\u6CD5\uFF0C\u5728\u91CD\u5199\u7684\u8FC7\u7A0B\u4E2D\uFF0C\u5C06\u6211\u4EEC\u5B9A\u4E49\u7684\u989D\u5916\u7684\u903B\u8F91\uFF08\u7B80\u5355\u7406\u89E3\u4E3A<code>Spring</code>\u4E2D\u7684\u5207\u9762\uFF09\u7EC7\u5165\u5230\u65B9\u6CD5\u4E2D\uFF0C\u5BF9\u65B9\u6CD5\u8FDB\u884C\u4E86\u589E\u5F3A\u3002\u800C\u901A\u8FC7\u5B57\u8282\u7801\u64CD\u4F5C\u751F\u6210\u7684\u4EE3\u7406\u7C7B\uFF0C\u548C\u6211\u4EEC\u81EA\u5DF1\u7F16\u5199\u5E76\u7F16\u8BD1\u540E\u7684\u7C7B\u6CA1\u6709\u592A\u5927\u533A\u522B\u3002</p><h3 id="_2-3-\u4F18\u70B9" tabindex="-1"><a class="header-anchor" href="#_2-3-\u4F18\u70B9" aria-hidden="true">#</a> 2.3 \u4F18\u70B9</h3><ol><li>\u4F7F\u7528<code>CGLib</code>\u4EE3\u7406\u7684\u7C7B\uFF0C\u4E0D\u9700\u8981\u5B9E\u73B0\u63A5\u53E3\uFF0C\u56E0\u4E3A<code>CGLib</code>\u751F\u6210\u7684\u4EE3\u7406\u7C7B\u662F\u76F4\u63A5\u7EE7\u627F\u81EA\u9700\u8981\u88AB\u4EE3\u7406\u7684\u7C7B\uFF1B</li><li><code>CGLib</code>\u751F\u6210\u7684\u4EE3\u7406\u7C7B\u662F\u539F\u6765\u90A3\u4E2A\u7C7B\u7684\u5B50\u7C7B\uFF0C\u8FD9\u5C31\u610F\u5473\u7740\u8FD9\u4E2A\u4EE3\u7406\u7C7B\u53EF\u4EE5\u4E3A\u539F\u6765\u90A3\u4E2A\u7C7B\u4E2D\uFF0C\u6240\u6709\u80FD\u591F\u88AB\u5B50\u7C7B\u91CD\u5199\u7684\u65B9\u6CD5\u8FDB\u884C\u4EE3\u7406\uFF1B</li><li><code>CGLib</code>\u751F\u6210\u7684\u4EE3\u7406\u7C7B\uFF0C\u548C\u6211\u4EEC\u81EA\u5DF1\u7F16\u5199\u5E76\u7F16\u8BD1\u7684\u7C7B\u6CA1\u6709\u592A\u5927\u533A\u522B\uFF0C\u5BF9\u65B9\u6CD5\u7684\u8C03\u7528\u548C\u76F4\u63A5\u8C03\u7528\u666E\u901A\u7C7B\u7684\u65B9\u5F0F\u4E00\u81F4\uFF0C\u6240\u4EE5<code>CGLib</code>\u6267\u884C\u4EE3\u7406\u65B9\u6CD5\u7684\u6548\u7387\u8981\u9AD8\u4E8E<code>JDK</code>\u7684\u52A8\u6001\u4EE3\u7406\uFF1B</li></ol><h3 id="_2-4-\u7F3A\u70B9" tabindex="-1"><a class="header-anchor" href="#_2-4-\u7F3A\u70B9" aria-hidden="true">#</a> <strong>2.4 \u7F3A\u70B9</strong></h3><ol><li>\u7531\u4E8E<code>CGLib</code>\u7684\u4EE3\u7406\u7C7B\u4F7F\u7528\u7684\u662F\u7EE7\u627F\uFF0C\u8FD9\u4E5F\u5C31\u610F\u5473\u7740\u5982\u679C\u9700\u8981\u88AB\u4EE3\u7406\u7684\u7C7B\u662F\u4E00\u4E2A<code>final</code>\u7C7B\uFF0C\u5219\u65E0\u6CD5\u4F7F\u7528<code>CGLib</code>\u4EE3\u7406\uFF1B</li><li>\u7531\u4E8E<code>CGLib</code>\u5B9E\u73B0\u4EE3\u7406\u65B9\u6CD5\u7684\u65B9\u5F0F\u662F\u91CD\u5199\u7236\u7C7B\u7684\u65B9\u6CD5\uFF0C\u6240\u4EE5\u65E0\u6CD5\u5BF9<code>final</code>\u65B9\u6CD5\uFF0C\u6216\u8005<code>private</code>\u65B9\u6CD5\u8FDB\u884C\u4EE3\u7406\uFF0C\u56E0\u4E3A\u5B50\u7C7B\u65E0\u6CD5\u91CD\u5199\u8FD9\u4E9B\u65B9\u6CD5\uFF1B</li><li><code>CGLib</code>\u751F\u6210\u4EE3\u7406\u7C7B\u7684\u65B9\u5F0F\u662F\u901A\u8FC7\u64CD\u4F5C\u5B57\u8282\u7801\uFF0C\u8FD9\u79CD\u65B9\u5F0F\u751F\u6210\u4EE3\u7406\u7C7B\u7684\u901F\u5EA6\u8981\u6BD4<code>JDK</code>\u901A\u8FC7\u53CD\u5C04\u751F\u6210\u4EE3\u7406\u7C7B\u7684\u901F\u5EA6\u66F4\u6162\uFF1B</li></ol><h2 id="_3-cglib\u4EE3\u7406\u7684\u6848\u4F8B" tabindex="-1"><a class="header-anchor" href="#_3-cglib\u4EE3\u7406\u7684\u6848\u4F8B" aria-hidden="true">#</a> 3. Cglib\u4EE3\u7406\u7684\u6848\u4F8B</h2><blockquote><p>\u8FD9\u91CC\u6211\u4EEC\u5199\u4E00\u4E2A\u4F7F\u7528cglib\u7684\u7B80\u5355\u4F8B\u5B50\u3002</p></blockquote><h3 id="_3-1-pom\u5305\u4F9D\u8D56" tabindex="-1"><a class="header-anchor" href="#_3-1-pom\u5305\u4F9D\u8D56" aria-hidden="true">#</a> 3.1 pom\u5305\u4F9D\u8D56</h3><p>\u5F15\u5165cglib\u7684\u4F9D\u8D56\u5305</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>tech-pdai-spring-demos<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>tech.pdai<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">&gt;</span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>007-spring-framework-demo-aop-proxy-cglib<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- https://mvnrepository.com/artifact/cglib/cglib --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>cglib<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>cglib<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.3.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">&gt;</span></span>

  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-2-\u5B9A\u4E49\u5B9E\u4F53" tabindex="-1"><a class="header-anchor" href="#_3-2-\u5B9A\u4E49\u5B9E\u4F53" aria-hidden="true">#</a> 3.2 \u5B9A\u4E49\u5B9E\u4F53</h3><p>User</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">tech<span class="token punctuation">.</span>pdai<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>entity</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> pdai
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>

    <span class="token doc-comment comment">/**
     * user&#39;s name.
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * user&#39;s age.
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> age<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * init.
     *
     * <span class="token keyword">@param</span> <span class="token parameter">name</span> name
     * <span class="token keyword">@param</span> <span class="token parameter">age</span>  age
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token keyword">int</span> age<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> age<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setAge</span><span class="token punctuation">(</span><span class="token keyword">int</span> age<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;User{&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;name=&#39;&quot;</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token char">&#39;\\&#39;&#39;</span> <span class="token operator">+</span>
                <span class="token string">&quot;, age=&quot;</span> <span class="token operator">+</span> age <span class="token operator">+</span>
                <span class="token char">&#39;}&#39;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-3-\u88AB\u4EE3\u7406\u7684\u7C7B" tabindex="-1"><a class="header-anchor" href="#_3-3-\u88AB\u4EE3\u7406\u7684\u7C7B" aria-hidden="true">#</a> 3.3 \u88AB\u4EE3\u7406\u7684\u7C7B</h3><p>\u5373\u76EE\u6807\u7C7B, \u5BF9\u88AB\u4EE3\u7406\u7684\u7C7B\u4E2D\u7684\u65B9\u6CD5\u8FDB\u884C\u589E\u5F3A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">tech<span class="token punctuation">.</span>pdai<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>service</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Collections</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">tech<span class="token punctuation">.</span>pdai<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">User</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> pdai
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserServiceImpl</span> <span class="token punctuation">{</span>

    <span class="token doc-comment comment">/**
     * find user list.
     *
     * <span class="token keyword">@return</span> user list
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">findUserList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">singletonList</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">&quot;pdai&quot;</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * add user
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// do something</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-4-cglib\u4EE3\u7406" tabindex="-1"><a class="header-anchor" href="#_3-4-cglib\u4EE3\u7406" aria-hidden="true">#</a> 3.4 cglib\u4EE3\u7406</h3><p>cglib\u4EE3\u7406\u7C7B\uFF0C\u9700\u8981\u5B9E\u73B0MethodInterceptor\u63A5\u53E3\uFF0C\u5E76\u6307\u5B9A\u4EE3\u7406\u76EE\u6807\u7C7Btarget</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">tech<span class="token punctuation">.</span>pdai<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>proxy</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Method</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">net<span class="token punctuation">.</span>sf<span class="token punctuation">.</span>cglib<span class="token punctuation">.</span>proxy<span class="token punctuation">.</span></span><span class="token class-name">Enhancer</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">net<span class="token punctuation">.</span>sf<span class="token punctuation">.</span>cglib<span class="token punctuation">.</span>proxy<span class="token punctuation">.</span></span><span class="token class-name">MethodInterceptor</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">net<span class="token punctuation">.</span>sf<span class="token punctuation">.</span>cglib<span class="token punctuation">.</span>proxy<span class="token punctuation">.</span></span><span class="token class-name">MethodProxy</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * This class is for proxy demo.
 *
 * <span class="token keyword">@author</span> pdai
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserLogProxy</span> <span class="token keyword">implements</span> <span class="token class-name">MethodInterceptor</span> <span class="token punctuation">{</span>

    <span class="token doc-comment comment">/**
     * \u4E1A\u52A1\u7C7B\u5BF9\u8C61\uFF0C\u4F9B\u4EE3\u7406\u65B9\u6CD5\u4E2D\u8FDB\u884C\u771F\u6B63\u7684\u4E1A\u52A1\u65B9\u6CD5\u8C03\u7528
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">Object</span> target<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">getUserLogProxy</span><span class="token punctuation">(</span><span class="token class-name">Object</span> target<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//\u7ED9\u4E1A\u52A1\u5BF9\u8C61\u8D4B\u503C</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>target <span class="token operator">=</span> target<span class="token punctuation">;</span>
        <span class="token comment">//\u521B\u5EFA\u52A0\u5F3A\u5668\uFF0C\u7528\u6765\u521B\u5EFA\u52A8\u6001\u4EE3\u7406\u7C7B</span>
        <span class="token class-name">Enhancer</span> enhancer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Enhancer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//\u4E3A\u52A0\u5F3A\u5668\u6307\u5B9A\u8981\u4EE3\u7406\u7684\u4E1A\u52A1\u7C7B\uFF08\u5373\uFF1A\u4E3A\u4E0B\u9762\u751F\u6210\u7684\u4EE3\u7406\u7C7B\u6307\u5B9A\u7236\u7C7B\uFF09</span>
        enhancer<span class="token punctuation">.</span><span class="token function">setSuperclass</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>target<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//\u8BBE\u7F6E\u56DE\u8C03\uFF1A\u5BF9\u4E8E\u4EE3\u7406\u7C7B\u4E0A\u6240\u6709\u65B9\u6CD5\u7684\u8C03\u7528\uFF0C\u90FD\u4F1A\u8C03\u7528CallBack\uFF0C\u800CCallback\u5219\u9700\u8981\u5B9E\u73B0intercept()\u65B9\u6CD5\u8FDB\u884C\u62E6</span>
        enhancer<span class="token punctuation">.</span><span class="token function">setCallback</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u521B\u5EFA\u52A8\u6001\u4EE3\u7406\u7C7B\u5BF9\u8C61\u5E76\u8FD4\u56DE</span>
        <span class="token keyword">return</span> enhancer<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// \u5B9E\u73B0\u56DE\u8C03\u65B9\u6CD5</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">intercept</span><span class="token punctuation">(</span><span class="token class-name">Object</span> obj<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">,</span> <span class="token class-name">MethodProxy</span> proxy<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span>
        <span class="token comment">// log - before method</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;[before] execute method: &quot;</span> <span class="token operator">+</span> method<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// call method</span>
        <span class="token class-name">Object</span> result <span class="token operator">=</span> proxy<span class="token punctuation">.</span><span class="token function">invokeSuper</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// log - after method</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;[after] execute method: &quot;</span> <span class="token operator">+</span> method<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;, return value: &quot;</span> <span class="token operator">+</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-5-\u4F7F\u7528\u4EE3\u7406" tabindex="-1"><a class="header-anchor" href="#_3-5-\u4F7F\u7528\u4EE3\u7406" aria-hidden="true">#</a> 3.5 \u4F7F\u7528\u4EE3\u7406</h3><p>\u542F\u52A8\u7C7B\u4E2D\u6307\u5B9A\u4EE3\u7406\u76EE\u6807\u5E76\u6267\u884C\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">tech<span class="token punctuation">.</span>pdai<span class="token punctuation">.</span>springframework</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">tech<span class="token punctuation">.</span>pdai<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>proxy<span class="token punctuation">.</span></span><span class="token class-name">UserLogProxy</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">tech<span class="token punctuation">.</span>pdai<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">UserServiceImpl</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * Cglib proxy demo.
 *
 * <span class="token keyword">@author</span> pdai
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ProxyDemo</span> <span class="token punctuation">{</span>

    <span class="token doc-comment comment">/**
     * main interface.
     *
     * <span class="token keyword">@param</span> <span class="token parameter">args</span> args
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// proxy</span>
        <span class="token class-name">UserServiceImpl</span> userService <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">UserServiceImpl</span><span class="token punctuation">)</span> <span class="token keyword">new</span> <span class="token class-name">UserLogProxy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getUserLogProxy</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">UserServiceImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// call methods</span>
        userService<span class="token punctuation">.</span><span class="token function">findUserList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        userService<span class="token punctuation">.</span><span class="token function">addUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-6-\u7B80\u5355\u6D4B\u8BD5" tabindex="-1"><a class="header-anchor" href="#_2-6-\u7B80\u5355\u6D4B\u8BD5" aria-hidden="true">#</a> 2.6 \u7B80\u5355\u6D4B\u8BD5</h3><p>\u6211\u4EEC\u542F\u52A8\u4E0A\u8FF0\u7C7Bmain \u51FD\u6570\uFF0C\u6267\u884C\u7684\u7ED3\u679C\u5982\u4E0B\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>before<span class="token punctuation">]</span> execute method: findUserList
<span class="token punctuation">[</span>after<span class="token punctuation">]</span> execute method: findUserList, <span class="token builtin class-name">return</span> value: <span class="token punctuation">[</span>User<span class="token punctuation">{</span>name<span class="token operator">=</span><span class="token string">&#39;pdai&#39;</span>, <span class="token assign-left variable">age</span><span class="token operator">=</span><span class="token number">18</span><span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span>before<span class="token punctuation">]</span> execute method: addUser
<span class="token punctuation">[</span>after<span class="token punctuation">]</span> execute method: addUser, <span class="token builtin class-name">return</span> value: null

  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_4-cglib\u4EE3\u7406\u7684\u6D41\u7A0B" tabindex="-1"><a class="header-anchor" href="#_4-cglib\u4EE3\u7406\u7684\u6D41\u7A0B" aria-hidden="true">#</a> 4. Cglib\u4EE3\u7406\u7684\u6D41\u7A0B</h2><p>\u6211\u4EEC\u628A\u4E0A\u8FF0Demo\u7684\u4E3B\u8981\u6D41\u7A0B\u753B\u51FA\u6765\uFF0C\u4F60\u4FBF\u80FD\u5F88\u5FEB\u7406\u89E3</p><p><img src="https://abelsun-1256449468.cos.ap-beijing.myqcloud.com/image/image-20220712222218323.png" alt="image-20220712222218323"></p><p>\u66F4\u591A\u7EC6\u8282\uFF1A</p>`,33),b=n("li",null,"\u5728\u4E0A\u56FE\u4E2D\uFF0C\u6211\u4EEC\u53EF\u4EE5\u901A\u8FC7\u5728Enhancer\u4E2D\u914D\u7F6E\u66F4\u591A\u7684\u53C2\u6570\u6765\u63A7\u5236\u4EE3\u7406\u7684\u884C\u4E3A\uFF0C\u6BD4\u5982\u5982\u679C\u53EA\u5E0C\u671B\u589E\u5F3A\u8FD9\u4E2A\u7C7B\u4E2D\u7684\u4E00\u4E2A\u65B9\u6CD5\uFF08\u800C\u4E0D\u662F\u6240\u6709\u65B9\u6CD5\uFF09\uFF0C\u90A3\u5C31\u589E\u52A0callbackFilter\u6765\u5BF9\u76EE\u6807\u7C7B\u4E2D\u65B9\u6CD5\u8FDB\u884C\u8FC7\u6EE4\uFF1BEnhancer\u53EF\u4EE5\u6709\u66F4\u591A\u7684\u53C2\u6570\u7C7B\u914D\u7F6E\u5176\u884C\u4E3A\uFF0C\u4E0D\u8FC7\u6211\u4EEC\u5728\u5B66\u4E60\u4E0A\u8FF0\u4E3B\u8981\u7684\u6D41\u7A0B\u5C31\u591F\u4E86\u3002",-1),g=n("li",null,"final\u65B9\u6CD5\u4E3A\u4EC0\u4E48\u4E0D\u80FD\u88AB\u4EE3\u7406\uFF1F\u5F88\u663E\u7136final\u65B9\u6CD5\u6CA1\u6CD5\u88AB\u5B50\u7C7B\u8986\u76D6\uFF0C\u5F53\u7136\u4E0D\u80FD\u4EE3\u7406\u4E86\u3002",-1),h={href:"https://pdai.tech/md/develop/ut/dev-ut-x-mockito.html",target:"_blank",rel:"noopener noreferrer"},y=p(`<h2 id="_5-springaop\u4E2Dcglib\u4EE3\u7406\u7684\u5B9E\u73B0" tabindex="-1"><a class="header-anchor" href="#_5-springaop\u4E2Dcglib\u4EE3\u7406\u7684\u5B9E\u73B0" aria-hidden="true">#</a> 5. SpringAOP\u4E2DCglib\u4EE3\u7406\u7684\u5B9E\u73B0</h2><blockquote><p>SpringAOP\u5C01\u88C5\u4E86cglib\uFF0C\u901A\u8FC7\u5176\u8FDB\u884C\u52A8\u6001\u4EE3\u7406\u7684\u521B\u5EFA\u3002</p></blockquote><p>\u6211\u4EEC\u770B\u4E0BCglibAopProxy\u7684getProxy\u65B9\u6CD5</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">getProxy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">getProxy</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">getProxy</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nullable</span> <span class="token class-name">ClassLoader</span> classLoader<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>logger<span class="token punctuation">.</span><span class="token function">isTraceEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    logger<span class="token punctuation">.</span><span class="token function">trace</span><span class="token punctuation">(</span><span class="token string">&quot;Creating CGLIB proxy: &quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>advised<span class="token punctuation">.</span><span class="token function">getTargetSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> rootClass <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>advised<span class="token punctuation">.</span><span class="token function">getTargetClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">state</span><span class="token punctuation">(</span>rootClass <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">&quot;Target class must be available for creating a CGLIB proxy&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u4E0A\u9762\u6D41\u7A0B\u56FE\u4E2D\u7684\u76EE\u6807\u7C7B</span>
    <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> proxySuperClass <span class="token operator">=</span> rootClass<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>rootClass<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token class-name">ClassUtils</span><span class="token punctuation">.</span><span class="token constant">CGLIB_CLASS_SEPARATOR</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      proxySuperClass <span class="token operator">=</span> rootClass<span class="token punctuation">.</span><span class="token function">getSuperclass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> additionalInterfaces <span class="token operator">=</span> rootClass<span class="token punctuation">.</span><span class="token function">getInterfaces</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> additionalInterface <span class="token operator">:</span> additionalInterfaces<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>advised<span class="token punctuation">.</span><span class="token function">addInterface</span><span class="token punctuation">(</span>additionalInterface<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Validate the class, writing log messages as necessary.</span>
    <span class="token function">validateClassIfNecessary</span><span class="token punctuation">(</span>proxySuperClass<span class="token punctuation">,</span> classLoader<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u91CD\u70B9\u770B\u8FD9\u91CC\uFF0C\u5C31\u662F\u4E0A\u56FE\u7684enhancer\uFF0C\u8BBE\u7F6E\u5404\u79CD\u53C2\u6570\u6765\u6784\u5EFA</span>
    <span class="token class-name">Enhancer</span> enhancer <span class="token operator">=</span> <span class="token function">createEnhancer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>classLoader <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      enhancer<span class="token punctuation">.</span><span class="token function">setClassLoader</span><span class="token punctuation">(</span>classLoader<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>classLoader <span class="token keyword">instanceof</span> <span class="token class-name">SmartClassLoader</span> <span class="token operator">&amp;&amp;</span>
          <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">SmartClassLoader</span><span class="token punctuation">)</span> classLoader<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isClassReloadable</span><span class="token punctuation">(</span>proxySuperClass<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        enhancer<span class="token punctuation">.</span><span class="token function">setUseCache</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    enhancer<span class="token punctuation">.</span><span class="token function">setSuperclass</span><span class="token punctuation">(</span>proxySuperClass<span class="token punctuation">)</span><span class="token punctuation">;</span>
    enhancer<span class="token punctuation">.</span><span class="token function">setInterfaces</span><span class="token punctuation">(</span><span class="token class-name">AopProxyUtils</span><span class="token punctuation">.</span><span class="token function">completeProxiedInterfaces</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>advised<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    enhancer<span class="token punctuation">.</span><span class="token function">setNamingPolicy</span><span class="token punctuation">(</span><span class="token class-name">SpringNamingPolicy</span><span class="token punctuation">.</span><span class="token constant">INSTANCE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    enhancer<span class="token punctuation">.</span><span class="token function">setStrategy</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ClassLoaderAwareGeneratorStrategy</span><span class="token punctuation">(</span>classLoader<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u8BBE\u7F6Ecallback\u56DE\u8C03\u63A5\u53E3\uFF0C\u5373\u65B9\u6CD5\u7684\u589E\u5F3A\u70B9</span>
    <span class="token class-name">Callback</span><span class="token punctuation">[</span><span class="token punctuation">]</span> callbacks <span class="token operator">=</span> <span class="token function">getCallbacks</span><span class="token punctuation">(</span>rootClass<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> types <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span>callbacks<span class="token punctuation">.</span>length<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> x <span class="token operator">&lt;</span> types<span class="token punctuation">.</span>length<span class="token punctuation">;</span> x<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      types<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">=</span> callbacks<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// \u4E0A\u8282\u8BF4\u5230\u7684filter</span>
    enhancer<span class="token punctuation">.</span><span class="token function">setCallbackFilter</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ProxyCallbackFilter</span><span class="token punctuation">(</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>advised<span class="token punctuation">.</span><span class="token function">getConfigurationOnlyCopy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>fixedInterceptorMap<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>fixedInterceptorOffset<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    enhancer<span class="token punctuation">.</span><span class="token function">setCallbackTypes</span><span class="token punctuation">(</span>types<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u91CD\u70B9\uFF1A\u521B\u5EFAproxy\u548C\u5176\u5B9E\u4F8B</span>
    <span class="token keyword">return</span> <span class="token function">createProxyClassAndInstance</span><span class="token punctuation">(</span>enhancer<span class="token punctuation">,</span> callbacks<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">CodeGenerationException</span> <span class="token operator">|</span> <span class="token class-name">IllegalArgumentException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">AopConfigException</span><span class="token punctuation">(</span><span class="token string">&quot;Could not generate CGLIB subclass of &quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>advised<span class="token punctuation">.</span><span class="token function">getTargetClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span>
        <span class="token string">&quot;: Common causes of this problem include using a final class or a non-visible class&quot;</span><span class="token punctuation">,</span>
        ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// TargetSource.getTarget() failed</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">AopConfigException</span><span class="token punctuation">(</span><span class="token string">&quot;Unexpected AOP exception&quot;</span><span class="token punctuation">,</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u83B7\u53D6callback\u7684\u65B9\u6CD5\u5982\u4E0B\uFF0C\u63D0\u51E0\u4E2A\u7406\u89E3\u7684\u8981\u70B9\u5427\uFF0C\u5177\u4F53\u8BFB\u8005\u5728\u5B66\u4E60\u7684\u65F6\u5019\u5EFA\u8BAE\u628A\u6211\u7684\u4F8B\u5B50\u8DD1\u4E00\u4E0B\uFF0C\u7136\u540E\u6253\u4E00\u4E2A\u65AD\u70B9\u8FDB\u884C\u7406\u89E3\u3002</p><ul><li><code>rootClass</code>: \u5373\u76EE\u6807\u4EE3\u7406\u7C7B</li><li><code>advised</code>: \u5305\u542B\u4E0A\u6587\u4E2D\u6211\u4EEC\u83B7\u53D6\u5230\u7684advisor\u589E\u5F3A\u5668\u7684\u96C6\u5408</li><li><code>exposeProxy</code>: \u5728xml\u914D\u7F6E\u6587\u4EF6\u4E2D\u914D\u7F6E\u7684\uFF0C\u80CC\u666F\u5C31\u662F\u5982\u679C\u5728\u4E8B\u52A1A\u4E2D\u4F7F\u7528\u4E86\u4EE3\u7406\uFF0C\u4E8B\u52A1A\u8C03\u7528\u4E86\u76EE\u6807\u7C7B\u7684\u7684\u65B9\u6CD5a\uFF0C\u5728\u65B9\u6CD5a\u4E2D\u53C8\u8C03\u7528\u76EE\u6807\u7C7B\u7684\u65B9\u6CD5b\uFF0C\u65B9\u6CD5a\uFF0Cb\u540C\u65F6\u90FD\u662F\u8981\u88AB\u589E\u5F3A\u7684\u65B9\u6CD5\uFF0C\u5982\u679C\u4E0D\u914D\u7F6EexposeProxy\u5C5E\u6027\uFF0C\u65B9\u6CD5b\u7684\u589E\u5F3A\u5C06\u4F1A\u5931\u6548\uFF0C\u5982\u679C\u914D\u7F6EexposeProxy\uFF0C\u65B9\u6CD5b\u5728\u65B9\u6CD5a\u7684\u6267\u884C\u4E2D\u4E5F\u4F1A\u88AB\u589E\u5F3A\u4E86</li><li><code>DynamicAdvisedInterceptor</code>: \u62E6\u622A\u5668\u5C06advised(\u5305\u542B\u4E0A\u6587\u4E2D\u6211\u4EEC\u83B7\u53D6\u5230\u7684advisor\u589E\u5F3A\u5668)\u6784\u5EFA\u914D\u7F6E\u7684AOP\u7684callback\uFF08\u7B2C\u4E00\u4E2Acallback)</li><li><code>targetInterceptor</code>: xml\u914D\u7F6E\u7684optimize\u5C5E\u6027\u4F7F\u7528\u7684\uFF08\u7B2C\u4E8C\u4E2Acallback)</li><li>\u6700\u540E\u8FDE\u540C\u5176\u5B835\u4E2A\u9ED8\u8BA4\u7684Interceptor \u8FD4\u56DE\u4F5C\u4E3Acglib\u7684\u62E6\u622A\u5668\u94FE\uFF0C\u4E4B\u540E\u901A\u8FC7CallbackFilter\u7684accpet\u65B9\u6CD5\u8FD4\u56DE\u7684\u7D22\u5F15\u4ECE\u8FD9\u4E2A\u96C6\u5408\u4E2D\u8FD4\u56DE\u5BF9\u5E94\u7684\u62E6\u622A\u589E\u5F3A\u5668\u6267\u884C\u589E\u5F3A\u64CD\u4F5C\u3002</li></ul><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token class-name">Callback</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getCallbacks</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> rootClass<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
  <span class="token comment">// Parameters used for optimization choices...</span>
  <span class="token keyword">boolean</span> exposeProxy <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>advised<span class="token punctuation">.</span><span class="token function">isExposeProxy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">boolean</span> isFrozen <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>advised<span class="token punctuation">.</span><span class="token function">isFrozen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">boolean</span> isStatic <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>advised<span class="token punctuation">.</span><span class="token function">getTargetSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isStatic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Choose an &quot;aop&quot; interceptor (used for AOP calls).</span>
  <span class="token class-name">Callback</span> aopInterceptor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DynamicAdvisedInterceptor</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>advised<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Choose a &quot;straight to target&quot; interceptor. (used for calls that are</span>
  <span class="token comment">// unadvised but can return this). May be required to expose the proxy.</span>
  <span class="token class-name">Callback</span> targetInterceptor<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>exposeProxy<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    targetInterceptor <span class="token operator">=</span> <span class="token punctuation">(</span>isStatic <span class="token operator">?</span>
        <span class="token keyword">new</span> <span class="token class-name">StaticUnadvisedExposedInterceptor</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>advised<span class="token punctuation">.</span><span class="token function">getTargetSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTarget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">:</span>
        <span class="token keyword">new</span> <span class="token class-name">DynamicUnadvisedExposedInterceptor</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>advised<span class="token punctuation">.</span><span class="token function">getTargetSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">else</span> <span class="token punctuation">{</span>
    targetInterceptor <span class="token operator">=</span> <span class="token punctuation">(</span>isStatic <span class="token operator">?</span>
        <span class="token keyword">new</span> <span class="token class-name">StaticUnadvisedInterceptor</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>advised<span class="token punctuation">.</span><span class="token function">getTargetSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTarget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">:</span>
        <span class="token keyword">new</span> <span class="token class-name">DynamicUnadvisedInterceptor</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>advised<span class="token punctuation">.</span><span class="token function">getTargetSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Choose a &quot;direct to target&quot; dispatcher (used for</span>
  <span class="token comment">// unadvised calls to static targets that cannot return this).</span>
  <span class="token class-name">Callback</span> targetDispatcher <span class="token operator">=</span> <span class="token punctuation">(</span>isStatic <span class="token operator">?</span>
      <span class="token keyword">new</span> <span class="token class-name">StaticDispatcher</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>advised<span class="token punctuation">.</span><span class="token function">getTargetSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTarget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">SerializableNoOp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token class-name">Callback</span><span class="token punctuation">[</span><span class="token punctuation">]</span> mainCallbacks <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Callback</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>
      aopInterceptor<span class="token punctuation">,</span>  <span class="token comment">// </span>
      targetInterceptor<span class="token punctuation">,</span>  <span class="token comment">// invoke target without considering advice, if optimized</span>
      <span class="token keyword">new</span> <span class="token class-name">SerializableNoOp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment">// no override for methods mapped to this</span>
      targetDispatcher<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>advisedDispatcher<span class="token punctuation">,</span>
      <span class="token keyword">new</span> <span class="token class-name">EqualsInterceptor</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>advised<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token keyword">new</span> <span class="token class-name">HashCodeInterceptor</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>advised<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token class-name">Callback</span><span class="token punctuation">[</span><span class="token punctuation">]</span> callbacks<span class="token punctuation">;</span>

  <span class="token comment">// If the target is a static one and the advice chain is frozen,</span>
  <span class="token comment">// then we can make some optimizations by sending the AOP calls</span>
  <span class="token comment">// direct to the target using the fixed chain for that method.</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>isStatic <span class="token operator">&amp;&amp;</span> isFrozen<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Method</span><span class="token punctuation">[</span><span class="token punctuation">]</span> methods <span class="token operator">=</span> rootClass<span class="token punctuation">.</span><span class="token function">getMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Callback</span><span class="token punctuation">[</span><span class="token punctuation">]</span> fixedCallbacks <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Callback</span><span class="token punctuation">[</span>methods<span class="token punctuation">.</span>length<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>fixedInterceptorMap <span class="token operator">=</span> <span class="token class-name">CollectionUtils</span><span class="token punctuation">.</span><span class="token function">newHashMap</span><span class="token punctuation">(</span>methods<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// TODO: small memory optimization here (can skip creation for methods with no advice)</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> x <span class="token operator">&lt;</span> methods<span class="token punctuation">.</span>length<span class="token punctuation">;</span> x<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token class-name">Method</span> method <span class="token operator">=</span> methods<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> chain <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>advised<span class="token punctuation">.</span><span class="token function">getInterceptorsAndDynamicInterceptionAdvice</span><span class="token punctuation">(</span>method<span class="token punctuation">,</span> rootClass<span class="token punctuation">)</span><span class="token punctuation">;</span>
      fixedCallbacks<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FixedChainStaticTargetInterceptor</span><span class="token punctuation">(</span>
          chain<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>advised<span class="token punctuation">.</span><span class="token function">getTargetSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTarget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>advised<span class="token punctuation">.</span><span class="token function">getTargetClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>fixedInterceptorMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>method<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Now copy both the callbacks from mainCallbacks</span>
    <span class="token comment">// and fixedCallbacks into the callbacks array.</span>
    callbacks <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Callback</span><span class="token punctuation">[</span>mainCallbacks<span class="token punctuation">.</span>length <span class="token operator">+</span> fixedCallbacks<span class="token punctuation">.</span>length<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">arraycopy</span><span class="token punctuation">(</span>mainCallbacks<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> callbacks<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> mainCallbacks<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">arraycopy</span><span class="token punctuation">(</span>fixedCallbacks<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> callbacks<span class="token punctuation">,</span> mainCallbacks<span class="token punctuation">.</span>length<span class="token punctuation">,</span> fixedCallbacks<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>fixedInterceptorOffset <span class="token operator">=</span> mainCallbacks<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">else</span> <span class="token punctuation">{</span>
    callbacks <span class="token operator">=</span> mainCallbacks<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> callbacks<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u53EF\u4EE5\u7ED3\u5408\u8C03\u8BD5\uFF0C\u65B9\u4FBF\u7406\u89E3</p><p><img src="https://abelsun-1256449468.cos.ap-beijing.myqcloud.com/image/image-20220712222722215.png" alt="image-20220712222722215"></p><h2 id="\u53C2\u8003\u6587\u7AE0" tabindex="-1"><a class="header-anchor" href="#\u53C2\u8003\u6587\u7AE0" aria-hidden="true">#</a> \u53C2\u8003\u6587\u7AE0</h2>`,10),f={href:"https://pdai.tech/md/spring/spring-x-framework-aop-source-3.html",target:"_blank",rel:"noopener noreferrer"},w=n("strong",null,"Spring\u8FDB\u9636 - Spring AOP\u5B9E\u73B0\u539F\u7406\u8BE6\u89E3\u4E4BCglib\u4EE3\u7406\u5B9E\u73B0",-1);function x(C,S){const a=l("ExternalLinkIcon");return c(),o("div",null,[u,n("ul",null,[n("li",null,[s("\u6700\u5E95\u5C42\u662F\u5B57\u8282\u7801\uFF0C\u5B57\u8282\u7801\u76F8\u5173\u7684\u77E5\u8BC6\u8BF7\u53C2\u8003 "),n("a",k,[s("JVM\u57FA\u7840 - \u7C7B\u5B57\u8282\u7801\u8BE6\u89E3"),t(a)])]),r,d,m]),v,n("ul",null,[b,g,n("li",null,[s("Mockito\u4E3A\u4EC0\u4E48\u4E0D\u80FDmock\u9759\u6001\u65B9\u6CD5\uFF1F\u56E0\u4E3Amockito\u4E5F\u662F\u57FA\u4E8Ecglib\u52A8\u6001\u4EE3\u7406\u6765\u5B9E\u73B0\u7684\uFF0Cstatic\u65B9\u6CD5\u4E5F\u4E0D\u80FD\u88AB\u5B50\u7C7B\u8986\u76D6\uFF0C\u6240\u4EE5\u663E\u7136\u4E0D\u80FDmock\u3002\u4F46PowerMock\u53EF\u4EE5mock\u9759\u6001\u65B9\u6CD5\uFF0C\u56E0\u4E3A\u5B83\u76F4\u63A5\u5728bytecode\u4E0A\u5DE5\u4F5C\uFF0C\u66F4\u591A\u53EF\u4EE5\u770B"),n("a",h,[s("Mockito\u5355\u5143\u6D4B\u8BD5"),t(a)]),s("\u3002\uFF08pdai: \u901A\u4E86\u6CA1\uFF1F\u662F\u4E0D\u662Fso easy...\uFF09")])]),y,n("p",null,[n("a",f,[w,t(a)])])])}const I=e(i,[["render",x],["__file","spring-x-framework-aop-source-3.html.vue"]]);export{I as default};
