import{_ as a}from"./_plugin-vue_export-helper.cdc0426e.js";import{o as t,c as p,a as n,b as e,d as c,f as o,r as l}from"./app.0140ae5b.js";const i={},u=o(`<h1 id="\u6570\u636E\u6743\u9650\u529F\u80FD-\u5B9E\u73B0\u601D\u8DEF" tabindex="-1"><a class="header-anchor" href="#\u6570\u636E\u6743\u9650\u529F\u80FD-\u5B9E\u73B0\u601D\u8DEF" aria-hidden="true">#</a> \u6570\u636E\u6743\u9650\u529F\u80FD&amp;\u5B9E\u73B0\u601D\u8DEF</h1><h2 id="_1-\u80CC\u666F" tabindex="-1"><a class="header-anchor" href="#_1-\u80CC\u666F" aria-hidden="true">#</a> 1. \u80CC\u666F</h2><p>\u5728\u5B9E\u9645\u5F00\u53D1\u4E2D\uFF0C\u9700\u8981\u8BBE\u7F6E\u7528\u6237\u53EA\u80FD\u67E5\u770B\u54EA\u4E9B\u90E8\u95E8\u7684\u6570\u636E\uFF0C\u8FD9\u79CD\u60C5\u51B5\u4E00\u822C\u79F0\u4E3A\u6570\u636E\u6743\u9650\u3002\u4F8B\u5982</p><ul><li>\u9500\u552E\uFF0C\u8D22\u52A1\u7684\u6570\u636E\uFF0C\u5B83\u4EEC\u662F\u975E\u5E38\u654F\u611F\u7684\uFF0C\u56E0\u6B64\u8981\u6C42\u5BF9\u6570\u636E\u6743\u9650\u8FDB\u884C\u63A7\u5236</li><li>\u57FA\u4E8E\u96C6\u56E2\u6027\u7684\u5E94\u7528\u7CFB\u7EDF\u800C\u8A00\uFF0C\u5C31\u66F4\u591A\u9700\u8981\u63A7\u5236\u597D\u5404\u81EA\u516C\u53F8\u6570\u636E\u4E86\uFF0C <ul><li>\u5982\u8BBE\u7F6E\u53EA\u80FD\u67E5\u770B\u672C\u516C\u53F8\u3001\u6216\u8005\u672C\u90E8\u95E8\u7684\u6570\u636E</li><li>\u5BF9\u4E8E\u7279\u6B8A\u9886\u5BFC\uFF0C\u53EF\u80FD\u9700\u8981\u8DE8\u90E8\u95E8\u7684\u6570\u636E</li></ul></li></ul><p>\u56E0\u6B64\u7A0B\u5E8F\u4E0D\u80FD\u786C\u7F16\u7801\u54EA\u4E2A\u9886\u5BFC\u8BE5\u8BBF\u95EE\u90A3\u4E9B\u6570\u636E\uFF0C\u9700\u8981\u8FDB\u884C\u540E\u53F0\u7684\u6743\u9650\u548C\u6570\u636E\u6743\u9650\u7684\u63A7\u5236\u3002</p><blockquote><p>\u63D0\u793A</p><p>\u9ED8\u8BA4\u7CFB\u7EDF\u7BA1\u7406\u5458<code>admin</code>\u62E5\u6709\u6240\u6709\u6570\u636E\u6743\u9650<code>\uFF08userId=1\uFF09</code>\uFF0C\u9ED8\u8BA4\u89D2\u8272\u62E5\u6709\u6240\u6709\u6570\u636E\u6743\u9650\uFF08\u5982\u4E0D\u9700\u8981\u6570\u636E\u6743\u9650\u4E0D\u7528\u8BBE\u7F6E\u6570\u636E\u6743\u9650\u64CD\u4F5C\uFF09</p></blockquote><h2 id="_2-\u6CE8\u89E3\u53C2\u6570\u8BF4\u660E" tabindex="-1"><a class="header-anchor" href="#_2-\u6CE8\u89E3\u53C2\u6570\u8BF4\u660E" aria-hidden="true">#</a> 2.\u6CE8\u89E3\u53C2\u6570\u8BF4\u660E</h2><table><thead><tr><th>\u53C2\u6570</th><th>\u7C7B\u578B</th><th>\u9ED8\u8BA4\u503C</th><th>\u63CF\u8FF0</th></tr></thead><tbody><tr><td>deptAlias</td><td>String</td><td>\u7A7A</td><td>\u90E8\u95E8\u8868\u7684\u522B\u540D</td></tr><tr><td>userAlias</td><td>String</td><td>\u7A7A</td><td>\u7528\u6237\u8868\u7684\u522B\u540D</td></tr></tbody></table><h2 id="_3-\u6570\u636E\u6743\u9650\u4F7F\u7528" tabindex="-1"><a class="header-anchor" href="#_3-\u6570\u636E\u6743\u9650\u4F7F\u7528" aria-hidden="true">#</a> 3. \u6570\u636E\u6743\u9650\u4F7F\u7528</h2><p>1\u3001\u5728\uFF08\u7CFB\u7EDF\u7BA1\u7406-\u89D2\u8272\u7BA1\u7406\uFF09\u8BBE\u7F6E\u9700\u8981\u6570\u636E\u6743\u9650\u7684\u89D2\u8272 \u76EE\u524D\u652F\u6301\u4EE5\u4E0B\u51E0\u79CD\u6743\u9650</p><ul><li>\u5168\u90E8\u6570\u636E\u6743\u9650</li><li>\u81EA\u5B9A\u6570\u636E\u6743\u9650</li><li>\u90E8\u95E8\u6570\u636E\u6743\u9650</li><li>\u90E8\u95E8\u53CA\u4EE5\u4E0B\u6570\u636E\u6743\u9650</li><li>\u4EC5\u672C\u4EBA\u6570\u636E\u6743\u9650</li></ul><p>2\u3001\u5728\u9700\u8981\u6570\u636E\u6743\u9650\u63A7\u5236\u65B9\u6CD5\u4E0A\u6DFB\u52A0<code>@DataScope</code>\u6CE8\u89E3\uFF0C\u5176\u4E2D<code>d</code>\u548C<code>u</code>\u7528\u6765\u8868\u793A\u8868\u7684\u522B\u540D</p><p><strong>\u90E8\u95E8\u6570\u636E\u6743\u9650\u6CE8\u89E3</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@DataScope</span><span class="token punctuation">(</span>deptAlias <span class="token operator">=</span> <span class="token string">&quot;d&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">&gt;</span></span> <span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> mapper<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>\u90E8\u95E8\u53CA\u7528\u6237\u6743\u9650\u6CE8\u89E3</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@DataScope</span><span class="token punctuation">(</span>deptAlias <span class="token operator">=</span> <span class="token string">&quot;d&quot;</span><span class="token punctuation">,</span> userAlias <span class="token operator">=</span> <span class="token string">&quot;u&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">&gt;</span></span> <span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> mapper<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>3\u3001\u5728<code>mybatis</code>\u67E5\u8BE2\u5E95\u90E8\u6807\u7B7E\u6DFB\u52A0\u6570\u636E\u8303\u56F4\u8FC7\u6EE4</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>select<span class="token punctuation">&quot;</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>...<span class="token punctuation">&quot;</span></span> <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>...Result<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>include</span> <span class="token attr-name">refid</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>select...Vo<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token comment">&lt;!-- \u6570\u636E\u8303\u56F4\u8FC7\u6EE4 --&gt;</span>
    \${params.dataScope}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4F8B\u5982\uFF1A\u7528\u6237\u7BA1\u7406\uFF08\u672A\u8FC7\u6EE4\u6570\u636E\u6743\u9650\u7684\u60C5\u51B5\uFF09\uFF1A</p><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">select</span> u<span class="token punctuation">.</span>user_id<span class="token punctuation">,</span> u<span class="token punctuation">.</span>dept_id<span class="token punctuation">,</span> u<span class="token punctuation">.</span>login_name<span class="token punctuation">,</span> u<span class="token punctuation">.</span>user_name<span class="token punctuation">,</span> u<span class="token punctuation">.</span>email
	<span class="token punctuation">,</span> u<span class="token punctuation">.</span>phonenumber<span class="token punctuation">,</span> u<span class="token punctuation">.</span>password<span class="token punctuation">,</span> u<span class="token punctuation">.</span>sex<span class="token punctuation">,</span> u<span class="token punctuation">.</span>avatar<span class="token punctuation">,</span> u<span class="token punctuation">.</span>salt
	<span class="token punctuation">,</span> u<span class="token punctuation">.</span><span class="token keyword">status</span><span class="token punctuation">,</span> u<span class="token punctuation">.</span>del_flag<span class="token punctuation">,</span> u<span class="token punctuation">.</span>login_ip<span class="token punctuation">,</span> u<span class="token punctuation">.</span>login_date<span class="token punctuation">,</span> u<span class="token punctuation">.</span>create_by
	<span class="token punctuation">,</span> u<span class="token punctuation">.</span>create_time<span class="token punctuation">,</span> u<span class="token punctuation">.</span>remark<span class="token punctuation">,</span> d<span class="token punctuation">.</span>dept_name
<span class="token keyword">from</span> sys_user u
	<span class="token keyword">left</span> <span class="token keyword">join</span> sys_dept d <span class="token keyword">on</span> u<span class="token punctuation">.</span>dept_id <span class="token operator">=</span> d<span class="token punctuation">.</span>dept_id
<span class="token keyword">where</span> u<span class="token punctuation">.</span>del_flag <span class="token operator">=</span> <span class="token string">&#39;0&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4F8B\u5982\uFF1A\u7528\u6237\u7BA1\u7406\uFF08\u5DF2\u8FC7\u6EE4\u6570\u636E\u6743\u9650\u7684\u60C5\u51B5\uFF09\uFF1A</p><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">select</span> u<span class="token punctuation">.</span>user_id<span class="token punctuation">,</span> u<span class="token punctuation">.</span>dept_id<span class="token punctuation">,</span> u<span class="token punctuation">.</span>login_name<span class="token punctuation">,</span> u<span class="token punctuation">.</span>user_name<span class="token punctuation">,</span> u<span class="token punctuation">.</span>email
	<span class="token punctuation">,</span> u<span class="token punctuation">.</span>phonenumber<span class="token punctuation">,</span> u<span class="token punctuation">.</span>password<span class="token punctuation">,</span> u<span class="token punctuation">.</span>sex<span class="token punctuation">,</span> u<span class="token punctuation">.</span>avatar<span class="token punctuation">,</span> u<span class="token punctuation">.</span>salt
	<span class="token punctuation">,</span> u<span class="token punctuation">.</span><span class="token keyword">status</span><span class="token punctuation">,</span> u<span class="token punctuation">.</span>del_flag<span class="token punctuation">,</span> u<span class="token punctuation">.</span>login_ip<span class="token punctuation">,</span> u<span class="token punctuation">.</span>login_date<span class="token punctuation">,</span> u<span class="token punctuation">.</span>create_by
	<span class="token punctuation">,</span> u<span class="token punctuation">.</span>create_time<span class="token punctuation">,</span> u<span class="token punctuation">.</span>remark<span class="token punctuation">,</span> d<span class="token punctuation">.</span>dept_name
<span class="token keyword">from</span> sys_user u
	<span class="token keyword">left</span> <span class="token keyword">join</span> sys_dept d <span class="token keyword">on</span> u<span class="token punctuation">.</span>dept_id <span class="token operator">=</span> d<span class="token punctuation">.</span>dept_id
<span class="token keyword">where</span> u<span class="token punctuation">.</span>del_flag <span class="token operator">=</span> <span class="token string">&#39;0&#39;</span>
	<span class="token operator">and</span> u<span class="token punctuation">.</span>dept_id <span class="token operator">in</span> <span class="token punctuation">(</span>
		<span class="token keyword">select</span> dept_id
		<span class="token keyword">from</span> sys_role_dept
		<span class="token keyword">where</span> role_id <span class="token operator">=</span> <span class="token number">2</span>
	<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u7ED3\u679C\u5F88\u660E\u663E\uFF0C\u6211\u4EEC\u591A\u4E86\u5982\u4E0B\u8BED\u53E5\u3002\u901A\u8FC7\u89D2\u8272\u90E8\u95E8\u8868<code>\uFF08sys_role_dept\uFF09</code>\u5B8C\u6210\u4E86\u6570\u636E\u6743\u9650\u8FC7\u6EE4</p><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token operator">and</span> u<span class="token punctuation">.</span>dept_id <span class="token operator">in</span> <span class="token punctuation">(</span>
	<span class="token keyword">select</span> dept_id
	<span class="token keyword">from</span> sys_role_dept
	<span class="token keyword">where</span> role_id <span class="token operator">=</span> <span class="token number">2</span>
<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u903B\u8F91\u5B9E\u73B0\u4EE3\u7801 <code>com.ruoyi.framework.aspectj.DataScopeAspect</code></p><blockquote><p>\u63D0\u793A</p><p>\u4EC5\u5B9E\u4F53\u7EE7\u627F<code>BaseEntity</code>\u624D\u4F1A\u8FDB\u884C\u5904\u7406\uFF0C<code>SQL</code>\u8BED\u53E5\u4F1A\u5B58\u653E\u5230<code>BaseEntity</code>\u5BF9\u8C61\u4E2D\u7684<code>params</code>\u5C5E\u6027\u4E2D\uFF0C\u7136\u540E\u5728<code>xml</code>\u4E2D\u901A\u8FC7<code>\${params.dataScope}</code>\u83B7\u53D6\u62FC\u63A5\u540E\u7684\u8BED\u53E5\u3002</p></blockquote><h2 id="_4-\u5B9E\u73B0\u601D\u8DEF" tabindex="-1"><a class="header-anchor" href="#_4-\u5B9E\u73B0\u601D\u8DEF" aria-hidden="true">#</a> 4. \u5B9E\u73B0\u601D\u8DEF</h2><h3 id="_4-1-\u9488\u5BF9\u90A3\u4E9B\u6570\u636E\u8FDB\u884C\u6743\u9650\u63A7\u5236" tabindex="-1"><a class="header-anchor" href="#_4-1-\u9488\u5BF9\u90A3\u4E9B\u6570\u636E\u8FDB\u884C\u6743\u9650\u63A7\u5236" aria-hidden="true">#</a> 4.1 \u9488\u5BF9\u90A3\u4E9B\u6570\u636E\u8FDB\u884C\u6743\u9650\u63A7\u5236\uFF1F</h3><p>\u6211\u4EEC\u5728\u89D2\u8272\u7BA1\u7406\u4E2D\u5206\u914D\u8BE5\u89D2\u8272\u7528\u6237\u7684\u6570\u636E\u6743\u9650\uFF0C\u4F46\u5E76\u4E0D\u662F\u6240\u6709\u63A5\u53E3\u90FD\u9700\u8981\u63A7\u5236\u6570\u636E\u6743\u9650\uFF0C**\u6240\u4EE5\u9488\u5BF9\u9700\u8981\u63A7\u5236\u6570\u636E\u6743\u9650\u7684\u63A5\u53E3\uFF0C\u6211\u4EEC\u9700\u8981\u5B9A\u4E49\u4E00\u4E2A\u6CE8\u89E3 ** - <code>@DataScope</code></p><p>\u6211\u4EEC\u901A\u8FC7 <code>@DataScope</code> \u5C31\u53EF\u4EE5\u901A\u8FC7aop\u62E6\u622A\u5230\u8BE5\u8BF7\u6C42\u4E86</p><h3 id="_4-2-\u4E0D\u540C\u6743\u9650\u60C5\u51B5\u8981\u5982\u4F55\u5904\u7406" tabindex="-1"><a class="header-anchor" href="#_4-2-\u4E0D\u540C\u6743\u9650\u60C5\u51B5\u8981\u5982\u4F55\u5904\u7406" aria-hidden="true">#</a> 4.2 \u4E0D\u540C\u6743\u9650\u60C5\u51B5\u8981\u5982\u4F55\u5904\u7406\uFF1F</h3><p>\u6211\u4EEC\u62E5\u6709\u591A\u79CD\u6570\u636E\u6743\u9650\u7C7B\u578B\uFF0C\u6BCF\u79CD\u7C7B\u578B\u7684\u8FC7\u6EE4\u60C5\u51B5\u5E76\u4E0D\u76F8\u540C</p><ol><li><p>\u5168\u90E8\u6570\u636E\u6743\u9650</p><p>\u4E0D\u6DFB\u52A0sql</p></li><li><p>\u81EA\u5B9A\u6570\u636E\u6743\u9650</p><p>\u6839\u636E\u89D2\u8272id\uFF0C\u8FC7\u6EE4\u51FA\u9009\u5B9A\u7684\u90E8\u95E8</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code> sqlString<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>
                        <span class="token string">&quot; OR {}.dept_id IN ( SELECT dept_id FROM sys_role_dept WHERE role_id = {} ) &quot;</span><span class="token punctuation">,</span> deptAlias<span class="token punctuation">,</span>
                        role<span class="token punctuation">.</span><span class="token function">getRoleId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>\u90E8\u95E8\u6570\u636E\u6743\u9650</p><p>\u76F4\u63A5\u8FC7\u6EE4\u51FA\u81EA\u8EAB\u7684\u8FC7\u6EE4\u6743\u9650</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>sqlString<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot; OR {}.dept_id = {} &quot;</span><span class="token punctuation">,</span> deptAlias<span class="token punctuation">,</span> user<span class="token punctuation">.</span><span class="token function">getDeptId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>\u90E8\u95E8\u53CA\u4EE5\u4E0B\u6570\u636E\u6743\u9650</p><p>\u67E5\u627E\u7684\u65F6\u5019\uFF0C\u76F4\u63A5\u8FC7\u6EE4\u51FA\u90E8\u95E8\u7EA7\u4EE5\u4E0B</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>sqlString<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>
                        <span class="token string">&quot; OR {}.dept_id IN ( SELECT dept_id FROM sys_dept WHERE dept_id = {} or find_in_set( {} , ancestors ) )&quot;</span><span class="token punctuation">,</span>
                        deptAlias<span class="token punctuation">,</span> user<span class="token punctuation">.</span><span class="token function">getDeptId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> user<span class="token punctuation">.</span><span class="token function">getDeptId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>\u4EC5\u672C\u4EBA\u6570\u636E\u6743\u9650</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isNotBlank</span><span class="token punctuation">(</span>userAlias<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                    sqlString<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot; OR {}.user_id = {} &quot;</span><span class="token punctuation">,</span> userAlias<span class="token punctuation">,</span> user<span class="token punctuation">.</span><span class="token function">getUserId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">else</span>
                <span class="token punctuation">{</span>
                    <span class="token comment">// \u6570\u636E\u6743\u9650\u4E3A\u4EC5\u672C\u4EBA\u4E14\u6CA1\u6709userAlias\u522B\u540D\u4E0D\u67E5\u8BE2\u4EFB\u4F55\u6570\u636E</span>
                    sqlString<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot; OR 1=0 &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><h3 id="_4-3-\u62FC\u63A5\u65F6\u5173\u8054\u8868\u7684\u522B\u540D" tabindex="-1"><a class="header-anchor" href="#_4-3-\u62FC\u63A5\u65F6\u5173\u8054\u8868\u7684\u522B\u540D" aria-hidden="true">#</a> 4.3 \u62FC\u63A5\u65F6\u5173\u8054\u8868\u7684\u522B\u540D</h3><p>\u6211\u4EEC\u770B\u5230\u62FC\u63A5\u8BED\u53E5\u4E0A\uFF0C\u90FD\u662F\u9700\u8981\u5173\u8054\u8868\u7684\uFF0C\u8FD9\u4E9Bsql \u8BED\u53E5\u6211\u4EEC\u662F\u5199\u5728mybatis\u8BED\u53E5\u4E2D\u7684\uFF0C\u6211\u4EEC\u4E0D\u80FD\u4FDD\u8BC1\u6240\u6709\u7684\u4EBA\uFF0Cuser\u8868\u522B\u540D\u662Fu\uFF0C\u90E8\u95E8\u8868\u90FD\u662Fd\u3002\u6240\u4EE5\u6211\u4EEC\u9700\u8981\u5C06\u5B9A\u4E49\u7684\u522B\u540D\u4F20\u9012\u8FDB\u6765</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * \u6570\u636E\u6743\u9650\u8FC7\u6EE4\u6CE8\u89E3
 * 
 * <span class="token keyword">@author</span> ygn
 */</span>
<span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">METHOD</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span><span class="token constant">RUNTIME</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Documented</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">DataScope</span>
<span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * \u90E8\u95E8\u8868\u7684\u522B\u540D
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">deptAlias</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * \u7528\u6237\u8868\u7684\u522B\u540D
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">userAlias</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-4-\u5982\u4F55\u62FC\u63A5\u4E0Asql" tabindex="-1"><a class="header-anchor" href="#_4-4-\u5982\u4F55\u62FC\u63A5\u4E0Asql" aria-hidden="true">#</a> 4.4 \u5982\u4F55\u62FC\u63A5\u4E0ASQL</h3><p>\u6709\u4E86\u8FC7\u6EE4\u7684sql\u8BED\u53E5\u540E\uFF0C\u600E\u4E48\u62FC\u88C5\u4E0A\u5462\uFF1F</p><p>\u6211\u4EEC\u77E5\u9053\u6211\u4EECmybayis \u53C2\u6570\u662F\u901A\u8FC7\u5B9E\u4F53\u7C7B\u6765\u7684\uFF0C\u90A3\u4E48\u6211\u4EEC\u5728BaseEntity \u5B9A\u4E49\u4E86\u6269\u5C55\u53C2\u6570\u5C31\u6D3E\u4E0A\u4E86\u7528\u573A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BaseEntity</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span>
<span class="token punctuation">{</span>
		<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
		<span class="token doc-comment comment">/** \u8BF7\u6C42\u53C2\u6570 */</span>
		<span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> params<span class="token punctuation">;</span>
		
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6211\u4EEC\u5BF9\u8FD9\u4E2A\u53C2\u6570\u6DFB\u52A0\u6211\u4EEC\u7684\u6743\u9650\u53C2\u6570</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * \u6570\u636E\u6743\u9650\u8FC7\u6EE4\u5173\u952E\u5B57
 */</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">DATA_SCOPE</span> <span class="token operator">=</span> <span class="token string">&quot;dataScope&quot;</span><span class="token punctuation">;</span>


<span class="token doc-comment comment">/**
 * \u62FC\u63A5\u6743\u9650sql\u524D\u5148\u6E05\u7A7Aparams.dataScope\u53C2\u6570\u9632\u6B62\u6CE8\u5165
 */</span>
<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">clearDataScope</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">JoinPoint</span> joinPoint<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name">Object</span> params <span class="token operator">=</span> joinPoint<span class="token punctuation">.</span><span class="token function">getArgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isNotNull</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> params <span class="token keyword">instanceof</span> <span class="token class-name">BaseEntity</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">BaseEntity</span> baseEntity <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">BaseEntity</span><span class="token punctuation">)</span> params<span class="token punctuation">;</span>
        baseEntity<span class="token punctuation">.</span><span class="token function">getParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token constant">DATA_SCOPE</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-5-\u5177\u4F53\u4F7F\u7528" tabindex="-1"><a class="header-anchor" href="#_4-5-\u5177\u4F53\u4F7F\u7528" aria-hidden="true">#</a> 4.5 \u5177\u4F53\u4F7F\u7528</h3><p>\u5177\u4F53\u4F7F\u7528\uFF0C\u8FD8\u662F\u9700\u8981\u5728\u5E95\u90E8\u6DFB\u52A0\u4E0A\u5F15\u7528<code>dataScope</code> \u7684\u8BED\u53E5</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>select<span class="token punctuation">&quot;</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>...<span class="token punctuation">&quot;</span></span> <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>...Result<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>include</span> <span class="token attr-name">refid</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>select...Vo<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token comment">&lt;!-- \u6570\u636E\u8303\u56F4\u8FC7\u6EE4 --&gt;</span>
    \${params.dataScope}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_5-\u5177\u4F53\u5B9E\u73B0" tabindex="-1"><a class="header-anchor" href="#_5-\u5177\u4F53\u5B9E\u73B0" aria-hidden="true">#</a> 5. \u5177\u4F53\u5B9E\u73B0</h2><h3 id="_5-1-\u6570\u636E\u6743\u9650\u8FC7\u6EE4\u6CE8\u89E3" tabindex="-1"><a class="header-anchor" href="#_5-1-\u6570\u636E\u6743\u9650\u8FC7\u6EE4\u6CE8\u89E3" aria-hidden="true">#</a> 5.1 \u6570\u636E\u6743\u9650\u8FC7\u6EE4\u6CE8\u89E3</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * \u6570\u636E\u6743\u9650\u8FC7\u6EE4\u6CE8\u89E3
 * 
 * <span class="token keyword">@author</span> ygn
 */</span>
<span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">METHOD</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span><span class="token constant">RUNTIME</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Documented</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">DataScope</span>
<span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * \u90E8\u95E8\u8868\u7684\u522B\u540D
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">deptAlias</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * \u7528\u6237\u8868\u7684\u522B\u540D
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">userAlias</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="\u53C2\u8003\u6587\u7AE0" tabindex="-1"><a class="header-anchor" href="#\u53C2\u8003\u6587\u7AE0" aria-hidden="true">#</a> \u53C2\u8003\u6587\u7AE0</h2>`,49),d={href:"https://doc.ruoyi.vip/ruoyi/document/htsc.html#%E6%95%B0%E6%8D%AE%E6%9D%83%E9%99%90",target:"_blank",rel:"noopener noreferrer"};function r(k,v){const s=l("ExternalLinkIcon");return t(),p("div",null,[u,n("p",null,[n("a",d,[e("\u82E5\u4F9D\u5B98\u65B9\u6587\u6863"),c(s)])])])}const g=a(i,[["render",r],["__file","manage-system-data-scope.html.vue"]]);export{g as default};
