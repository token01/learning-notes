import{_ as l}from"./_plugin-vue_export-helper.cdc0426e.js";import{o as t,c,a as n,b as s,d as a,f as i,r as o}from"./app.f5d9e013.js";const d={},p=i(`<h1 id="nginx-\u5165\u95E8\u5B9E\u6218" tabindex="-1"><a class="header-anchor" href="#nginx-\u5165\u95E8\u5B9E\u6218" aria-hidden="true">#</a> Nginx \u5165\u95E8\u5B9E\u6218</h1><h2 id="\u7B80\u4ECB" tabindex="-1"><a class="header-anchor" href="#\u7B80\u4ECB" aria-hidden="true">#</a> \u7B80\u4ECB</h2><blockquote><p>\u4EC0\u4E48\u662Fnginx</p></blockquote><p>Nginx\u662F\u4E00\u4E2A\u9AD8\u6027\u80FD\u7684HTTP\u548C\u53CD\u5411\u4EE3\u7406web\u670D\u52A1\u5668</p><blockquote><p>\u5B89\u88C5\u8981\u6C42</p></blockquote><ul><li><p><code>linux</code>\u5185\u68382.6\u53CA\u4EE5\u4E0A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">uname</span> <span class="token parameter variable">-a</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>\u5173\u95ED\u9632\u706B\u5899</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># \u4E34\u65F6\u5173\u95ED\u9632\u706B\u5899</span>
systemctl stop firewalld
<span class="token comment"># \u6C38\u4E45\u5173\u95ED\u9632\u706B\u5899</span>
systemctl disable firewalld
<span class="token comment"># \u67E5\u770B\u9632\u706B\u5899\u72B6\u6001</span>
systemctl status firewalld
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h3 id="\u5B89\u88C5nginx" tabindex="-1"><a class="header-anchor" href="#\u5B89\u88C5nginx" aria-hidden="true">#</a> \u5B89\u88C5nginx</h3><h4 id="\u6E90\u7801\u5B89\u88C5" tabindex="-1"><a class="header-anchor" href="#\u6E90\u7801\u5B89\u88C5" aria-hidden="true">#</a> \u6E90\u7801\u5B89\u88C5</h4><blockquote><p>\u521B\u5EFA\u6587\u4EF6\u5939</p></blockquote><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">mkdir</span> /data
<span class="token builtin class-name">cd</span> /data
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>\u5B89\u88C5\u4F9D\u8D56</p></blockquote><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>yum <span class="token function">install</span> <span class="token parameter variable">-y</span> gcc pcre-devel zlib-devel openssl-devel
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote><p>\u4E0B\u8F7Dnginx</p></blockquote><ul><li><p>\u5B98\u7F51\u4E0B\u8F7D<code>http://nginx.org/en/download.html</code></p></li><li><p>\u76F4\u63A5\u5728\u670D\u52A1\u5668\u4E0B\u8F7D</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">wget</span> https://nginx.org/download/nginx-1.22.0.tar.gz
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ul><blockquote><p>\u8FDB\u884C\u914D\u7F6E</p></blockquote><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>./configure <span class="token punctuation">\\</span>
<span class="token parameter variable">--prefix</span><span class="token operator">=</span>/usr/local/nginx <span class="token punctuation">\\</span>
--sbin-path<span class="token operator">=</span>/usr/local/nginx/sbin/nginx <span class="token punctuation">\\</span>
--modules-path<span class="token operator">=</span>/usr/local/nginx/modules <span class="token punctuation">\\</span>
--conf-path<span class="token operator">=</span>/usr/local/nginx/conf/nginx.conf <span class="token punctuation">\\</span>
--error-log-path<span class="token operator">=</span>/usr/local/nginx/logs/error.log <span class="token punctuation">\\</span>
--http-log-path<span class="token operator">=</span>/usr/local/nginx/logs/access.log <span class="token punctuation">\\</span>
--pid-path<span class="token operator">=</span>/usr/local/nginx/logs/nginx.pid
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p>\u914D\u7F6E\u6587\u4EF6\u8BE6\u89E3</p><table><thead><tr><th>--prefix=PATH</th><th>nginx\u5B89\u88C5\u76EE\u5F55\uFF0C\u9ED8\u8BA4/uar/local/nginx</th></tr></thead><tbody><tr><td>--sbin-path=PATH</td><td>\u53EF\u6267\u884C\u6587\u4EF6\u8DEF\u5F84\uFF0C\u9ED8\u8BA4<code>&lt;prefix&gt;/sbin/nginx</code></td></tr><tr><td>--modules-path=PATH</td><td>\u52A8\u6001\u6A21\u5757\u7684\u5B89\u88C5\u76EE\u5F55\uFF0C\u9ED8\u8BA4<code>&lt;prefix&gt;/modules</code></td></tr><tr><td>--conf-path=PATH</td><td>\u914D\u7F6E\u6587\u4EF6\u8DEF\u5F84\uFF0C\u9ED8\u8BA4<code>&lt;prefix&gt;/conf/nginx.conf</code></td></tr><tr><td>--error-log-path=PATH</td><td>\u9519\u8BEF\u65E5\u5FD7\u6587\u4EF6\u8DEF\u5F84\uFF0C\u9ED8\u8BA4<code>&lt;prefix&gt;/logs/error.log</code></td></tr><tr><td>--http-log-path=PATH</td><td>\u65E5\u5FD7\u6587\u4EF6\u8DEF\u5F84\uFF0C\u9ED8\u8BA4<code>&lt;prefix&gt;/logs/access.log</code></td></tr><tr><td>--pid-path=PATH</td><td>\u8FDB\u7A0Bid\u6587\u4EF6\u8DEF\u5F84\uFF0C\u9ED8\u8BA4<code>&lt;prefix&gt;/logs/nginx.pid</code></td></tr></tbody></table></li></ul><blockquote><p>\u8FDB\u884C\u5B89\u88C5</p></blockquote><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">make</span> <span class="token operator">&amp;&amp;</span> <span class="token function">make</span> <span class="token function">install</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="yum\u5B89\u88C5" tabindex="-1"><a class="header-anchor" href="#yum\u5B89\u88C5" aria-hidden="true">#</a> yum\u5B89\u88C5</h4><blockquote><p>\u5B89\u88C5\u4F9D\u8D56</p></blockquote><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>yum <span class="token function">install</span> <span class="token parameter variable">-y</span> yum-utils
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote><p>\u7F16\u8F91\u914D\u7F6E\u6587\u4EF6</p></blockquote><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">vim</span> /etc/yum.repos.d/nginx.repo

<span class="token punctuation">[</span>nginx-stable<span class="token punctuation">]</span>
<span class="token assign-left variable">name</span><span class="token operator">=</span>nginx stable repo
<span class="token assign-left variable">baseurl</span><span class="token operator">=</span>http://nginx.org/packages/centos/<span class="token variable">$releasever</span>/<span class="token variable">$basearch</span>/
<span class="token assign-left variable">gpgcheck</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token assign-left variable">enabled</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token assign-left variable">gpgkey</span><span class="token operator">=</span>https://nginx.org/keys/nginx_signing.key
<span class="token assign-left variable">module_hotfixes</span><span class="token operator">=</span>true

<span class="token punctuation">[</span>nginx-mainline<span class="token punctuation">]</span>
<span class="token assign-left variable">name</span><span class="token operator">=</span>nginx mainline repo
<span class="token assign-left variable">baseurl</span><span class="token operator">=</span>http://nginx.org/packages/mainline/centos/<span class="token variable">$releasever</span>/<span class="token variable">$basearch</span>/
<span class="token assign-left variable">gpgcheck</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token assign-left variable">enabled</span><span class="token operator">=</span><span class="token number">0</span>
<span class="token assign-left variable">gpgkey</span><span class="token operator">=</span>https://nginx.org/keys/nginx_signing.key
<span class="token assign-left variable">module_hotfixes</span><span class="token operator">=</span>true
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>\u8FDB\u884C\u5B89\u88C5</p></blockquote><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>yum <span class="token function">install</span> <span class="token parameter variable">-y</span> nginx
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote><p>\u67E5\u770B\u5B89\u88C5\u76EE\u5F55</p></blockquote><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">whereis</span> nginx
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="\u914D\u7F6E\u7CFB\u7EDF\u670D\u52A1" tabindex="-1"><a class="header-anchor" href="#\u914D\u7F6E\u7CFB\u7EDF\u670D\u52A1" aria-hidden="true">#</a> \u914D\u7F6E\u7CFB\u7EDF\u670D\u52A1</h3><blockquote><p>\u7F16\u8F91\u6587\u4EF6</p></blockquote><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">vim</span> /usr/lib/systemd/system/nginx.service
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote><p>\u6DFB\u52A0\u4EE5\u4E0B\u5185\u5BB9</p></blockquote><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>Unit<span class="token punctuation">]</span>
<span class="token assign-left variable">Description</span><span class="token operator">=</span>nginx web <span class="token function">service</span>
<span class="token assign-left variable">Documentation</span><span class="token operator">=</span>http://nginx.org/en/docs/
<span class="token assign-left variable">After</span><span class="token operator">=</span>network.target

<span class="token punctuation">[</span>Service<span class="token punctuation">]</span>
<span class="token assign-left variable">Type</span><span class="token operator">=</span>forking
<span class="token assign-left variable">PIDFile</span><span class="token operator">=</span>/usr/local/nginx/logs/nginx.pid
<span class="token assign-left variable">ExecStartPre</span><span class="token operator">=</span>/usr/local/nginx/sbin/nginx <span class="token parameter variable">-t</span> <span class="token parameter variable">-c</span> /usr/local/nginx/conf/nginx.conf
<span class="token assign-left variable">ExecStart</span><span class="token operator">=</span>/usr/local/nginx/sbin/nginx
<span class="token assign-left variable">ExecReload</span><span class="token operator">=</span>/usr/local/nginx/sbin/nginx <span class="token parameter variable">-s</span> reload
<span class="token assign-left variable">ExecStop</span><span class="token operator">=</span>/usr/local/nginx/sbin/nginx <span class="token parameter variable">-s</span> stop
<span class="token assign-left variable">PrivateTmp</span><span class="token operator">=</span>true

<span class="token punctuation">[</span>Install<span class="token punctuation">]</span>
<span class="token assign-left variable">WantedBy</span><span class="token operator">=</span>default.target
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u914D\u7F6E\u73AF\u5883\u53D8\u91CF" tabindex="-1"><a class="header-anchor" href="#\u914D\u7F6E\u73AF\u5883\u53D8\u91CF" aria-hidden="true">#</a> \u914D\u7F6E\u73AF\u5883\u53D8\u91CF</h3><blockquote><p>\u7F16\u8F91\u73AF\u5883\u53D8\u91CF</p></blockquote><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">vim</span> /etc/profile
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote><p>\u6700\u540E\u4E00\u884C\u6DFB\u52A0\u4EE5\u4E0B\u5185\u5BB9</p></blockquote><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span>:/usr/local/nginx/sbin
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote><p>\u5237\u65B0\u73AF\u5883\u53D8\u91CF</p></blockquote><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">source</span> /etc/profile
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="nginx\u64CD\u4F5C" tabindex="-1"><a class="header-anchor" href="#nginx\u64CD\u4F5C" aria-hidden="true">#</a> nginx\u64CD\u4F5C</h2><h3 id="\u76EE\u5F55\u7ED3\u6784\u4ECB\u7ECD" tabindex="-1"><a class="header-anchor" href="#\u76EE\u5F55\u7ED3\u6784\u4ECB\u7ECD" aria-hidden="true">#</a> \u76EE\u5F55\u7ED3\u6784\u4ECB\u7ECD</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>nginx
\u251C\u2500\u2500 conf
\u2502   \u251C\u2500\u2500 mime.types
\u2502   \u251C\u2500\u2500 mime.types.default
\u2502   \u251C\u2500\u2500 nginx.conf
\u2502   \u251C\u2500\u2500 nginx.conf.default
\u251C\u2500\u2500 html
\u2502   \u251C\u2500\u2500 50x.html
\u2502   \u2514\u2500\u2500 index.html
\u251C\u2500\u2500 logs
\u2502   \u251C\u2500\u2500 access.log
\u2502   \u251C\u2500\u2500 error.log
\u2502   \u2514\u2500\u2500 nginx.pid
\u251C\u2500\u2500 sbin
\u2502   \u2514\u2500\u2500 nginx
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="kill\u4FE1\u53F7\u64CD\u4F5C" tabindex="-1"><a class="header-anchor" href="#kill\u4FE1\u53F7\u64CD\u4F5C" aria-hidden="true">#</a> kill\u4FE1\u53F7\u64CD\u4F5C</h3><blockquote><p>\u67E5\u770Bnginx\u8FDB\u7A0B</p></blockquote><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">ps</span> <span class="token parameter variable">-ef</span> <span class="token operator">|</span> <span class="token function">grep</span> nginx
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote><p>\u7ACB\u5373\u5173\u95ED</p></blockquote><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">kill</span> -term/int <span class="token function">id</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote><p>\u4F18\u96C5\u5730\u5173\u95ED</p></blockquote><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">kill</span> <span class="token parameter variable">-quit</span> <span class="token function">id</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote><p>\u91CD\u65B0\u52A0\u8F7D\u914D\u7F6E\u6587\u4EF6</p></blockquote><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">kill</span> <span class="token parameter variable">-hup</span> <span class="token function">id</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote><p>\u91CD\u5199\u65E5\u5FD7\u6587\u4EF6</p></blockquote><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">kill</span> <span class="token parameter variable">-usr1</span> <span class="token function">id</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote><p>\u5E73\u6ED1\u5347\u7EA7</p></blockquote><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">kill</span> <span class="token parameter variable">-usr2</span> <span class="token function">id</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="nginx\u547D\u4EE4" tabindex="-1"><a class="header-anchor" href="#nginx\u547D\u4EE4" aria-hidden="true">#</a> nginx\u547D\u4EE4</h3><blockquote><p>\u67E5\u770B\u5E2E\u52A9</p></blockquote><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>nginx -?
nginx <span class="token parameter variable">-h</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6253\u5370\u5185\u5BB9\u5982\u4E0B\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>Options:
  -?,-h         <span class="token builtin class-name">:</span> this <span class="token builtin class-name">help</span>
  <span class="token parameter variable">-v</span>            <span class="token builtin class-name">:</span> show version and <span class="token builtin class-name">exit</span>
  <span class="token parameter variable">-V</span>            <span class="token builtin class-name">:</span> show version and configure options <span class="token keyword">then</span> <span class="token builtin class-name">exit</span>
  <span class="token parameter variable">-t</span>            <span class="token builtin class-name">:</span> <span class="token builtin class-name">test</span> configuration and <span class="token builtin class-name">exit</span>
  <span class="token parameter variable">-T</span>            <span class="token builtin class-name">:</span> <span class="token builtin class-name">test</span> configuration, dump it and <span class="token builtin class-name">exit</span>
  <span class="token parameter variable">-q</span>            <span class="token builtin class-name">:</span> suppress non-error messages during configuration testing
  <span class="token parameter variable">-s</span> signal     <span class="token builtin class-name">:</span> send signal to a master process: stop, quit, reopen, reload
  <span class="token parameter variable">-p</span> prefix     <span class="token builtin class-name">:</span> <span class="token builtin class-name">set</span> prefix path <span class="token punctuation">(</span>default: /usr/local/nginx/<span class="token punctuation">)</span>
  <span class="token parameter variable">-e</span> filename   <span class="token builtin class-name">:</span> <span class="token builtin class-name">set</span> error log <span class="token function">file</span> <span class="token punctuation">(</span>default: logs/error.log<span class="token punctuation">)</span>
  <span class="token parameter variable">-c</span> filename   <span class="token builtin class-name">:</span> <span class="token builtin class-name">set</span> configuration <span class="token function">file</span> <span class="token punctuation">(</span>default: conf/nginx.conf<span class="token punctuation">)</span>
  <span class="token parameter variable">-g</span> directives <span class="token builtin class-name">:</span> <span class="token builtin class-name">set</span> global directives out of configuration <span class="token function">file</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>\u67E5\u770B\u7248\u672C\u53F7</p></blockquote><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>nginx <span class="token parameter variable">-v</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote><p>\u67E5\u770B\u7248\u672C\u53F7\u548C\u5B89\u88C5\u65F6\u7684\u914D\u7F6E\u4FE1\u606F</p></blockquote><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>nginx <span class="token parameter variable">-V</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote><p>\u6D4B\u8BD5\u914D\u7F6E\u6587\u4EF6\u8BED\u6CD5</p></blockquote><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>nginx <span class="token parameter variable">-t</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote><p>\u6D4B\u8BD5\u914D\u7F6E\u6587\u4EF6\u8BED\u6CD5\uFF0C\u5982\u679C\u6210\u529F\u5219\u8F93\u51FA\u6587\u4EF6\u5185\u5BB9</p></blockquote><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>nginx <span class="token parameter variable">-T</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote><p>\u53D1\u9001\u4FE1\u53F7</p></blockquote><ul><li><p>\u5F3A\u5236\u5173\u95ED\uFF0C\u76F8\u5F53\u4E8E<code>kill -term/int</code></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>nginx <span class="token parameter variable">-s</span> stop
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>\u4F18\u96C5\u5173\u95ED\uFF0C\u76F8\u5F53\u4E8E<code>kill -quit</code></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>nginx <span class="token parameter variable">-s</span> quit
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>\u91CD\u65B0\u6253\u5F00\u65E5\u5FD7\u6587\u4EF6\uFF0C\u76F8\u5F53\u4E8E<code>kill -usr1</code></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>nginx <span class="token parameter variable">-s</span> reopen
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>\u91CD\u65B0\u52A0\u8F7D\u914D\u7F6E\u6587\u4EF6\uFF0C\u76F8\u5F53\u4E8E<code>kill -hup</code></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>nginx <span class="token parameter variable">-s</span> reload
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ul><h2 id="\u914D\u7F6E\u6587\u4EF6\u8BE6\u89E3" tabindex="-1"><a class="header-anchor" href="#\u914D\u7F6E\u6587\u4EF6\u8BE6\u89E3" aria-hidden="true">#</a> \u914D\u7F6E\u6587\u4EF6\u8BE6\u89E3</h2><h3 id="\u5168\u5C40\u5757" tabindex="-1"><a class="header-anchor" href="#\u5168\u5C40\u5757" aria-hidden="true">#</a> \u5168\u5C40\u5757</h3><table><thead><tr><th>\u5168\u5C40\u6307\u4EE4</th><th>\u53EF\u9009\u503C</th><th>\u9ED8\u8BA4\u503C</th><th>\u8BF4\u660E</th></tr></thead><tbody><tr><td>user</td><td>\u7528\u6237\u540D</td><td></td><td>\u6307\u5B9A\u7528\u6237</td></tr><tr><td>master_process</td><td>on/off</td><td>on</td><td>\u662F\u5426\u5F00\u542F\u5DE5\u4F5C\u8FDB\u7A0Bworker\uFF0C\u914D\u7F6E\u5B8C\u8981\u91CD\u542Fnginx</td></tr><tr><td>worker_processes</td><td>\u6570\u5B57</td><td></td><td>worker\u8FDB\u7A0B\u6570\u91CF\uFF0C\u5EFA\u8BAE\u914D\u7F6E\u6210cpu\u7684\u6570\u91CF\uFF0Cmaster_process\u5F00\u542F\u624D\u6709\u7528</td></tr><tr><td>daemon</td><td>on/off</td><td>on</td><td>\u662F\u5426\u4EE5\u5B88\u62A4\u8FDB\u7A0B\u65B9\u5F0F\u542F\u52A8</td></tr><tr><td>pid</td><td></td><td>logs/nginx.pid</td><td>pid\u8DEF\u5F84</td></tr><tr><td>error_log</td><td></td><td></td><td>\u65E5\u5FD7\u7EA7\u522B\uFF0Cdebug\u3001info\u3001notice\u3001warn\u3001error\u3001crit</td></tr><tr><td>include</td><td></td><td></td><td>\u5F15\u5165\u914D\u7F6E\u6587\u4EF6</td></tr></tbody></table><h3 id="events\u5757" tabindex="-1"><a class="header-anchor" href="#events\u5757" aria-hidden="true">#</a> events\u5757</h3><table><thead><tr><th>\u6307\u4EE4</th><th>\u53EF\u9009\u503C</th><th>\u9ED8\u8BA4\u503C</th><th>\u8BF4\u660E</th></tr></thead><tbody><tr><td>worker_connections</td><td></td><td>512</td><td>\u5355\u4E2Aworker\u8FDB\u7A0B\u6700\u5927\u8FDE\u63A5\u6570</td></tr><tr><td>accept_mutex</td><td>on/off</td><td>on</td><td>\u662F\u5426\u5F00\u542F\u5E8F\u5217\u5316\uFF0C\u4E00\u4E2A\u4E00\u4E2A\u5524\u9192\u63A5\u6536</td></tr><tr><td>multi_accept</td><td>on/off</td><td>off</td><td>\u662F\u5426\u5141\u8BB8\u540C\u65F6\u63A5\u6536\u591A\u4E2A\u7F51\u7EDC\u8FDE\u63A5</td></tr><tr><td>use</td><td>select/poll/epoll/kqueue</td><td>\u6839\u636E\u64CD\u4F5C\u7CFB\u7EDF\u5B9A</td><td>\u4F7F\u7528\u54EA\u79CD\u4E8B\u4EF6\u9A71\u52A8\u6765\u5904\u7406\u7F51\u7EDC\u6D88\u606F</td></tr></tbody></table><h3 id="http\u5757" tabindex="-1"><a class="header-anchor" href="#http\u5757" aria-hidden="true">#</a> http\u5757</h3><blockquote><p>default_type</p></blockquote><p>\u8BBE\u7F6E\u54CD\u5E94\u7684MIME\u7C7B\u578B</p><p>\u8BED\u6CD5\uFF1A<code>default_type mime-type</code></p><p>\u9ED8\u8BA4\uFF1A<code>default_type text/plain</code></p><p>\u4F5C\u7528\u57DF\uFF1A<code>http</code>, <code>server</code>, <code>location</code></p><blockquote><p>access_log</p></blockquote><p>\u65E5\u5FD7\u8F93\u51FA\u8DEF\u5F84</p><p>\u8BED\u6CD5\uFF1A<code>access_log path [format]</code></p><p>\u9ED8\u8BA4\uFF1A<code>logs/access.log</code></p><p>\u4F5C\u7528\u57DF\uFF1A<code>http</code>, <code>server</code>, <code>location</code>, <code>if in location</code></p><blockquote><p>log_format</p></blockquote><p>\u65E5\u5FD7\u683C\u5F0F\u5316</p><p>\u8BED\u6CD5\uFF1A<code>log_format name value</code></p><p>\u4F5C\u7528\u57DF\uFF1A<code>http</code></p><blockquote><p>sendfile</p></blockquote><p>\u5E95\u5C42\u4F7F\u7528<code>sendfile</code>\u53D1\u9001\u6587\u4EF6</p><p>\u8BED\u6CD5\uFF1A<code>sendfile on|off</code></p><p>\u9ED8\u8BA4\uFF1A<code>off</code></p><p>\u4F5C\u7528\u57DF\uFF1A<code>http</code>, <code>server</code>, <code>location</code>,<code>if in location</code></p><blockquote><p>keepalive_timeout</p></blockquote><p>tcp\u957F\u8FDE\u63A5\u8D85\u65F6\u65F6\u95F4</p><p>\u8BED\u6CD5\uFF1A<code>keepalive_timeout timeout</code></p><p>\u9ED8\u8BA4\uFF1A75\uFF0C\u4E0D\u5199\u5355\u4F4D\u9ED8\u8BA4\u662Fs</p><p>\u4F5C\u7528\u57DF\uFF1A<code>http</code>, <code>server</code>,<code>location</code></p><blockquote><p>keepalive_requests</p></blockquote><p>\u4E00\u4E2A\u8FDE\u63A5\u4F7F\u7528\u6B21\u6570</p><p>\u8BED\u6CD5\uFF1A<code>keepalive_requests number</code></p><p>\u9ED8\u8BA4\uFF1A100</p><p>\u4F5C\u7528\u57DF\uFF1A<code>http</code>, <code>server</code>,<code>location</code></p><h3 id="server\u5757" tabindex="-1"><a class="header-anchor" href="#server\u5757" aria-hidden="true">#</a> server\u5757</h3><blockquote><p>listen</p></blockquote><p>\u76D1\u542C\u7684\u7AEF\u53E3</p><p>\u8BED\u6CD5\uFF1A<code>listen port</code></p><p>\u4F5C\u7528\u57DF\uFF1A<code>server</code></p><blockquote><p>server_name</p></blockquote><p>\u76D1\u542C\u5F53\u524D\u7684ip\u6216\u57DF\u540D</p><p>\u8BED\u6CD5\uFF1A<code>server_name name ...</code></p><p>\u4F5C\u7528\u57DF\uFF1A<code>server</code></p><h3 id="location\u5757" tabindex="-1"><a class="header-anchor" href="#location\u5757" aria-hidden="true">#</a> location\u5757</h3><h4 id="location" tabindex="-1"><a class="header-anchor" href="#location" aria-hidden="true">#</a> location</h4><blockquote><p>\u6A21\u7CCA\u5339\u914D</p></blockquote><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code>location /aaa
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote><p>\u7CBE\u786E\u5339\u914D</p></blockquote><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code>location =/aaa
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote><p>\u6B63\u5219\u5339\u914D\uFF08\u533A\u5206\u5927\u5C0F\u5199\uFF09</p></blockquote><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code>location ~^/aaa$
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote><p>\u6B63\u5219\u5339\u914D\uFF08\u4E0D\u533A\u5206\u5927\u5C0F\u5199\uFF09</p></blockquote><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code>location ~*^/aaa$
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u6CE8\u610F\uFF1A?\u540E\u9762\u7684\u503C\u4E0D\u53C2\u4E0E<code>location</code>\u5339\u914D</p><h4 id="root" tabindex="-1"><a class="header-anchor" href="#root" aria-hidden="true">#</a> root</h4><p>\u8D44\u6E90\u6587\u4EF6\u76EE\u5F55\uFF0C\u4F1A\u62FC\u4E0Alocation\u7684\u503C\uFF0C\u9ED8\u8BA4<code>root html</code></p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">root</span> html</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token directive"><span class="token keyword">location</span> /aaa</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">root</span> html</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="alias" tabindex="-1"><a class="header-anchor" href="#alias" aria-hidden="true">#</a> alias</h4><p>\u8D44\u6E90\u6587\u4EF6\u76EE\u5F55</p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">alias</span> html/</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token directive"><span class="token keyword">location</span> /aaa</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">alias</span> html</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6CE8\u610F\uFF1A\u5982\u679Clocation\u5339\u914D\u503C\u4EE5/\u7ED3\u5C3E\uFF0C\u90A3\u4E48alias\u4E5F\u8981\u4EE5/\u7ED3\u5C3E</p><h4 id="index" tabindex="-1"><a class="header-anchor" href="#index" aria-hidden="true">#</a> index</h4><p>\u9ED8\u8BA4\u6587\u4EF6</p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">index</span> index.htm index.html aaa.html bbb.html</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="error-page" tabindex="-1"><a class="header-anchor" href="#error-page" aria-hidden="true">#</a> error_page</h4><p>\u9875\u9762\u53D1\u751F\u9519\u8BEF\u65F6\u8DF3\u8F6C\u7684\u8DEF\u5F84</p><blockquote><p>\u5199\u6CD51</p></blockquote><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code>error_page 404 https://www.baidu.com
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote><p>\u5199\u6CD52</p></blockquote><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">root</span> aaa</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">error_page</span> <span class="token number">404</span> @error</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token directive"><span class="token keyword">location</span> @error</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">return</span> <span class="token number">200</span> <span class="token string">&#39;this is 404&#39;</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="try-files" tabindex="-1"><a class="header-anchor" href="#try-files" aria-hidden="true">#</a> try_files</h4><p>\u5C1D\u8BD5\u7740\u627E\u6587\u4EF6</p><p>/1.html</p><p>/1.html/index.html</p><p>/index.html</p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">try_files</span> <span class="token variable">$uri</span> <span class="token variable">$uri</span>/ /index.html</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u5C1D\u8BD5\u53BB\u627E<code>$uri</code>\u8FD9\u4E2A\u6587\u4EF6\uFF0C\u627E\u4E0D\u5230<code>$uri</code>\u5C31\u53BB<code>$uri/</code>\u4E0B\u7684<code>index.html</code>\u6587\u4EF6\uFF0C\u627E\u4E0D\u5230\u5C31\u8BF7\u6C42<code>/index.html</code></p><h3 id="\u89E3\u51B3\u8DE8\u57DF" tabindex="-1"><a class="header-anchor" href="#\u89E3\u51B3\u8DE8\u57DF" aria-hidden="true">#</a> \u89E3\u51B3\u8DE8\u57DF</h3><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
   <span class="token directive"><span class="token keyword">listen</span> <span class="token number">7089</span></span><span class="token punctuation">;</span>
   <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
      <span class="token directive"><span class="token keyword">proxy_pass</span> http://localhost:8089</span><span class="token punctuation">;</span>
      <span class="token directive"><span class="token keyword">add_header</span> Access-Control-Allow-Origin *</span><span class="token punctuation">;</span>
      <span class="token directive"><span class="token keyword">add_header</span> Access-Control-Allow-Methods *</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="rewrite\u6A21\u5757\u8BE6\u89E3" tabindex="-1"><a class="header-anchor" href="#rewrite\u6A21\u5757\u8BE6\u89E3" aria-hidden="true">#</a> rewrite\u6A21\u5757\u8BE6\u89E3</h3><h4 id="\u5E38\u7528\u5168\u5C40\u53D8\u91CF" tabindex="-1"><a class="header-anchor" href="#\u5E38\u7528\u5168\u5C40\u53D8\u91CF" aria-hidden="true">#</a> \u5E38\u7528\u5168\u5C40\u53D8\u91CF</h4>`,153),r=n("thead",null,[n("tr",null,[n("th",null,"\u53D8\u91CF"),n("th",null,"\u8BF4\u660E")])],-1),u=n("td",null,"$args",-1),v={href:"http://192.168.200.133/server?arg1=value1&args2=value2%E4%B8%AD%E7%9A%84%22arg1=value1&arg2=value2%22%EF%BC%8C%E5%8A%9F%E8%83%BD%E5%92%8C$query_string%E4%B8%80%E6%A0%B7",target:"_blank",rel:"noopener noreferrer"},k=n("tr",null,[n("td",null,"$http_user_agent"),n("td",null,"\u53D8\u91CF\u5B58\u50A8\u7684\u662F\u7528\u6237\u8BBF\u95EE\u670D\u52A1\u7684\u4EE3\u7406\u4FE1\u606F(\u5982\u679C\u901A\u8FC7\u6D4F\u89C8\u5668\u8BBF\u95EE\uFF0C\u8BB0\u5F55\u7684\u662F\u6D4F\u89C8\u5668\u7684\u76F8\u5173\u7248\u672C\u4FE1\u606F)")],-1),b=n("tr",null,[n("td",null,"$host"),n("td",null,"\u53D8\u91CF\u5B58\u50A8\u7684\u662F\u8BBF\u95EE\u670D\u52A1\u5668\u7684server_name\u503C")],-1),m=n("td",null,"$document_uri",-1),h={href:"http://192.168.200.133/server?id=10&name=zhangsan%E4%B8%AD%E7%9A%84%22/server%22%EF%BC%8C%E5%8A%9F%E8%83%BD%E5%92%8C$uri%E4%B8%80%E6%A0%B7",target:"_blank",rel:"noopener noreferrer"},g=n("tr",null,[n("td",null,"$document_root"),n("td",null,"\u53D8\u91CF\u5B58\u50A8\u7684\u662F\u5F53\u524D\u8BF7\u6C42\u5BF9\u5E94location\u7684root\u503C\uFF0C\u5982\u679C\u672A\u8BBE\u7F6E\uFF0C\u9ED8\u8BA4\u6307\u5411Nginx\u81EA\u5E26html\u76EE\u5F55\u6240\u5728\u4F4D\u7F6E")],-1),x=n("tr",null,[n("td",null,"$content_length"),n("td",null,"\u53D8\u91CF\u5B58\u50A8\u7684\u662F\u8BF7\u6C42\u5934\u4E2D\u7684Content-Length\u7684\u503C")],-1),f=n("tr",null,[n("td",null,"$content_type"),n("td",null,"\u53D8\u91CF\u5B58\u50A8\u7684\u662F\u8BF7\u6C42\u5934\u4E2D\u7684Content-Type\u7684\u503C")],-1),y=n("tr",null,[n("td",null,"$http_cookie"),n("td",null,"\u53D8\u91CF\u5B58\u50A8\u7684\u662F\u5BA2\u6237\u7AEF\u7684cookie\u4FE1\u606F\uFF0C\u53EF\u4EE5\u901A\u8FC7add_header Set-Cookie 'cookieName=cookieValue'\u6765\u6DFB\u52A0cookie\u6570\u636E")],-1),w=n("tr",null,[n("td",null,"$limit_rate"),n("td",null,"\u53D8\u91CF\u4E2D\u5B58\u50A8\u7684\u662FNginx\u670D\u52A1\u5668\u5BF9\u7F51\u7EDC\u8FDE\u63A5\u901F\u7387\u7684\u9650\u5236\uFF0C\u4E5F\u5C31\u662FNginx\u914D\u7F6E\u4E2D\u5BF9limit_rate\u6307\u4EE4\u8BBE\u7F6E\u7684\u503C\uFF0C\u9ED8\u8BA4\u662F0\uFF0C\u4E0D\u9650\u5236\u3002")],-1),_=n("tr",null,[n("td",null,"$remote_addr"),n("td",null,"\u53D8\u91CF\u4E2D\u5B58\u50A8\u7684\u662F\u5BA2\u6237\u7AEF\u7684IP\u5730\u5740")],-1),q=n("tr",null,[n("td",null,"$remote_port"),n("td",null,"\u53D8\u91CF\u4E2D\u5B58\u50A8\u4E86\u5BA2\u6237\u7AEF\u4E0E\u670D\u52A1\u7AEF\u5EFA\u7ACB\u8FDE\u63A5\u7684\u7AEF\u53E3\u53F7")],-1),$=n("tr",null,[n("td",null,"$remote_user"),n("td",null,"\u53D8\u91CF\u4E2D\u5B58\u50A8\u4E86\u5BA2\u6237\u7AEF\u7684\u7528\u6237\u540D\uFF0C\u9700\u8981\u6709\u8BA4\u8BC1\u6A21\u5757\u624D\u80FD\u83B7\u53D6")],-1),E=n("tr",null,[n("td",null,"$scheme"),n("td",null,"\u53D8\u91CF\u4E2D\u5B58\u50A8\u4E86\u8BBF\u95EE\u534F\u8BAE")],-1),A=n("tr",null,[n("td",null,"$server_addr"),n("td",null,"\u53D8\u91CF\u4E2D\u5B58\u50A8\u4E86\u670D\u52A1\u7AEF\u7684\u5730\u5740")],-1),T=n("tr",null,[n("td",null,"$server_name"),n("td",null,"\u53D8\u91CF\u4E2D\u5B58\u50A8\u4E86\u5BA2\u6237\u7AEF\u8BF7\u6C42\u5230\u8FBE\u7684\u670D\u52A1\u5668\u7684\u540D\u79F0")],-1),C=n("tr",null,[n("td",null,"$server_port"),n("td",null,"\u53D8\u91CF\u4E2D\u5B58\u50A8\u4E86\u5BA2\u6237\u7AEF\u8BF7\u6C42\u5230\u8FBE\u670D\u52A1\u5668\u7684\u7AEF\u53E3\u53F7")],-1),P=n("tr",null,[n("td",null,"$server_protocol"),n("td",null,'\u53D8\u91CF\u4E2D\u5B58\u50A8\u4E86\u5BA2\u6237\u7AEF\u8BF7\u6C42\u534F\u8BAE\u7684\u7248\u672C\uFF0C\u6BD4\u5982"HTTP/1.1"')],-1),H=n("tr",null,[n("td",null,"$request_body_file"),n("td",null,"\u53D8\u91CF\u4E2D\u5B58\u50A8\u4E86\u53D1\u7ED9\u540E\u7AEF\u670D\u52A1\u5668\u7684\u672C\u5730\u6587\u4EF6\u8D44\u6E90\u7684\u540D\u79F0")],-1),S=n("tr",null,[n("td",null,"$request_method"),n("td",null,'\u53D8\u91CF\u4E2D\u5B58\u50A8\u4E86\u5BA2\u6237\u7AEF\u7684\u8BF7\u6C42\u65B9\u5F0F\uFF0C\u6BD4\u5982"GET","POST"\u7B49')],-1),L=n("tr",null,[n("td",null,"$request_filename"),n("td",null,"\u53D8\u91CF\u4E2D\u5B58\u50A8\u4E86\u5F53\u524D\u8BF7\u6C42\u7684\u8D44\u6E90\u6587\u4EF6\u7684\u8DEF\u5F84\u540D")],-1),B=n("td",null,"$request_uri",-1),D={href:"http://192.168.200.133/server?id=10&name=zhangsan%E4%B8%AD%E7%9A%84%22/server?id=10&name=zhangsan%22",target:"_blank",rel:"noopener noreferrer"},N=i(`<h3 id="set" tabindex="-1"><a class="header-anchor" href="#set" aria-hidden="true">#</a> set</h3><p>\u8BBE\u7F6E\u53D8\u91CF</p><p>\u8BED\u6CD5\uFF1A<code>set $variable value</code></p><p>\u4F5C\u7528\u57DF\uFF1A<code>server</code>, <code>location</code>, <code>if</code></p><h3 id="if" tabindex="-1"><a class="header-anchor" href="#if" aria-hidden="true">#</a> if</h3><p>\u6761\u4EF6\u5224\u65AD</p><p>\u8BED\u6CD5\uFF1A<code>if (condition) {}</code></p><p>\u4F5C\u7528\u57DF\uFF1A<code>server</code>, <code>location</code></p><h3 id="break" tabindex="-1"><a class="header-anchor" href="#break" aria-hidden="true">#</a> break</h3><p>\u8BED\u6CD5\uFF1A<code>break</code></p><p>\u4F5C\u7528\u57DF\uFF1A<code>server</code>, <code>location</code>, <code>if</code></p><h3 id="return" tabindex="-1"><a class="header-anchor" href="#return" aria-hidden="true">#</a> return</h3><p>\u8BED\u6CD5\uFF1A<code>return code URL</code> <code>return [text]</code> <code>return URL</code></p><p>\u4F5C\u7528\u57DF\uFF1A<code>server</code>, <code>location</code>, <code>if</code></p><h3 id="rewrite" tabindex="-1"><a class="header-anchor" href="#rewrite" aria-hidden="true">#</a> rewrite</h3><p>\u5BF9\u8BF7\u6C42\u7684uri\u8FDB\u884C\u91CD\u5199</p><p>\u8BED\u6CD5\uFF1A<code>rewrite regex replacement [flag]</code></p><p>\u4F5C\u7528\u57DF\uFF1A<code>server</code>, <code>location</code>, <code>if</code></p><blockquote><p>flag\u53EF\u9009\u503C</p></blockquote><ul><li><p>last</p><p>\u505C\u6B62\u5F53\u524Dlocation\u7684\u6267\u884C\uFF0C\u62FF\u7740uri\u91CD\u65B0\u53BB\u5339\u914Dlocation</p></li><li><p>break</p><p>\u505C\u6B62\u5F53\u524Dlocation\u7684\u6267\u884C\uFF0C\u4F1A\u5728\u5F53\u524Dlocation\u53BB\u627E\u5BF9\u5E94\u7684\u8D44\u6E90</p></li><li><p>redirect</p><p>\u4E34\u65F6\u91CD\u5B9A\u5411</p></li><li><p>permanent</p><p>\u6C38\u4E45\u91CD\u5B9A\u5411</p></li></ul><blockquote><p>\u4F7F\u7528\u793A\u4F8B</p></blockquote><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">rewrite</span> /1.html /2.html last</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">rewrite</span> /2.html /3.html</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token directive"><span class="token keyword">location</span> /2.html</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">rewrite</span> /2.html /a.html</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token directive"><span class="token keyword">location</span> /3.html</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">rewrite</span> /3.html /b.html</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="rewrite-log" tabindex="-1"><a class="header-anchor" href="#rewrite-log" aria-hidden="true">#</a> rewrite_log</h3><p>\u6253\u5370rewrite\u65E5\u5FD7</p><p>\u8BED\u6CD5\uFF1A<code>rewrite_log on | off</code></p><p>\u4F5C\u7528\u57DF\uFF1A<code>http</code>, <code>server</code>, <code>location</code>, <code>if</code></p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">rewrite_log</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">error_log</span> logs/error.log notice</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="\u53CD\u5411\u4EE3\u7406" tabindex="-1"><a class="header-anchor" href="#\u53CD\u5411\u4EE3\u7406" aria-hidden="true">#</a> \u53CD\u5411\u4EE3\u7406</h2><h3 id="\u6B63\u5411\u4EE3\u7406" tabindex="-1"><a class="header-anchor" href="#\u6B63\u5411\u4EE3\u7406" aria-hidden="true">#</a> \u6B63\u5411\u4EE3\u7406</h3><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">proxy_pass</span> http://10.8.0.61</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u53CD\u5411\u4EE3\u7406-1" tabindex="-1"><a class="header-anchor" href="#\u53CD\u5411\u4EE3\u7406-1" aria-hidden="true">#</a> \u53CD\u5411\u4EE3\u7406</h3><blockquote><p>\u88AB\u4EE3\u7406\u670D\u52A1\u5668</p></blockquote><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">root</span>   html</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>\u4EE3\u7406\u670D\u52A1\u5668</p></blockquote><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">proxy_pass</span> http://192.168.100.128</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="proxy-set-header" tabindex="-1"><a class="header-anchor" href="#proxy-set-header" aria-hidden="true">#</a> proxy_set_header</h3><p>\u8BBE\u7F6E\u8BF7\u6C42\u5934\u4FE1\u606F</p><p>\u8BED\u6CD5\uFF1A<code>proxy_set_header field value</code></p><p>\u4F5C\u7528\u57DF\uFF1A<code>http</code>, <code>server</code>, <code>location</code></p><h3 id="proxy-redirect" tabindex="-1"><a class="header-anchor" href="#proxy-redirect" aria-hidden="true">#</a> proxy_redirect</h3><p>\u5C06\u88AB\u4EE3\u7406\u670D\u52A1\u5668\u7684\u91CD\u5B9A\u5411\u5730\u5740\u66FF\u6362\u6210\u4EE3\u7406\u670D\u52A1\u5668\u7684\u5730\u5740</p><p>\u8BED\u6CD5\uFF1A<code>proxy_redirect redirect replacement</code></p><p>\u4F5C\u7528\u57DF\uFF1A<code>http</code>, <code>server</code>, <code>location</code></p><blockquote><p>\u88AB\u4EE3\u7406\u670D\u52A1\u5668</p></blockquote><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">events</span></span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token directive"><span class="token keyword">http</span></span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
                <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
                <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
                        <span class="token directive"><span class="token keyword">root</span> html</span><span class="token punctuation">;</span>
                        <span class="token directive"><span class="token keyword">index</span> index.html</span><span class="token punctuation">;</span>
                        <span class="token directive"><span class="token keyword">if</span> (!-f <span class="token variable">$request_filename</span>)</span> <span class="token punctuation">{</span>
                                <span class="token directive"><span class="token keyword">return</span> <span class="token number">302</span> http://192.168.100.128:81</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
                <span class="token directive"><span class="token keyword">listen</span> <span class="token number">81</span></span><span class="token punctuation">;</span>
                <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
                        <span class="token directive"><span class="token keyword">root</span> html</span><span class="token punctuation">;</span>
                        <span class="token directive"><span class="token keyword">index</span> index.html</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>\u4EE3\u7406\u670D\u52A1\u5668</p></blockquote><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">events</span></span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token directive"><span class="token keyword">http</span></span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
                <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
                <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
                        <span class="token directive"><span class="token keyword">proxy_redirect</span> http://192.168.100.128 http://192.168.100.3</span><span class="token punctuation">;</span>
                        <span class="token directive"><span class="token keyword">proxy_pass</span> http://192.168.100.128</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
                <span class="token directive"><span class="token keyword">listen</span> <span class="token number">81</span></span><span class="token punctuation">;</span>
                <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
                        <span class="token directive"><span class="token keyword">proxy_pass</span> http://192.168.100.128:81</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="\u8D1F\u8F7D\u5747\u8861" tabindex="-1"><a class="header-anchor" href="#\u8D1F\u8F7D\u5747\u8861" aria-hidden="true">#</a> \u8D1F\u8F7D\u5747\u8861</h2><h3 id="upstream" tabindex="-1"><a class="header-anchor" href="#upstream" aria-hidden="true">#</a> upstream</h3><p>\u5B9A\u4E49\u4E00\u7EC4\u670D\u52A1\u5668</p><p>\u8BED\u6CD5\uFF1A<code>upstram name {}</code></p><p>\u4F5C\u7528\u57DF\uFF1A<code>http</code></p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">upstream</span> myserver</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">server</span> 192.168.100.128</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server</span> 192.168.100.128:81</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server</span> 192.168.100.128:82</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">proxy_pass</span> http://myserver</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u8D1F\u8F7D\u5747\u8861\u72B6\u6001" tabindex="-1"><a class="header-anchor" href="#\u8D1F\u8F7D\u5747\u8861\u72B6\u6001" aria-hidden="true">#</a> \u8D1F\u8F7D\u5747\u8861\u72B6\u6001</h3><table><thead><tr><th>down</th><th>\u4E0D\u53C2\u4E0E\u8D1F\u8F7D\u5747\u8861</th></tr></thead><tbody><tr><td>backup</td><td>\u5907\u4EFD\u670D\u52A1\u5668\uFF0C\u5F53\u5176\u4ED6\u670D\u52A1\u5668\u6302\u6389\u4E86\uFF0C\u624D\u4F1A\u542F\u7528\u5907\u4EFD\u670D\u52A1\u5668</td></tr><tr><td>max_fails</td><td>\u5141\u8BB8\u8BF7\u6C42\u5931\u8D25\u7684\u6B21\u6570\uFF0C\u9ED8\u8BA4\u662F1</td></tr><tr><td>fail_timeout</td><td>max_fails\u5931\u8D25\u540E\uFF0C\u591A\u5C11\u79D2\u4E4B\u5185\u4E0D\u8BBF\u95EE\u5931\u8D25\u7684\u670D\u52A1\u5668\uFF0C\u9ED8\u8BA410\u79D2</td></tr></tbody></table><h3 id="\u8D1F\u8F7D\u5747\u8861\u7B56\u7565" tabindex="-1"><a class="header-anchor" href="#\u8D1F\u8F7D\u5747\u8861\u7B56\u7565" aria-hidden="true">#</a> \u8D1F\u8F7D\u5747\u8861\u7B56\u7565</h3><blockquote><p>weight</p></blockquote><p>\u5206\u914D\u6743\u91CD</p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">upstream</span> myserver</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">server</span> 192.168.100.128:80 weight=3</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server</span> 192.168.100.128:81 weight=7</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server</span> 192.168.100.128:82 weight=10</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>ip_hash</p></blockquote><p>\u4E00\u4E2Aip\u56FA\u5B9A\u88AB\u5206\u914D\u5230\u67D0\u4E00\u53F0\u670D\u52A1\u5668</p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">upstream</span> myserver</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">ip_hash</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server</span> 192.168.100.128:80</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server</span> 192.168.100.128:81</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server</span> 192.168.100.128:82</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>url_hash</p></blockquote><p>\u540C\u4E00\u4E2Aurl\u56FA\u5B9A\u5206\u914D\u5230\u67D0\u4E00\u53F0\u670D\u52A1\u5668</p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">upstream</span> myserver</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">hash</span> <span class="token variable">$request_uri</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server</span> 192.168.100.128</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server</span> 192.168.100.128:81</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server</span> 192.168.100.128:82</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>least_conn</p></blockquote><p>\u628A\u8BF7\u6C42\u5206\u914D\u5230\u8FDE\u63A5\u6700\u5C11\u7684\u670D\u52A1\u5668\u4E0A</p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">upstream</span> myserver</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">least_conn</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server</span> 192.168.100.128:80</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server</span> 192.168.100.128:81</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server</span> 192.168.100.128:82</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u8D1F\u8F7D\u5747\u8861\u4E4Bfair\u7B56\u7565" tabindex="-1"><a class="header-anchor" href="#\u8D1F\u8F7D\u5747\u8861\u4E4Bfair\u7B56\u7565" aria-hidden="true">#</a> \u8D1F\u8F7D\u5747\u8861\u4E4Bfair\u7B56\u7565</h3><p>\u6839\u636E\u9875\u9762\u5927\u5C0F\u3001\u52A0\u8F7D\u65F6\u95F4\u7B49\u667A\u80FD\u5206\u914D\u670D\u52A1\u5668</p><blockquote><p>\u4E0B\u8F7Dfair</p></blockquote><p>\u4E0B\u8F7D\u5730\u5740\uFF1A<code>https://github.com/gnosek/nginx-upstream-fair</code></p><blockquote><p>\u4E0A\u4F20\u5230\u670D\u52A1\u5668\u89E3\u538B\u7F29\u5E76\u91CD\u547D\u540D</p></blockquote><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">unzip</span> nginx-upstream-fair-master.zip
<span class="token function">mv</span> nginx-upstream-fair-master fair
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>\u7F16\u8F91nginx\u6E90\u7801\u6587\u4EF6</p></blockquote><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">vim</span> /data/nginx-1.22.0/src/http/ngx_http_upstream.h
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u627E\u5230<code>struct ngx_http_upstream_srv_conf_s</code>\u7ED3\u6784\u4F53</p><p>\u52A0\u4E0A<code>in_port_t default_port;</code></p><blockquote><p>\u8FDB\u5165nginx\u5B89\u88C5\u76EE\u5F55</p></blockquote><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> /data/nginx-1.22.0
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote><p>\u8FDB\u884C\u914D\u7F6E</p></blockquote><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>./configure --add-module<span class="token operator">=</span>/data/nginx-1.22.0/modules/fair
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote><p>\u8FDB\u884C\u7F16\u8BD1</p></blockquote><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">make</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote><p>\u5220\u9664\u4E4B\u524D\u7684nginx\u4E8C\u8FDB\u5236\u6587\u4EF6</p></blockquote><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">rm</span> <span class="token parameter variable">-rf</span> /usr/local/nginx/sbin/nginx
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote><p>\u590D\u5236\u65B0\u7684\u4E8C\u8FDB\u5236\u6587\u4EF6</p></blockquote><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">cp</span> objs/nginx /usr/local/nginx/sbin
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote><p>\u8FDB\u884C\u5E73\u6ED1\u5347\u7EA7</p></blockquote><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">make</span> upgrade
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote><p>\u4F7F\u7528fair\u7B56\u7565</p></blockquote><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">upstream</span> myserver</span> <span class="token punctuation">{</span>
	<span class="token directive"><span class="token keyword">fair</span></span><span class="token punctuation">;</span>
	<span class="token directive"><span class="token keyword">server</span> 192.168.100.128:80</span><span class="token punctuation">;</span>
	<span class="token directive"><span class="token keyword">server</span> 192.168.100.128:81</span><span class="token punctuation">;</span>
	<span class="token directive"><span class="token keyword">server</span> 192.168.100.128:82</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="\u914D\u7F6Ehttps" tabindex="-1"><a class="header-anchor" href="#\u914D\u7F6Ehttps" aria-hidden="true">#</a> \u914D\u7F6Ehttps</h2><h3 id="\u7533\u8BF7\u963F\u91CC\u4E91\u8BC1\u4E66" tabindex="-1"><a class="header-anchor" href="#\u7533\u8BF7\u963F\u91CC\u4E91\u8BC1\u4E66" aria-hidden="true">#</a> \u7533\u8BF7\u963F\u91CC\u4E91\u8BC1\u4E66</h3><blockquote><p>\u5230\u57DF\u540D\u63A7\u5236\u53F0\u89E3\u6790\u57DF\u540D</p></blockquote><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>https://dc.console.aliyun.com/next/index#/domain-list/all
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote><p>\u8D2D\u4E70SSL\u8BC1\u4E66</p></blockquote><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>https://common-buy.aliyun.com/?commodityCode=cas_dv_public_cn
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote><p>\u7533\u8BF7\u8BC1\u4E66</p></blockquote><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>https://yundunnext.console.aliyun.com/?p=casnext#/certExtend
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote><p>\u4E0B\u8F7D\u8BC1\u4E66\uFF0C\u5E76\u4E0A\u4F20\u5230\u670D\u52A1\u5668</p></blockquote><h3 id="\u5B89\u88C5ssl\u6A21\u5757" tabindex="-1"><a class="header-anchor" href="#\u5B89\u88C5ssl\u6A21\u5757" aria-hidden="true">#</a> \u5B89\u88C5ssl\u6A21\u5757</h3><blockquote><p>\u8FDB\u5165\u5230nginx\u5B89\u88C5\u5305\u76EE\u5F55</p></blockquote><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> /data/nginx-1.22.0
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote><p>\u6E05\u9664\u4E4B\u524D\u7F16\u8BD1\u7684\u6587\u4EF6</p></blockquote><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">make</span> clean
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote><p>\u91CD\u65B0\u914D\u7F6E</p></blockquote><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>./configure --with-http_ssl_module
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote><p>\u91CD\u65B0\u7F16\u8BD1</p></blockquote><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">make</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote><p>\u5220\u9664\u4E4B\u524D\u7684\u4E8C\u8FDB\u5236\u6587\u4EF6</p></blockquote><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">rm</span> <span class="token parameter variable">-rf</span> /usr/local/nginx/sbin/nginx
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote><p>\u590D\u5236\u4E8C\u8FDB\u5236\u6587\u4EF6</p></blockquote><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">cp</span> objs/nginx /usr/local/nginx/sbin
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote><p>\u8FDB\u884C\u5E73\u6ED1\u5347\u7EA7</p></blockquote><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">make</span> upgrade
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="\u8FDB\u884C\u914D\u7F6E" tabindex="-1"><a class="header-anchor" href="#\u8FDB\u884C\u914D\u7F6E" aria-hidden="true">#</a> \u8FDB\u884C\u914D\u7F6E</h3><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token comment"># https\u9ED8\u8BA4\u7AEF\u53E3\u662F443</span>
<span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">443</span> ssl</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span> localhost</span><span class="token punctuation">;</span>
 
    <span class="token comment"># \u8BC1\u4E66\u8DEF\u5F84</span>
    <span class="token directive"><span class="token keyword">ssl_certificate</span> cert/server.crt</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">ssl_certificate_key</span> cert/server.key</span><span class="token punctuation">;</span>
 
    <span class="token directive"><span class="token keyword">ssl_session_timeout</span> <span class="token number">5m</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">ssl_ciphers</span> ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">ssl_protocols</span> TLSv1 TLSv1.1 TLSv1.2</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">ssl_prefer_server_ciphers</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
        <span class="token comment"># \u4EE3\u7406\u5730\u5740\uFF0C\u5C31\u662F\u5B9E\u9645\u8981\u8BBF\u95EE\u7684\u5730\u5740</span>
    	<span class="token directive"><span class="token keyword">proxy_pass</span> https://www.baidu.com</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment"># \u5C06http://localhost\u91CD\u5B9A\u5411\u5230https://localhost</span>
<span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span> localhost</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">return</span> <span class="token number">301</span> https://192.168.100.3<span class="token variable">$request_uri</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="\u90E8\u7F72\u524D\u7AEF\u9879\u76EE" tabindex="-1"><a class="header-anchor" href="#\u90E8\u7F72\u524D\u7AEF\u9879\u76EE" aria-hidden="true">#</a> \u90E8\u7F72\u524D\u7AEF\u9879\u76EE</h2><h3 id="\u666E\u901A\u90E8\u7F72" tabindex="-1"><a class="header-anchor" href="#\u666E\u901A\u90E8\u7F72" aria-hidden="true">#</a> \u666E\u901A\u90E8\u7F72</h3><blockquote><p>\u82E5\u4F9D\u5B98\u7F51\u62C9\u53D6\u4EE3\u7801</p></blockquote><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>https://gitee.com/y_project/RuoYi-Vue
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote><p>\u5B89\u88C5\u4F9D\u8D56</p></blockquote><div class="language-powershell ext-powershell line-numbers-mode"><pre class="language-powershell"><code>npm install
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote><p>\u6253\u5305\u540E\u4E0A\u4F20\u5230\u670D\u52A1\u5668\u4E0A</p></blockquote><div class="language-powershell ext-powershell line-numbers-mode"><pre class="language-powershell"><code>npm run build:prod
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u6253\u5305\u5B8C\u6210\u540E\u4F1A\u751F\u6210dist\u6587\u6587\u4EF6\u5939\uFF0C\u5C06dist\u6587\u4EF6\u5939\u4E0A\u4F20\u5230\u670D\u52A1\u5668\u4E0A</p><blockquote><p>\u7F16\u8F91\u914D\u7F6E\u6587\u4EF6</p></blockquote><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">events</span></span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token directive"><span class="token keyword">http</span></span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">include</span> mime.types</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
                <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
                <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
                        <span class="token directive"><span class="token keyword">root</span> /usr/local/nginx/html/dist</span><span class="token punctuation">;</span>
                        <span class="token directive"><span class="token keyword">try_files</span> <span class="token variable">$uri</span> <span class="token variable">$uri</span>/ /index.html</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
        
                <span class="token comment"># \u914D\u7F6E\u540E\u7AEF\u5730\u5740</span>
                <span class="token directive"><span class="token keyword">location</span> /prod-api</span> <span class="token punctuation">{</span>
                        <span class="token comment"># \u8F6C\u53D1\u5230\u540E\u7AEF\u5730\u5740</span>
                        <span class="token directive"><span class="token keyword">proxy_pass</span> http://localhost:8081</span><span class="token punctuation">;</span>
                        <span class="token comment"># \u53BB\u6389/prod-api</span>
                        <span class="token directive"><span class="token keyword">rewrite</span> ^/prod-api/(.*)$ /<span class="token variable">$1</span> break</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>\u91CD\u65B0\u52A0\u8F7D\u914D\u7F6E\u6587\u4EF6</p></blockquote><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>nginx <span class="token parameter variable">-s</span> reload
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="\u6574\u5408jenkins\u3001docker\u81EA\u52A8\u5316\u90E8\u7F72" tabindex="-1"><a class="header-anchor" href="#\u6574\u5408jenkins\u3001docker\u81EA\u52A8\u5316\u90E8\u7F72" aria-hidden="true">#</a> \u6574\u5408Jenkins\u3001Docker\u81EA\u52A8\u5316\u90E8\u7F72</h3><blockquote><p>\u7F16\u5199nginx\u914D\u7F6E\u6587\u4EF6</p></blockquote><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">81</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">root</span> /dist</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">try_files</span> <span class="token variable">$uri</span> <span class="token variable">$uri</span>/ /index.html</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token directive"><span class="token keyword">location</span> /prod-api</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">proxy_pass</span> https://www.linzhehao.cn</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">rewrite</span> ^/prod-api/(.*)$ /ruoyi/<span class="token variable">$1</span> break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>\u7F16\u5199dockerignore</p></blockquote><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>node_modules
src
public
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>\u7F16\u5199Dockerfile</p></blockquote><div class="language-docker ext-docker line-numbers-mode"><pre class="language-docker"><code><span class="token instruction"><span class="token keyword">FROM</span> nginx:1.22.0</span>
<span class="token instruction"><span class="token keyword">EXPOSE</span> 81</span>
<span class="token instruction"><span class="token keyword">ENV</span> LC_ALL=C.UTF-8</span>
<span class="token instruction"><span class="token keyword">RUN</span> rm -rf /etc/nginx/conf.d/default.conf</span>
<span class="token instruction"><span class="token keyword">COPY</span> nginx.conf /etc/nginx/conf.d/</span>
<span class="token instruction"><span class="token keyword">COPY</span> dist/ /dist/</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>\u7F16\u5199Jenkins\u811A\u672C</p></blockquote><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span>
<span class="token function">npm</span> run build:prod
<span class="token function">docker</span> <span class="token function">rm</span> ruoyi-ui <span class="token parameter variable">-f</span>
<span class="token function">docker</span> build <span class="token parameter variable">-t</span> ruoyi-ui <span class="token builtin class-name">.</span>
<span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">--name</span> ruoyi-ui <span class="token parameter variable">-p</span> <span class="token number">81</span>:81 ruoyi-ui
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="\u53C2\u8003\u6587\u7AE0" tabindex="-1"><a class="header-anchor" href="#\u53C2\u8003\u6587\u7AE0" aria-hidden="true">#</a> \u53C2\u8003\u6587\u7AE0</h2><ul><li>\u90E8\u95E8\u540C\u4E8B\u6797\u54F2\u8C6A\u7684\u5206\u4EAB\u4F1A</li></ul>`,142);function z(R,U){const e=o("ExternalLinkIcon");return t(),c("div",null,[p,n("table",null,[r,n("tbody",null,[n("tr",null,[u,n("td",null,[s("\u53D8\u91CF\u4E2D\u5B58\u653E\u4E86\u8BF7\u6C42URL\u4E2D\u7684\u8BF7\u6C42\u53C2\u6570\u3002\u6BD4\u5982"),n("a",v,[s('http://192.168.200.133/server?arg1=value1&args2=value2\u4E2D\u7684"arg1=value1&arg2=value2"\uFF0C\u529F\u80FD\u548C$query_string\u4E00\u6837'),a(e)])])]),k,b,n("tr",null,[m,n("td",null,[s("\u53D8\u91CF\u5B58\u50A8\u7684\u662F\u5F53\u524D\u8BBF\u95EE\u5730\u5740\u7684URI\u3002\u6BD4\u5982"),n("a",h,[s('http://192.168.200.133/server?id=10&name=zhangsan\u4E2D\u7684"/server"\uFF0C\u529F\u80FD\u548C$uri\u4E00\u6837'),a(e)])])]),g,x,f,y,w,_,q,$,E,A,T,C,P,H,S,L,n("tr",null,[B,n("td",null,[s("\u53D8\u91CF\u4E2D\u5B58\u50A8\u4E86\u5F53\u524D\u8BF7\u6C42\u7684URI\uFF0C\u5E76\u4E14\u643A\u5E26\u8BF7\u6C42\u53C2\u6570\uFF0C\u6BD4\u5982"),n("a",D,[s('http://192.168.200.133/server?id=10&name=zhangsan\u4E2D\u7684"/server?id=10&name=zhangsan"'),a(e)])])])])]),N])}const F=l(d,[["render",z],["__file","nginx-x-start.html.vue"]]);export{F as default};
