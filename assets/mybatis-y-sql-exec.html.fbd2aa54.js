import{_ as a}from"./_plugin-vue_export-helper.cdc0426e.js";import{o as t,c as e,a as n,d as p,f as o,r as c}from"./app.74b2ce1e.js";const i={},l=o(`<h1 id="mybatis\u8BE6\u89E3-\u521D\u59CB\u5316\u57FA\u672C\u8FC7\u7A0B" tabindex="-1"><a class="header-anchor" href="#mybatis\u8BE6\u89E3-\u521D\u59CB\u5316\u57FA\u672C\u8FC7\u7A0B" aria-hidden="true">#</a> MyBatis\u8BE6\u89E3 - \u521D\u59CB\u5316\u57FA\u672C\u8FC7\u7A0B</h1><blockquote><p>\u4ECE\u4E0A\u6587\u6211\u4EEC\u77E5\u9053MyBatis\u548C\u6570\u636E\u5E93\u7684\u4EA4\u4E92\u6709\u4E24\u79CD\u65B9\u5F0F\u6709Java API\u548CMapper\u63A5\u53E3\u4E24\u79CD\uFF0C\u6240\u4EE5MyBatis\u7684\u521D\u59CB\u5316\u5FC5\u7136\u4E5F\u6709\u4E24\u79CD\uFF1B\u90A3\u4E48MyBatis\u662F\u5982\u4F55\u521D\u59CB\u5316\u7684\u5462\uFF1F</p></blockquote><h2 id="_1-mybatis\u521D\u59CB\u5316\u7684\u65B9\u5F0F\u53CA\u5F15\u5165" tabindex="-1"><a class="header-anchor" href="#_1-mybatis\u521D\u59CB\u5316\u7684\u65B9\u5F0F\u53CA\u5F15\u5165" aria-hidden="true">#</a> 1. MyBatis\u521D\u59CB\u5316\u7684\u65B9\u5F0F\u53CA\u5F15\u5165</h2><p>MyBatis\u7684\u521D\u59CB\u5316\u53EF\u4EE5\u6709\u4E24\u79CD\u65B9\u5F0F\uFF1A</p><ul><li><strong>\u57FA\u4E8EXML\u914D\u7F6E\u6587\u4EF6</strong>\uFF1A\u57FA\u4E8EXML\u914D\u7F6E\u6587\u4EF6\u7684\u65B9\u5F0F\u662F\u5C06MyBatis\u7684\u6240\u6709\u914D\u7F6E\u4FE1\u606F\u653E\u5728XML\u6587\u4EF6\u4E2D\uFF0CMyBatis\u901A\u8FC7\u52A0\u8F7D\u5E76XML\u914D\u7F6E\u6587\u4EF6\uFF0C\u5C06\u914D\u7F6E\u6587\u4FE1\u606F\u7EC4\u88C5\u6210\u5185\u90E8\u7684Configuration\u5BF9\u8C61\u3002</li><li><strong>\u57FA\u4E8EJava API</strong>\uFF1A\u8FD9\u79CD\u65B9\u5F0F\u4E0D\u4F7F\u7528XML\u914D\u7F6E\u6587\u4EF6\uFF0C\u9700\u8981MyBatis\u4F7F\u7528\u8005\u5728Java\u4EE3\u7801\u4E2D\uFF0C\u624B\u52A8\u521B\u5EFAConfiguration\u5BF9\u8C61\uFF0C\u7136\u540E\u5C06\u914D\u7F6E\u53C2\u6570set \u8FDB\u5165Configuration\u5BF9\u8C61\u4E2D\u3002</li></ul><h2 id="_2-\u521D\u59CB\u5316\u65B9\u5F0F-xml\u914D\u7F6E" tabindex="-1"><a class="header-anchor" href="#_2-\u521D\u59CB\u5316\u65B9\u5F0F-xml\u914D\u7F6E" aria-hidden="true">#</a> 2. \u521D\u59CB\u5316\u65B9\u5F0F - XML\u914D\u7F6E</h2><blockquote><p>\u63A5\u4E0B\u6765\u6211\u4EEC\u5C06\u901A\u8FC7 \u57FA\u4E8EXML\u914D\u7F6E\u6587\u4EF6\u65B9\u5F0F\u7684MyBatis\u521D\u59CB\u5316\uFF0C\u6DF1\u5165\u63A2\u8BA8MyBatis\u662F\u5982\u4F55\u901A\u8FC7\u914D\u7F6E\u6587\u4EF6\u6784\u5EFAConfiguration\u5BF9\u8C61\uFF0C\u5E76\u4F7F\u7528\u5B83\u3002</p></blockquote><p>\u73B0\u5728\u5C31\u4ECE\u4F7F\u7528MyBatis\u7684\u7B80\u5355\u4F8B\u5B50\u5165\u624B\uFF0C\u6DF1\u5165\u5206\u6790\u4E00\u4E0BMyBatis\u662F\u600E\u6837\u5B8C\u6210\u521D\u59CB\u5316\u7684\uFF0C\u90FD\u521D\u59CB\u5316\u4E86\u4EC0\u4E48\u3002\u770B\u4EE5\u4E0B\u4EE3\u7801\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// mybatis\u521D\u59CB\u5316</span>
<span class="token class-name">String</span> resource <span class="token operator">=</span> <span class="token string">&quot;mybatis-config.xml&quot;</span><span class="token punctuation">;</span>  
<span class="token class-name">InputStream</span> inputStream <span class="token operator">=</span> <span class="token class-name">Resources</span><span class="token punctuation">.</span><span class="token function">getResourceAsStream</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token class-name">SqlSessionFactory</span> sqlSessionFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SqlSessionFactoryBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>inputStream<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// \u521B\u5EFASqlSession</span>
<span class="token class-name">SqlSession</span> sqlSession <span class="token operator">=</span> sqlSessionFactory<span class="token punctuation">.</span><span class="token function">openSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  

<span class="token comment">// \u6267\u884CSQL\u8BED\u53E5</span>
<span class="token class-name">List</span> list <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span><span class="token function">selectList</span><span class="token punctuation">(</span><span class="token string">&quot;com.foo.bean.BlogMapper.queryAllBlogInfo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6709\u8FC7MyBatis\u4F7F\u7528\u7ECF\u9A8C\u7684\u8BFB\u8005\u4F1A\u77E5\u9053\uFF0C\u4E0A\u8FF0\u8BED\u53E5\u7684\u4F5C\u7528\u662F\u6267\u884C<code>com.foo.bean.BlogMapper.queryAllBlogInfo</code> \u5B9A\u4E49\u7684SQL\u8BED\u53E5\uFF0C\u8FD4\u56DE\u4E00\u4E2AList\u7ED3\u679C\u96C6\u3002\u603B\u7684\u6765\u8BF4\uFF0C\u4E0A\u8FF0\u4EE3\u7801\u7ECF\u5386\u4E86\u4E09\u4E2A\u9636\u6BB5(\u672C\u7CFB\u5217\u4E5F\u5BF9\u5E94\u4E09\u7BC7\u6587\u7AE0\u5206\u522B\u8BB2\u89E3)\uFF1A</p><ul><li><code>mybatis\u521D\u59CB\u5316</code> \u672C\u6587</li><li><code>\u521B\u5EFASqlSession</code> - \u8BE6\u89E3\u540E\u6587</li><li><code>\u6267\u884CSQL\u8BED\u53E5</code> - \u8BE6\u89E3\u540E\u6587</li></ul><p>\u4E0A\u8FF0\u4EE3\u7801\u7684\u529F\u80FD\u662F\u6839\u636E\u914D\u7F6E\u6587\u4EF6mybatis-config.xml \u914D\u7F6E\u6587\u4EF6\uFF0C\u521B\u5EFASqlSessionFactory\u5BF9\u8C61\uFF0C\u7136\u540E\u4EA7\u751FSqlSession\uFF0C\u6267\u884CSQL\u8BED\u53E5\u3002\u800Cmybatis\u7684\u521D\u59CB\u5316\u5C31\u53D1\u751F\u5728\u7B2C\u4E09\u53E5\uFF1ASqlSessionFactory sqlSessionFactory = new SqlSessionFactoryBuilder().build(inputStream); \u73B0\u5728\u5C31\u8BA9\u6211\u4EEC\u770B\u770B\u7B2C\u4E09\u53E5\u5230\u5E95\u53D1\u751F\u4E86\u4EC0\u4E48\u3002</p><h3 id="_2-1-mybatis\u521D\u59CB\u5316\u57FA\u672C\u8FC7\u7A0B" tabindex="-1"><a class="header-anchor" href="#_2-1-mybatis\u521D\u59CB\u5316\u57FA\u672C\u8FC7\u7A0B" aria-hidden="true">#</a> 2.1 MyBatis\u521D\u59CB\u5316\u57FA\u672C\u8FC7\u7A0B\uFF1A</h3><p>SqlSessionFactoryBuilder\u6839\u636E\u4F20\u5165\u7684\u6570\u636E\u6D41\u751F\u6210Configuration\u5BF9\u8C61\uFF0C\u7136\u540E\u6839\u636EConfiguration\u5BF9\u8C61\u521B\u5EFA\u9ED8\u8BA4\u7684SqlSessionFactory\u5B9E\u4F8B\u3002</p><p>\u521D\u59CB\u5316\u7684\u57FA\u672C\u8FC7\u7A0B\u5982\u4E0B\u5E8F\u5217\u56FE\u6240\u793A\uFF1A</p><p><img src="https://abelsun-1256449468.cos.ap-beijing.myqcloud.com/image/image-20220727210742812.png" alt="image-20220727210742812"></p><p>\u7531\u4E0A\u56FE\u6240\u793A\uFF0Cmybatis\u521D\u59CB\u5316\u8981\u7ECF\u8FC7\u7B80\u5355\u7684\u4EE5\u4E0B\u51E0\u6B65\uFF1A</p><ul><li>\u8C03\u7528SqlSessionFactoryBuilder\u5BF9\u8C61\u7684build(inputStream)\u65B9\u6CD5\uFF1B</li><li>SqlSessionFactoryBuilder\u4F1A\u6839\u636E\u8F93\u5165\u6D41inputStream\u7B49\u4FE1\u606F\u521B\u5EFAXMLConfigBuilder\u5BF9\u8C61;</li><li>SqlSessionFactoryBuilder\u8C03\u7528XMLConfigBuilder\u5BF9\u8C61\u7684parse()\u65B9\u6CD5\uFF1B</li><li>XMLConfigBuilder\u5BF9\u8C61\u8FD4\u56DEConfiguration\u5BF9\u8C61\uFF1B</li><li>SqlSessionFactoryBuilder\u6839\u636EConfiguration\u5BF9\u8C61\u521B\u5EFA\u4E00\u4E2ADefaultSessionFactory\u5BF9\u8C61\uFF1B</li><li>SqlSessionFactoryBuilder\u8FD4\u56DE DefaultSessionFactory\u5BF9\u8C61\u7ED9Client\uFF0C\u4F9BClient\u4F7F\u7528\u3002</li></ul><p>SqlSessionFactoryBuilder\u76F8\u5173\u7684\u4EE3\u7801\u5982\u4E0B\u6240\u793A\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">SqlSessionFactory</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token class-name">InputStream</span> inputStream<span class="token punctuation">)</span>  <span class="token punctuation">{</span>  
    <span class="token keyword">return</span> <span class="token function">build</span><span class="token punctuation">(</span>inputStream<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span>  

<span class="token keyword">public</span> <span class="token class-name">SqlSessionFactory</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token class-name">InputStream</span> inputStream<span class="token punctuation">,</span> <span class="token class-name">String</span> environment<span class="token punctuation">,</span> <span class="token class-name">Properties</span> properties<span class="token punctuation">)</span>  <span class="token punctuation">{</span>  
    <span class="token keyword">try</span>  <span class="token punctuation">{</span>  
        <span class="token comment">//2. \u521B\u5EFAXMLConfigBuilder\u5BF9\u8C61\u7528\u6765\u89E3\u6790XML\u914D\u7F6E\u6587\u4EF6\uFF0C\u751F\u6210Configuration\u5BF9\u8C61  </span>
        <span class="token class-name">XMLConfigBuilder</span> parser <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLConfigBuilder</span><span class="token punctuation">(</span>inputStream<span class="token punctuation">,</span> environment<span class="token punctuation">,</span> properties<span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token comment">//3. \u5C06XML\u914D\u7F6E\u6587\u4EF6\u5185\u7684\u4FE1\u606F\u89E3\u6790\u6210Java\u5BF9\u8C61Configuration\u5BF9\u8C61  </span>
        <span class="token class-name">Configuration</span> config <span class="token operator">=</span> parser<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token comment">//4. \u6839\u636EConfiguration\u5BF9\u8C61\u521B\u5EFA\u51FASqlSessionFactory\u5BF9\u8C61  </span>
        <span class="token keyword">return</span> <span class="token function">build</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
        <span class="token keyword">throw</span> <span class="token class-name">ExceptionFactory</span><span class="token punctuation">.</span><span class="token function">wrapException</span><span class="token punctuation">(</span><span class="token string">&quot;Error building SqlSession.&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>  
        <span class="token class-name">ErrorContext</span><span class="token punctuation">.</span><span class="token function">instance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token keyword">try</span> <span class="token punctuation">{</span>  
            inputStream<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
            <span class="token comment">// Intentionally ignore. Prefer previous error.  </span>
        <span class="token punctuation">}</span>  
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// \u4ECE\u6B64\u5904\u53EF\u4EE5\u770B\u51FA\uFF0CMyBatis\u5185\u90E8\u901A\u8FC7Configuration\u5BF9\u8C61\u6765\u521B\u5EFASqlSessionFactory,\u7528\u6237\u4E5F\u53EF\u4EE5\u81EA\u5DF1\u901A\u8FC7API\u6784\u9020\u597DConfiguration\u5BF9\u8C61\uFF0C\u8C03\u7528\u6B64\u65B9\u6CD5\u521BSqlSessionFactory  </span>
<span class="token keyword">public</span> <span class="token class-name">SqlSessionFactory</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token class-name">Configuration</span> config<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">DefaultSqlSessionFactory</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span>  

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E0A\u8FF0\u7684\u521D\u59CB\u5316\u8FC7\u7A0B\u4E2D\uFF0C\u6D89\u53CA\u5230\u4E86\u4EE5\u4E0B\u51E0\u4E2A\u5BF9\u8C61\uFF1A</p><ul><li>SqlSessionFactoryBuilder \uFF1A SqlSessionFactory\u7684\u6784\u9020\u5668\uFF0C\u7528\u4E8E\u521B\u5EFASqlSessionFactory\uFF0C\u91C7\u7528\u4E86Builder\u8BBE\u8BA1\u6A21\u5F0F</li><li>Configuration \uFF1A\u8BE5\u5BF9\u8C61\u662Fmybatis-config.xml\u6587\u4EF6\u4E2D\u6240\u6709mybatis\u914D\u7F6E\u4FE1\u606F</li><li>SqlSessionFactory\uFF1ASqlSession\u5DE5\u5382\u7C7B\uFF0C\u4EE5\u5DE5\u5382\u5F62\u5F0F\u521B\u5EFASqlSession\u5BF9\u8C61\uFF0C\u91C7\u7528\u4E86Factory\u5DE5\u5382\u8BBE\u8BA1\u6A21\u5F0F</li><li>XmlConfigParser \uFF1A\u8D1F\u8D23\u5C06mybatis-config.xml\u914D\u7F6E\u6587\u4EF6\u89E3\u6790\u6210Configuration\u5BF9\u8C61\uFF0C\u4F9BSqlSessonFactoryBuilder\u4F7F\u7528\uFF0C\u521B\u5EFASqlSessionFactory</li></ul><h3 id="_2-2-\u521B\u5EFAconfiguration\u5BF9\u8C61\u7684\u8FC7\u7A0B" tabindex="-1"><a class="header-anchor" href="#_2-2-\u521B\u5EFAconfiguration\u5BF9\u8C61\u7684\u8FC7\u7A0B" aria-hidden="true">#</a> 2.2 \u521B\u5EFAConfiguration\u5BF9\u8C61\u7684\u8FC7\u7A0B</h3><blockquote><p>\u63A5\u7740\u4E0A\u8FF0\u7684 MyBatis\u521D\u59CB\u5316\u57FA\u672C\u8FC7\u7A0B\u8BA8\u8BBA\uFF0C\u5F53SqlSessionFactoryBuilder\u6267\u884Cbuild()\u65B9\u6CD5\uFF0C\u8C03\u7528\u4E86XMLConfigBuilder\u7684parse()\u65B9\u6CD5\uFF0C\u7136\u540E\u8FD4\u56DE\u4E86Configuration\u5BF9\u8C61\u3002\u90A3\u4E48parse()\u65B9\u6CD5\u662F\u5982\u4F55\u5904\u7406XML\u6587\u4EF6\uFF0C\u751F\u6210Configuration\u5BF9\u8C61\u7684\u5462\uFF1F</p></blockquote><ul><li><strong>XMLConfigBuilder\u4F1A\u5C06XML\u914D\u7F6E\u6587\u4EF6\u7684\u4FE1\u606F\u8F6C\u6362\u4E3ADocument\u5BF9\u8C61</strong></li></ul><p>\u800CXML\u914D\u7F6E\u5B9A\u4E49\u6587\u4EF6DTD\u8F6C\u6362\u6210XMLMapperEntityResolver\u5BF9\u8C61\uFF0C\u7136\u540E\u5C06\u4E8C\u8005\u5C01\u88C5\u5230XpathParser\u5BF9\u8C61\u4E2D\uFF0CXpathParser\u7684\u4F5C\u7528\u662F\u63D0\u4F9B\u6839\u636EXpath\u8868\u8FBE\u5F0F\u83B7\u53D6\u57FA\u672C\u7684DOM\u8282\u70B9Node\u4FE1\u606F\u7684\u64CD\u4F5C\u3002\u5982\u4E0B\u56FE\u6240\u793A\uFF1A</p><p><img src="https://abelsun-1256449468.cos.ap-beijing.myqcloud.com/image/image-20220727211258017.png" alt="image-20220727211258017"></p><p><img src="https://abelsun-1256449468.cos.ap-beijing.myqcloud.com/image/image-20220727211314772.png" alt="image-20220727211314772"></p><ul><li><strong>\u4E4B\u540EXMLConfigBuilder\u8C03\u7528parse()\u65B9\u6CD5</strong></li></ul><p>\u4F1A\u4ECEXPathParser\u4E2D\u53D6\u51FA<code>&lt;configuration&gt;</code>\u8282\u70B9\u5BF9\u5E94\u7684Node\u5BF9\u8C61\uFF0C\u7136\u540E\u89E3\u6790\u6B64Node\u8282\u70B9\u7684\u5B50Node\uFF1Aproperties, settings, typeAliases,typeHandlers, objectFactory, objectWrapperFactory, plugins, environments,databaseIdProvider, mappers\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">Configuration</span> <span class="token function">parse</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
    <span class="token keyword">if</span> <span class="token punctuation">(</span>parsed<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BuilderException</span><span class="token punctuation">(</span><span class="token string">&quot;Each XMLConfigBuilder can only be used once.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
    parsed <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>  
    <span class="token comment">//\u6E90\u7801\u4E2D\u6CA1\u6709\u8FD9\u4E00\u53E5\uFF0C\u53EA\u6709 parseConfiguration(parser.evalNode(&quot;/configuration&quot;));  </span>
    <span class="token comment">//\u4E3A\u4E86\u8BA9\u8BFB\u8005\u770B\u5F97\u66F4\u660E\u6670\uFF0C\u6E90\u7801\u62C6\u5206\u4E3A\u4EE5\u4E0B\u4E24\u53E5  </span>
    <span class="token class-name">XNode</span> configurationNode <span class="token operator">=</span> parser<span class="token punctuation">.</span><span class="token function">evalNode</span><span class="token punctuation">(</span><span class="token string">&quot;/configuration&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token function">parseConfiguration</span><span class="token punctuation">(</span>configurationNode<span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token keyword">return</span> configuration<span class="token punctuation">;</span>  
<span class="token punctuation">}</span>  
<span class="token doc-comment comment">/** 
 * \u89E3\u6790 &quot;/configuration&quot;\u8282\u70B9\u4E0B\u7684\u5B50\u8282\u70B9\u4FE1\u606F\uFF0C\u7136\u540E\u5C06\u89E3\u6790\u7684\u7ED3\u679C\u8BBE\u7F6E\u5230Configuration\u5BF9\u8C61\u4E2D 
 */</span>  
<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">parseConfiguration</span><span class="token punctuation">(</span><span class="token class-name">XNode</span> root<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
    <span class="token keyword">try</span> <span class="token punctuation">{</span>  
        <span class="token comment">//1.\u9996\u5148\u5904\u7406properties \u8282\u70B9     </span>
        <span class="token function">propertiesElement</span><span class="token punctuation">(</span>root<span class="token punctuation">.</span><span class="token function">evalNode</span><span class="token punctuation">(</span><span class="token string">&quot;properties&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//issue #117 read properties first  </span>
        <span class="token comment">//2.\u5904\u7406typeAliases  </span>
        <span class="token function">typeAliasesElement</span><span class="token punctuation">(</span>root<span class="token punctuation">.</span><span class="token function">evalNode</span><span class="token punctuation">(</span><span class="token string">&quot;typeAliases&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token comment">//3.\u5904\u7406\u63D2\u4EF6  </span>
        <span class="token function">pluginElement</span><span class="token punctuation">(</span>root<span class="token punctuation">.</span><span class="token function">evalNode</span><span class="token punctuation">(</span><span class="token string">&quot;plugins&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token comment">//4.\u5904\u7406objectFactory  </span>
        <span class="token function">objectFactoryElement</span><span class="token punctuation">(</span>root<span class="token punctuation">.</span><span class="token function">evalNode</span><span class="token punctuation">(</span><span class="token string">&quot;objectFactory&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token comment">//5.objectWrapperFactory  </span>
        <span class="token function">objectWrapperFactoryElement</span><span class="token punctuation">(</span>root<span class="token punctuation">.</span><span class="token function">evalNode</span><span class="token punctuation">(</span><span class="token string">&quot;objectWrapperFactory&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token comment">//6.settings  </span>
        <span class="token function">settingsElement</span><span class="token punctuation">(</span>root<span class="token punctuation">.</span><span class="token function">evalNode</span><span class="token punctuation">(</span><span class="token string">&quot;settings&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token comment">//7.\u5904\u7406environments  </span>
        <span class="token function">environmentsElement</span><span class="token punctuation">(</span>root<span class="token punctuation">.</span><span class="token function">evalNode</span><span class="token punctuation">(</span><span class="token string">&quot;environments&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// read it after objectFactory and objectWrapperFactory issue #631  </span>
        <span class="token comment">//8.database  </span>
        <span class="token function">databaseIdProviderElement</span><span class="token punctuation">(</span>root<span class="token punctuation">.</span><span class="token function">evalNode</span><span class="token punctuation">(</span><span class="token string">&quot;databaseIdProvider&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token comment">//9.typeHandlers  </span>
        <span class="token function">typeHandlerElement</span><span class="token punctuation">(</span>root<span class="token punctuation">.</span><span class="token function">evalNode</span><span class="token punctuation">(</span><span class="token string">&quot;typeHandlers&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token comment">//10.mappers  </span>
        <span class="token function">mapperElement</span><span class="token punctuation">(</span>root<span class="token punctuation">.</span><span class="token function">evalNode</span><span class="token punctuation">(</span><span class="token string">&quot;mappers&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BuilderException</span><span class="token punctuation">(</span><span class="token string">&quot;Error parsing SQL Mapper Configuration. Cause: &quot;</span> <span class="token operator">+</span> e<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
<span class="token punctuation">}</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6CE8\u610F\uFF1A\u5728\u4E0A\u8FF0\u4EE3\u7801\u4E2D\uFF0C\u8FD8\u6709\u4E00\u4E2A\u975E\u5E38\u91CD\u8981\u7684\u5730\u65B9\uFF0C\u5C31\u662F\u89E3\u6790XML\u914D\u7F6E\u6587\u4EF6\u5B50\u8282\u70B9<code>&lt;mappers&gt;</code>\u7684\u65B9\u6CD5mapperElements(root.evalNode(&quot;mappers&quot;)), \u5B83\u5C06\u89E3\u6790\u6211\u4EEC\u914D\u7F6E\u7684Mapper.xml\u914D\u7F6E\u6587\u4EF6\uFF0CMapper\u914D\u7F6E\u6587\u4EF6\u53EF\u4EE5\u8BF4\u662FMyBatis\u7684\u6838\u5FC3\uFF0CMyBatis\u7684\u7279\u6027\u548C\u7406\u5FF5\u90FD\u4F53\u73B0\u5728\u6B64Mapper\u7684\u914D\u7F6E\u548C\u8BBE\u8BA1\u4E0A\u3002</p><ul><li><strong>\u7136\u540E\u5C06\u8FD9\u4E9B\u503C\u89E3\u6790\u51FA\u6765\u8BBE\u7F6E\u5230Configuration\u5BF9\u8C61\u4E2D</strong></li></ul><p>\u89E3\u6790\u5B50\u8282\u70B9\u7684\u8FC7\u7A0B\u8FD9\u91CC\u5C31\u4E0D\u4E00\u4E00\u4ECB\u7ECD\u4E86\uFF0C\u7528\u6237\u53EF\u4EE5\u53C2\u7167MyBatis\u6E90\u7801\u4ED4\u7EC6\u63E3\u6469\uFF0C\u6211\u4EEC\u5C31\u770B\u4E0A\u8FF0\u7684environmentsElement(root.evalNode(&quot;environments&quot;)); \u65B9\u6CD5\u662F\u5982\u4F55\u5C06environments\u7684\u4FE1\u606F\u89E3\u6790\u51FA\u6765\uFF0C\u8BBE\u7F6E\u5230Configuration\u5BF9\u8C61\u4E2D\u7684\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/** 
 * \u89E3\u6790environments\u8282\u70B9\uFF0C\u5E76\u5C06\u7ED3\u679C\u8BBE\u7F6E\u5230Configuration\u5BF9\u8C61\u4E2D 
 * \u6CE8\u610F\uFF1A\u521B\u5EFAenvronment\u65F6\uFF0C\u5982\u679CSqlSessionFactoryBuilder\u6307\u5B9A\u4E86\u7279\u5B9A\u7684\u73AF\u5883\uFF08\u5373\u6570\u636E\u6E90\uFF09\uFF1B 
 *      \u5219\u8FD4\u56DE\u6307\u5B9A\u73AF\u5883\uFF08\u6570\u636E\u6E90\uFF09\u7684Environment\u5BF9\u8C61\uFF0C\u5426\u5219\u8FD4\u56DE\u9ED8\u8BA4\u7684Environment\u5BF9\u8C61\uFF1B 
 *      \u8FD9\u79CD\u65B9\u5F0F\u5B9E\u73B0\u4E86MyBatis\u53EF\u4EE5\u8FDE\u63A5\u591A\u6570\u636E\u6E90 
 */</span>  
<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">environmentsElement</span><span class="token punctuation">(</span><span class="token class-name">XNode</span> context<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>  
    <span class="token keyword">if</span> <span class="token punctuation">(</span>context <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>  
    <span class="token punctuation">{</span>  
        <span class="token keyword">if</span> <span class="token punctuation">(</span>environment <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>  
        <span class="token punctuation">{</span>  
            environment <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getStringAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;default&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token punctuation">}</span>  
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">XNode</span> child <span class="token operator">:</span> context<span class="token punctuation">.</span><span class="token function">getChildren</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  
        <span class="token punctuation">{</span>  
            <span class="token class-name">String</span> id <span class="token operator">=</span> child<span class="token punctuation">.</span><span class="token function">getStringAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isSpecifiedEnvironment</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span>  
            <span class="token punctuation">{</span>  
                <span class="token comment">//1.\u521B\u5EFA\u4E8B\u52A1\u5DE5\u5382 TransactionFactory  </span>
                <span class="token class-name">TransactionFactory</span> txFactory <span class="token operator">=</span> <span class="token function">transactionManagerElement</span><span class="token punctuation">(</span>child<span class="token punctuation">.</span><span class="token function">evalNode</span><span class="token punctuation">(</span><span class="token string">&quot;transactionManager&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
                <span class="token class-name">DataSourceFactory</span> dsFactory <span class="token operator">=</span> <span class="token function">dataSourceElement</span><span class="token punctuation">(</span>child<span class="token punctuation">.</span><span class="token function">evalNode</span><span class="token punctuation">(</span><span class="token string">&quot;dataSource&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
                <span class="token comment">//2.\u521B\u5EFA\u6570\u636E\u6E90DataSource  </span>
                <span class="token class-name">DataSource</span> dataSource <span class="token operator">=</span> dsFactory<span class="token punctuation">.</span><span class="token function">getDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
                <span class="token comment">//3. \u6784\u9020Environment\u5BF9\u8C61  </span>
                <span class="token class-name">Environment<span class="token punctuation">.</span>Builder</span> environmentBuilder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Environment<span class="token punctuation">.</span>Builder</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>  
                <span class="token punctuation">.</span><span class="token function">transactionFactory</span><span class="token punctuation">(</span>txFactory<span class="token punctuation">)</span>  
                <span class="token punctuation">.</span><span class="token function">dataSource</span><span class="token punctuation">(</span>dataSource<span class="token punctuation">)</span><span class="token punctuation">;</span>  
                <span class="token comment">//4. \u5C06\u521B\u5EFA\u7684Envronment\u5BF9\u8C61\u8BBE\u7F6E\u5230configuration \u5BF9\u8C61\u4E2D  </span>
                configuration<span class="token punctuation">.</span><span class="token function">setEnvironment</span><span class="token punctuation">(</span>environmentBuilder<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
            <span class="token punctuation">}</span>  
        <span class="token punctuation">}</span>  
    <span class="token punctuation">}</span>  
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token keyword">boolean</span> <span class="token function">isSpecifiedEnvironment</span><span class="token punctuation">(</span><span class="token class-name">String</span> id<span class="token punctuation">)</span>  
<span class="token punctuation">{</span>  
    <span class="token keyword">if</span> <span class="token punctuation">(</span>environment <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>  
    <span class="token punctuation">{</span>  
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BuilderException</span><span class="token punctuation">(</span><span class="token string">&quot;No environment specified.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>id <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>  
    <span class="token punctuation">{</span>  
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BuilderException</span><span class="token punctuation">(</span><span class="token string">&quot;Environment requires an id attribute.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>environment<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span>  
    <span class="token punctuation">{</span>  
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span> 

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>\u8FD4\u56DEConfiguration\u5BF9\u8C61</strong></li></ul><p>\u5C06\u4E0A\u8FF0\u7684MyBatis\u521D\u59CB\u5316\u57FA\u672C\u8FC7\u7A0B\u7684\u5E8F\u5217\u56FE\u7EC6\u5316\uFF1A</p><p><img src="https://abelsun-1256449468.cos.ap-beijing.myqcloud.com/image/image-20220727211928263.png" alt="image-20220727211928263"></p><h2 id="_3-\u521D\u59CB\u5316\u65B9\u5F0F-\u57FA\u4E8Ejava-api" tabindex="-1"><a class="header-anchor" href="#_3-\u521D\u59CB\u5316\u65B9\u5F0F-\u57FA\u4E8Ejava-api" aria-hidden="true">#</a> 3. \u521D\u59CB\u5316\u65B9\u5F0F - \u57FA\u4E8EJava API</h2><blockquote><p>\u8FD9\u5757\u6709\u70B9\u5947\u602A,\u8FD8\u9700\u6DF1\u5165\u4E86\u89E3</p></blockquote><p>\u5F53\u7136\u6211\u4EEC\u53EF\u4EE5\u4F7F\u7528XMLConfigBuilder\u624B\u52A8\u89E3\u6790XML\u914D\u7F6E\u6587\u4EF6\u6765\u521B\u5EFAConfiguration\u5BF9\u8C61\uFF0C\u4EE3\u7801\u5982\u4E0B\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">String</span> resource <span class="token operator">=</span> <span class="token string">&quot;mybatis-config.xml&quot;</span><span class="token punctuation">;</span>  
<span class="token class-name">InputStream</span> inputStream <span class="token operator">=</span> <span class="token class-name">Resources</span><span class="token punctuation">.</span><span class="token function">getResourceAsStream</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token comment">// \u624B\u52A8\u521B\u5EFAXMLConfigBuilder\uFF0C\u5E76\u89E3\u6790\u521B\u5EFAConfiguration\u5BF9\u8C61  </span>
<span class="token class-name">XMLConfigBuilder</span> parser <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLConfigBuilder</span><span class="token punctuation">(</span>inputStream<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \u770B\u8FD9\u91CC </span>
<span class="token class-name">Configuration</span> configuration <span class="token operator">=</span> parser<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token comment">// \u4F7F\u7528Configuration\u5BF9\u8C61\u521B\u5EFASqlSessionFactory  </span>
<span class="token class-name">SqlSessionFactory</span> sqlSessionFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SqlSessionFactoryBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>configuration<span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token comment">// \u4F7F\u7528MyBatis  </span>
<span class="token class-name">SqlSession</span> sqlSession <span class="token operator">=</span> sqlSessionFactory<span class="token punctuation">.</span><span class="token function">openSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token class-name">List</span> list <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span><span class="token function">selectList</span><span class="token punctuation">(</span><span class="token string">&quot;com.foo.bean.BlogMapper.queryAllBlogInfo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  

  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="\u53C2\u8003\u6587\u7AE0" tabindex="-1"><a class="header-anchor" href="#\u53C2\u8003\u6587\u7AE0" aria-hidden="true">#</a> \u53C2\u8003\u6587\u7AE0</h2>`,43),u={href:"https://pdai.tech/md/framework/orm-mybatis/mybatis-y-init.html",target:"_blank",rel:"noopener noreferrer"},r=n("strong",null,"MyBatis\u8BE6\u89E3 - \u521D\u59CB\u5316\u57FA\u672C\u8FC7\u7A0B",-1);function k(d,m){const s=c("ExternalLinkIcon");return t(),e("div",null,[l,n("p",null,[n("a",u,[r,p(s)])])])}const g=a(i,[["render",k],["__file","mybatis-y-sql-exec.html.vue"]]);export{g as default};
