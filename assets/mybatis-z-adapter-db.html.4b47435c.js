import{_ as n}from"./_plugin-vue_export-helper.cdc0426e.js";import{o as s,c as a,f as t}from"./app.ec219279.js";const e={},p=t(`<h1 id="mybatis\u9002\u914D\u591A\u79CD\u6570\u636E\u5E93" tabindex="-1"><a class="header-anchor" href="#mybatis\u9002\u914D\u591A\u79CD\u6570\u636E\u5E93" aria-hidden="true">#</a> Mybatis\u9002\u914D\u591A\u79CD\u6570\u636E\u5E93</h1><h2 id="_1-\u7B80\u4ECB" tabindex="-1"><a class="header-anchor" href="#_1-\u7B80\u4ECB" aria-hidden="true">#</a> 1. \u7B80\u4ECB</h2><p><strong>\u52A8\u6001\u5207\u6362\u6570\u636E\u5E93</strong>\uFF0C\u5982\u5728<strong>MySQL\u3001PostgreSQL\u4E0EOracle\u4E4B\u95F4\u8FDB\u884C\u5207\u6362\uFF0C\u5E76\u4F7F\u7528\u540C\u4E00\u4E2ADao\u63A5\u53E3\u3002\u5982\u4F55\u8FDB\u884C\u540C\u4E00\u4E2A\u51FD\u6570\u8C03\u7528mapper\u4E2D\u4E0D\u540C\u7684sql\u8BED\u53E5</strong>\uFF1F</p><h2 id="_2-\u533A\u5206\u5177\u4F53\u6570\u636E\u5E93" tabindex="-1"><a class="header-anchor" href="#_2-\u533A\u5206\u5177\u4F53\u6570\u636E\u5E93" aria-hidden="true">#</a> 2. \u533A\u5206\u5177\u4F53\u6570\u636E\u5E93</h2><h3 id="_2-1-\u7406\u8BBA" tabindex="-1"><a class="header-anchor" href="#_2-1-\u7406\u8BBA" aria-hidden="true">#</a> 2.1 \u7406\u8BBA</h3><p>\u82E5\u5728MyBatis\u914D\u7F6E\u6587\u4EF6\u4E2D\u8BBE\u7F6E\u4E86databaseIdProvider\uFF0C\u5219\u53EF\u4EE5\u4F7F\u7528 _databaseId \u53C2\u6570</p><p>\u8FD9\u6837\u5C31\u53EF\u4EE5\u6839\u636E\u4E0D\u540C\u7684\u6570\u636E\u5E93\u5382\u5546\u6784\u5EFA\u7279\u5B9A\u7684\u8BED\u53E5\u3002_databaseId \u5C31\u662F\u4EE3\u8868\u5F53\u524D\u6570\u636E\u5E93\u7684\u522B\u540DOracle\u3002</p><p>databaseIdProvider\u914D\u7F6E\uFF1A</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>databaseIdProvider</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>DB_VENDOR<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>MySQL<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mysql<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    \u2026\u2026
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>databaseIdProvider</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-2-\u5728springboot-\u4E2D\u5982\u4F55\u914D\u7F6E" tabindex="-1"><a class="header-anchor" href="#_2-2-\u5728springboot-\u4E2D\u5982\u4F55\u914D\u7F6E" aria-hidden="true">#</a> 2.2 \u5728springboot \u4E2D\u5982\u4F55\u914D\u7F6E</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyBatisConfig</span>
<span class="token punctuation">{</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">DatabaseIdProvider</span> <span class="token function">getDatabaseIdProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">DatabaseIdProvider</span> databaseIdProvider <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VendorDatabaseIdProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Properties</span> properties <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        properties<span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token string">&quot;MySQL&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;mysql&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        properties<span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token string">&quot;Oracle&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;oracle&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        databaseIdProvider<span class="token punctuation">.</span><span class="token function">setProperties</span><span class="token punctuation">(</span>properties<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> databaseIdProvider<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  
  
        <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">SqlSessionFactory</span> <span class="token function">sqlSessionFactory</span><span class="token punctuation">(</span><span class="token class-name">DataSource</span> dataSource<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">final</span> <span class="token class-name">SqlSessionFactoryBean</span> sessionFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SqlSessionFactoryBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        sessionFactory<span class="token punctuation">.</span><span class="token function">setDataSource</span><span class="token punctuation">(</span>dataSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
      	<span class="token comment">// \u91CD\u70B9\u662F\u8FD9\u53E5\u9700\u8981\u914D\u7F6E\u4E0A </span>
        sessionFactory<span class="token punctuation">.</span><span class="token function">setDatabaseIdProvider</span><span class="token punctuation">(</span><span class="token function">getDatabaseIdProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token keyword">return</span> sessionFactory<span class="token punctuation">.</span><span class="token function">getObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3-\u524D\u7F6E\u914D\u7F6E" tabindex="-1"><a class="header-anchor" href="#_3-\u524D\u7F6E\u914D\u7F6E" aria-hidden="true">#</a> 3. \u524D\u7F6E\u914D\u7F6E</h2><h3 id="_3-1-mysql-\u524D\u7F6E\u914D\u7F6E" tabindex="-1"><a class="header-anchor" href="#_3-1-mysql-\u524D\u7F6E\u914D\u7F6E" aria-hidden="true">#</a> 3.1 Mysql \u524D\u7F6E\u914D\u7F6E</h3><h4 id="_3-1-1-\u5E8F\u5217\u652F\u6301" tabindex="-1"><a class="header-anchor" href="#_3-1-1-\u5E8F\u5217\u652F\u6301" aria-hidden="true">#</a> 3.1.1 \u5E8F\u5217\u652F\u6301</h4><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- ----------------------------</span>
<span class="token comment">-- Table structure for sys_sequence</span>
<span class="token comment">-- ----------------------------</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">\`</span>sys_sequence<span class="token punctuation">\`</span></span> <span class="token punctuation">(</span>
                                <span class="token identifier"><span class="token punctuation">\`</span>sequence_name<span class="token punctuation">\`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;\u5E8F\u5217\u540D\u79F0&#39;</span><span class="token punctuation">,</span>
                                <span class="token identifier"><span class="token punctuation">\`</span>sequence_value<span class="token punctuation">\`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">&#39;1&#39;</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;\u5E8F\u5217\u503C&#39;</span><span class="token punctuation">,</span>
                                <span class="token identifier"><span class="token punctuation">\`</span>increment_value<span class="token punctuation">\`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">&#39;1&#39;</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;\u589E\u91CF\u503C&#39;</span><span class="token punctuation">,</span>
                                <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">\`</span>sequence_name<span class="token punctuation">\`</span></span><span class="token punctuation">)</span> <span class="token keyword">USING</span> <span class="token keyword">BTREE</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8 ROW_FORMAT<span class="token operator">=</span>DYNAMIC <span class="token keyword">COMMENT</span><span class="token operator">=</span><span class="token string">&#39;\u5E8F\u5217&#39;</span><span class="token punctuation">;</span>

<span class="token comment">-- ----------------------------</span>
<span class="token comment">-- Records of sys_sequence</span>
<span class="token comment">-- ----------------------------</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">\`</span>sys_sequence<span class="token punctuation">\`</span></span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">&#39;seq_sys_dept&#39;</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">\`</span>sys_sequence<span class="token punctuation">\`</span></span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">&#39;seq_sys_user&#39;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-1-2-nextval\u51FD\u6570-\u517C\u5BB9oracle-\u5E8F\u5217" tabindex="-1"><a class="header-anchor" href="#_3-1-2-nextval\u51FD\u6570-\u517C\u5BB9oracle-\u5E8F\u5217" aria-hidden="true">#</a> 3.1.2 nextval\u51FD\u6570\uFF1A\u517C\u5BB9oracle \u5E8F\u5217</h4><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- ----------------------------</span>
<span class="token comment">-- Function structure for nextval</span>
<span class="token comment">-- ----------------------------</span>
<span class="token keyword">CREATE</span> <span class="token keyword">FUNCTION</span> <span class="token identifier"><span class="token punctuation">\`</span>nextval<span class="token punctuation">\`</span></span><span class="token punctuation">(</span>seq_name <span class="token keyword">varchar</span> <span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">RETURNS</span> <span class="token keyword">int</span>
    <span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span>
<span class="token keyword">begin</span> <span class="token keyword">declare</span>
sequence <span class="token keyword">int</span><span class="token punctuation">;</span> <span class="token keyword">set</span>
sequence <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">select</span> sequence_value <span class="token keyword">from</span> sys_sequence <span class="token keyword">where</span> sequence_name <span class="token operator">=</span> seq_name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">update</span> sys_sequence
<span class="token keyword">set</span> sequence_value <span class="token operator">=</span> sequence_value <span class="token operator">+</span> increment_value
<span class="token keyword">where</span> sequence_name <span class="token operator">=</span> seq_name<span class="token punctuation">;</span>
<span class="token keyword">return</span> sequence<span class="token punctuation">;</span>
<span class="token keyword">end</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-2-oracle-\u524D\u7F6E\u914D\u7F6E" tabindex="-1"><a class="header-anchor" href="#_3-2-oracle-\u524D\u7F6E\u914D\u7F6E" aria-hidden="true">#</a> 3.2 Oracle \u524D\u7F6E\u914D\u7F6E</h3><h4 id="_3-2-1-find-in-set\u51FD\u6570-\u517C\u5BB9mysql" tabindex="-1"><a class="header-anchor" href="#_3-2-1-find-in-set\u51FD\u6570-\u517C\u5BB9mysql" aria-hidden="true">#</a> 3.2.1 find_in_set\u51FD\u6570\uFF0C\u517C\u5BB9mysql</h4><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- ----------------------------</span>
<span class="token comment">-- \u51FD\u6570 \uFF0C\u4EE3\u66FFmysql\u7684find_in_set</span>
<span class="token comment">-- \u4F8B\u5982\uFF1A select * from sys_dept where FIND_IN_SET (101,ancestors) &lt;&gt; 0</span>
<span class="token comment">-- mysql\u53EF\u63A5\u53D70\u6216\u5176\u5B83number\u505A\u4E3Awhere \u6761\u4EF6\uFF0Coracle\u53EA\u63A5\u53D7\u8868\u8FBE\u5F0F\u505A\u4E3Awhere \u6761\u4EF6</span>
<span class="token comment">-- ----------------------------</span>
<span class="token keyword">create</span> <span class="token operator">or</span> <span class="token keyword">replace</span> <span class="token keyword">function</span> find_in_set<span class="token punctuation">(</span>arg1 <span class="token operator">in</span> varchar2<span class="token punctuation">,</span>arg2 <span class="token operator">in</span> <span class="token keyword">varchar</span><span class="token punctuation">)</span>
<span class="token keyword">return</span> number <span class="token operator">is</span> Result number<span class="token punctuation">;</span>
<span class="token keyword">begin</span>
<span class="token keyword">select</span> instr<span class="token punctuation">(</span><span class="token string">&#39;,&#39;</span><span class="token operator">||</span>arg2<span class="token operator">||</span><span class="token string">&#39;,&#39;</span> <span class="token punctuation">,</span> <span class="token string">&#39;,&#39;</span><span class="token operator">||</span>arg1<span class="token operator">||</span><span class="token string">&#39;,&#39;</span><span class="token punctuation">)</span> <span class="token keyword">into</span> Result <span class="token keyword">from</span> dual<span class="token punctuation">;</span>
<span class="token keyword">return</span><span class="token punctuation">(</span>Result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">end</span> find_in_set<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-3-\u9879\u76EE\u524D\u7F6E\u914D\u7F6E" tabindex="-1"><a class="header-anchor" href="#_3-3-\u9879\u76EE\u524D\u7F6E\u914D\u7F6E" aria-hidden="true">#</a> 3.3 \u9879\u76EE\u524D\u7F6E\u914D\u7F6E</h3><h4 id="_3-3-1-\u6570\u636E\u5E93\u5DE5\u5177\u7C7B" tabindex="-1"><a class="header-anchor" href="#_3-3-1-\u6570\u636E\u5E93\u5DE5\u5177\u7C7B" aria-hidden="true">#</a> 3.3.1 \u6570\u636E\u5E93\u5DE5\u5177\u7C7B</h4><p>\u6839\u636E\u4E0D\u540C\u6570\u636E\u5E93\u83B7\u53D6\u4E0D\u540C\u7684\u51FD\u6570</p><p>\u4F8B\u5982</p><ul><li>mysql \u7684\u65E5\u671F\uFF1Anow()</li><li>oracle\u7684\u5F53\u524D\u65F6\u95F4\uFF1Asysdate</li></ul><h5 id="_3-3-1-1-dbutils" tabindex="-1"><a class="header-anchor" href="#_3-3-1-1-dbutils" aria-hidden="true">#</a> 3.3.1.1 DBUtils</h5><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * \u6570\u636E\u5E93\u64CD\u4F5C\u5DE5\u5177\u7C7B
 * \u6B64\u5DE5\u5177\u7C7B\u76EE\u7684\u662F\u4E3A\u4E86\u517C\u5BB9\u591A\u4E2A\u6570\u636E\u5E93
 */</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DBUtils</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">VendorDatabaseIdProvider</span> databaseIdProvider<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">DataSource</span> dataSource<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">DBType</span> <span class="token constant">DB_TYPE</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">DBUtils</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@PostConstruct</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u521D\u59CB\u5316</span>
        <span class="token class-name">String</span> databaseId <span class="token operator">=</span> databaseIdProvider<span class="token punctuation">.</span><span class="token function">getDatabaseId</span><span class="token punctuation">(</span>dataSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token constant">DB_TYPE</span> <span class="token operator">=</span> <span class="token class-name">DBType</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">upperCase</span><span class="token punctuation">(</span>databaseId<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * \u83B7\u5F97\u5F53\u524D\u65F6\u95F4
     *
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">getCurrentTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">String</span> result <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">DB_TYPE</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">DBType</span><span class="token punctuation">.</span><span class="token constant">MYSQL</span><span class="token punctuation">)</span><span class="token operator">||</span><span class="token constant">DB_TYPE</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">DBType</span><span class="token punctuation">.</span><span class="token constant">POSTGRESQL</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            result <span class="token operator">=</span> <span class="token string">&quot;now()&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">DB_TYPE</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">DBType</span><span class="token punctuation">.</span><span class="token constant">ORACLE</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            result <span class="token operator">=</span> <span class="token string">&quot;sysdate&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_3-3-1-2-dbtype" tabindex="-1"><a class="header-anchor" href="#_3-3-1-2-dbtype" aria-hidden="true">#</a> 3.3.1.2 DBType</h5><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * \u652F\u6301\u6570\u636E\u5E93\u7C7B\u578B
 *
 */</span>
<span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">DBType</span> <span class="token punctuation">{</span>
    <span class="token constant">MYSQL</span><span class="token punctuation">,</span>
    <span class="token constant">ORACLE</span><span class="token punctuation">,</span>
    <span class="token constant">POSTGRESQL</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_3-3-1-3-\u5F15\u7528" tabindex="-1"><a class="header-anchor" href="#_3-3-1-3-\u5F15\u7528" aria-hidden="true">#</a> 3.3.1.3 \u5F15\u7528</h5><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code> update sys_config
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>set</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>configName != null and configName != &#39;&#39;<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>config_name = #{configName},<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">&gt;</span></span>
            update_time = \${@com.faduit.common.utils.DBUtils@getCurrentTime()}
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>set</span><span class="token punctuation">&gt;</span></span>
        where config_id = #{configId}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_4-\u9002\u914D" tabindex="-1"><a class="header-anchor" href="#_4-\u9002\u914D" aria-hidden="true">#</a> 4. \u9002\u914D</h2><h3 id="_4-1-\u81EA\u589Eid\u95EE\u9898" tabindex="-1"><a class="header-anchor" href="#_4-1-\u81EA\u589Eid\u95EE\u9898" aria-hidden="true">#</a> 4.1 \u81EA\u589Eid\u95EE\u9898</h3><ul><li>mysql \u7684\u5B57\u6BB5\u672C\u8EAB\u5C31\u53EF\u4EE5\u8BBE\u7F6E\u81EA\u589E</li><li>Oracle \u4E2D\u4F7F\u7528\u5E8F\u5217\u505A\u81EA\u589Eid</li></ul><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>selectKey</span> <span class="token attr-name">keyProperty</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>userId<span class="token punctuation">&quot;</span></span> <span class="token attr-name">order</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>BEFORE<span class="token punctuation">&quot;</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Long<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>_databaseId == &#39;oracle&#39;<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
				select seq_sys_user.nextval as userId from DUAL
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>_databaseId == &#39;postgresql&#39;<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
				select nextval(&#39;seq_sys_user&#39;::regclass) as userId
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>_databaseId == &#39;mysql&#39;<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
				select nextval(&#39;seq_sys_user&#39;) as userId
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>selectKey</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-2-\u5206\u9875\u95EE\u9898" tabindex="-1"><a class="header-anchor" href="#_4-2-\u5206\u9875\u95EE\u9898" aria-hidden="true">#</a> 4.2 \u5206\u9875\u95EE\u9898</h3><ul><li>Mysql :\u4F7F\u7528<strong>limit</strong></li><li>oracle \uFF1A\u4F7F\u7528 <strong>rownum</strong></li></ul><p>\u4F8B\u5982\u8FD9\u91CC\u9700\u8981\u67E5\u8BE2\u662F\u5426\u5DF2\u7ECF\u5B58\u5728\u7528\u6237\u540D</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>checkUserNameUnique<span class="token punctuation">&quot;</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>String<span class="token punctuation">&quot;</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>int<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>_databaseId == &#39;oracle&#39;<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
			select count(1) from sys_user where user_name = #{userName} and rownum <span class="token cdata">&lt;![CDATA[ &lt;= ]]&gt;</span> 1
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>_databaseId == &#39;postgresql&#39;<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
			select count(1) from sys_user where user_name = #{userName} limit 1
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>_databaseId == &#39;mysql&#39;<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
			select count(1) from sys_user where user_name = #{userName} limit 1
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-3-null\u503C\u8F6C\u6362\u4E3A\u4E00\u4E2A\u5B9E\u9645\u7684\u503C" tabindex="-1"><a class="header-anchor" href="#_4-3-null\u503C\u8F6C\u6362\u4E3A\u4E00\u4E2A\u5B9E\u9645\u7684\u503C" aria-hidden="true">#</a> 4.3 null\u503C\u8F6C\u6362\u4E3A\u4E00\u4E2A\u5B9E\u9645\u7684\u503C</h3><ul><li>mysql: \u4F7F\u7528ifnull \u51FD\u6570</li><li>oracle\uFF1A \u4F7F\u7528nvl \u51FD\u6570</li><li>postgresql\uFF1A\u4F7F\u7528COALESCE \u51FD\u6570</li></ul><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>_databaseId == &#39;oracle&#39;<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
			select distinct m.menu_id,  nvl(m.perms,&#39;&#39;) as perms
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>_databaseId == &#39;postgresql&#39;<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
			select distinct m.menu_id, COALESCE(m.perms,&#39;&#39;) as perms
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>_databaseId == &#39;mysql&#39;<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
			select distinct m.menu_id, ifnull(m.perms,&#39;&#39;) as perms
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-4-\u6279\u91CF\u66F4\u65B0\u8BED\u6CD5" tabindex="-1"><a class="header-anchor" href="#_4-4-\u6279\u91CF\u66F4\u65B0\u8BED\u6CD5" aria-hidden="true">#</a> 4.4 \u6279\u91CF\u66F4\u65B0\u8BED\u6CD5</h3><ul><li>mysql: \u4E00\u4E2A insert into \u63D2\u5165values\u7684\u503C\u53EF\u4EE5\u4E3A\u591A\u4E2A\uFF0C\u9017\u53F7\u5206\u9694</li><li>oracle\uFF1Ainsert all \u63D2\u5165\u591A\u4E2A into table\uFF0C\u6700\u540E SELECT 1 FROM DUAL</li></ul><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>insert</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>batchUserRole<span class="token punctuation">&quot;</span></span> <span class="token attr-name">useGeneratedKeys</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>_databaseId == &#39;oracle&#39;<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
			insert all
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>foreach</span> <span class="token attr-name">item</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item<span class="token punctuation">&quot;</span></span> <span class="token attr-name">index</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>index<span class="token punctuation">&quot;</span></span> <span class="token attr-name">collection</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>list<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
				into sys_user_role(user_id, role_id) values (#{item.userId},#{item.roleId})
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>foreach</span><span class="token punctuation">&gt;</span></span>
			SELECT 1 FROM DUAL
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>_databaseId == &#39;mysql&#39;<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
			insert into sys_user_role(user_id, role_id) values
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>foreach</span> <span class="token attr-name">item</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item<span class="token punctuation">&quot;</span></span> <span class="token attr-name">index</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>index<span class="token punctuation">&quot;</span></span> <span class="token attr-name">collection</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>list<span class="token punctuation">&quot;</span></span> <span class="token attr-name">separator</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>,<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
				(#{item.userId},#{item.roleId})
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>foreach</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>insert</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-5-\u83B7\u53D6\u5F53\u524D\u65F6\u95F4" tabindex="-1"><a class="header-anchor" href="#_4-5-\u83B7\u53D6\u5F53\u524D\u65F6\u95F4" aria-hidden="true">#</a> 4.5 \u83B7\u53D6\u5F53\u524D\u65F6\u95F4</h3><p>\u5F15\u5165\u5916\u90E8\u51FD\u6570</p><ul><li>mysql \u7684\u65E5\u671F\uFF1Anow()</li><li>oracle\u7684\u5F53\u524D\u65F6\u95F4\uFF1Asysdate</li></ul><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code> update sys_config
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>set</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>configName != null and configName != &#39;&#39;<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>config_name = #{configName},<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">&gt;</span></span>
            update_time = \${@com.faduit.common.utils.DBUtils@getCurrentTime()}
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>set</span><span class="token punctuation">&gt;</span></span>
        where config_id = #{configId}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,49),o=[p];function c(l,i){return s(),a("div",null,o)}const d=n(e,[["render",c],["__file","mybatis-z-adapter-db.html.vue"]]);export{d as default};
