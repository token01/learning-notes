import{_ as a}from"./_plugin-vue_export-helper.cdc0426e.js";import{o as t,c as p,a as n,b as e,d as o,f as c,r as i}from"./app.a0a3f66a.js";const l={},u=c(`<h1 id="sharding-jdbc\u5B9E\u73B0\u5206\u5E93\u5206\u8868\u5B9E\u6218" tabindex="-1"><a class="header-anchor" href="#sharding-jdbc\u5B9E\u73B0\u5206\u5E93\u5206\u8868\u5B9E\u6218" aria-hidden="true">#</a> sharding-jdbc\u5B9E\u73B0\u5206\u5E93\u5206\u8868\u5B9E\u6218</h1><h2 id="_1-\u7B80\u4ECB" tabindex="-1"><a class="header-anchor" href="#_1-\u7B80\u4ECB" aria-hidden="true">#</a> 1. \u7B80\u4ECB</h2><p><code>sharding-jdbc</code>\u662F\u7531\u5F53\u5F53\u6350\u5165\u7ED9<code>apache</code>\u7684\u4E00\u6B3E\u5206\u5E03\u5F0F\u6570\u636E\u5E93\u4E2D\u95F4\u4EF6\uFF0C\u652F\u6301\u5782\u76F4\u5206\u5E93\u3001\u5782\u76F4\u5206\u8868\u3001\u6C34\u5E73\u5206\u5E93\u3001\u6C34\u5E73\u5206\u8868\u3001\u8BFB\u5199\u5206\u79BB\u3001\u5206\u5E03\u5F0F\u4E8B\u52A1\u548C\u9AD8\u53EF\u7528\u7B49\u76F8\u5173\u529F\u80FD\u3002</p><h2 id="_2-\u5B9E\u73B01-\u73AF\u5883\u642D\u5EFA" tabindex="-1"><a class="header-anchor" href="#_2-\u5B9E\u73B01-\u73AF\u5883\u642D\u5EFA" aria-hidden="true">#</a> 2. \u5B9E\u73B01\uFF08\u73AF\u5883\u642D\u5EFA\uFF09</h2><h3 id="_2-1-\u6DFB\u52A0\u4F9D\u8D56" tabindex="-1"><a class="header-anchor" href="#_2-1-\u6DFB\u52A0\u4F9D\u8D56" aria-hidden="true">#</a> 2.1 \u6DFB\u52A0\u4F9D\u8D56</h3><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!-- sharding-jdbc\u5206\u5E93\u5206\u8868 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.shardingsphere<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>sharding-jdbc-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>4.1.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-2-\u521B\u5EFA\u4E24\u4E2A\u6D4B\u8BD5\u6570\u636E\u5E93" tabindex="-1"><a class="header-anchor" href="#_2-2-\u521B\u5EFA\u4E24\u4E2A\u6D4B\u8BD5\u6570\u636E\u5E93" aria-hidden="true">#</a> 2.2 \u521B\u5EFA\u4E24\u4E2A\u6D4B\u8BD5\u6570\u636E\u5E93</h3><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">database</span> <span class="token identifier"><span class="token punctuation">\`</span>ry-order1<span class="token punctuation">\`</span></span><span class="token punctuation">;</span>
<span class="token keyword">create</span> <span class="token keyword">database</span> <span class="token identifier"><span class="token punctuation">\`</span>ry-order2<span class="token punctuation">\`</span></span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-3-\u521B\u5EFA\u4E24\u4E2A\u6D4B\u8BD5\u8BA2\u5355\u8868" tabindex="-1"><a class="header-anchor" href="#_2-3-\u521B\u5EFA\u4E24\u4E2A\u6D4B\u8BD5\u8BA2\u5355\u8868" aria-hidden="true">#</a> 2.3 \u521B\u5EFA\u4E24\u4E2A\u6D4B\u8BD5\u8BA2\u5355\u8868</h3><p>\u5728 ry-order1 \u548C ry-order2 \u5404\u5EFA\u4E24\u5F20\u6D4B\u8BD5\u8868</p><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- ----------------------------</span>
<span class="token comment">-- \u8BA2\u5355\u4FE1\u606F\u8868sys_order_0</span>
<span class="token comment">-- ----------------------------</span>
<span class="token keyword">drop</span> <span class="token keyword">table</span> <span class="token keyword">if</span> <span class="token keyword">exists</span> sys_order_0<span class="token punctuation">;</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> sys_order_0
<span class="token punctuation">(</span>
  order_id      <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>      <span class="token operator">not</span> <span class="token boolean">null</span>                   <span class="token keyword">comment</span> <span class="token string">&#39;\u8BA2\u5355ID&#39;</span><span class="token punctuation">,</span>
  user_id       <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span>      <span class="token operator">not</span> <span class="token boolean">null</span>                   <span class="token keyword">comment</span> <span class="token string">&#39;\u7528\u6237\u7F16\u53F7&#39;</span><span class="token punctuation">,</span>
  <span class="token keyword">status</span>        <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>         <span class="token operator">not</span> <span class="token boolean">null</span>                   <span class="token keyword">comment</span> <span class="token string">&#39;\u72B6\u6001\uFF080\u4EA4\u6613\u6210\u529F 1\u4EA4\u6613\u5931\u8D25\uFF09&#39;</span><span class="token punctuation">,</span>
  order_no      <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span>     <span class="token keyword">default</span> <span class="token boolean">null</span>               <span class="token keyword">comment</span> <span class="token string">&#39;\u8BA2\u5355\u6D41\u6C34&#39;</span><span class="token punctuation">,</span>
  <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token punctuation">(</span>order_id<span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">engine</span><span class="token operator">=</span><span class="token keyword">innodb</span> <span class="token keyword">comment</span> <span class="token operator">=</span> <span class="token string">&#39;\u8BA2\u5355\u4FE1\u606F\u8868&#39;</span><span class="token punctuation">;</span>

<span class="token comment">-- ----------------------------</span>
<span class="token comment">-- \u8BA2\u5355\u4FE1\u606F\u8868sys_order_1</span>
<span class="token comment">-- ----------------------------</span>
<span class="token keyword">drop</span> <span class="token keyword">table</span> <span class="token keyword">if</span> <span class="token keyword">exists</span> sys_order_1<span class="token punctuation">;</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> sys_order_1
<span class="token punctuation">(</span>
  order_id      <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>      <span class="token operator">not</span> <span class="token boolean">null</span>                   <span class="token keyword">comment</span> <span class="token string">&#39;\u8BA2\u5355ID&#39;</span><span class="token punctuation">,</span>
  user_id       <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span>      <span class="token operator">not</span> <span class="token boolean">null</span>                   <span class="token keyword">comment</span> <span class="token string">&#39;\u7528\u6237\u7F16\u53F7&#39;</span><span class="token punctuation">,</span>
  <span class="token keyword">status</span>        <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>         <span class="token operator">not</span> <span class="token boolean">null</span>                   <span class="token keyword">comment</span> <span class="token string">&#39;\u72B6\u6001\uFF080\u4EA4\u6613\u6210\u529F 1\u4EA4\u6613\u5931\u8D25\uFF09&#39;</span><span class="token punctuation">,</span>
  order_no      <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span>     <span class="token keyword">default</span> <span class="token boolean">null</span>               <span class="token keyword">comment</span> <span class="token string">&#39;\u8BA2\u5355\u6D41\u6C34&#39;</span><span class="token punctuation">,</span>
  <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token punctuation">(</span>order_id<span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">engine</span><span class="token operator">=</span><span class="token keyword">innodb</span> <span class="token keyword">comment</span> <span class="token operator">=</span> <span class="token string">&#39;\u8BA2\u5355\u4FE1\u606F\u8868&#39;</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-4-\u4FEE\u6539\u914D\u7F6E\u6587\u4EF6" tabindex="-1"><a class="header-anchor" href="#_2-4-\u4FEE\u6539\u914D\u7F6E\u6587\u4EF6" aria-hidden="true">#</a> 2.4 \u4FEE\u6539\u914D\u7F6E\u6587\u4EF6</h3><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment"># \u6570\u636E\u6E90\u914D\u7F6E</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
    <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
        <span class="token key atrule">type</span><span class="token punctuation">:</span> com.alibaba.druid.pool.DruidDataSource
        <span class="token key atrule">driverClassName</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver
        <span class="token key atrule">druid</span><span class="token punctuation">:</span>
            <span class="token comment"># \u4E3B\u5E93\u6570\u636E\u6E90</span>
            <span class="token key atrule">master</span><span class="token punctuation">:</span>
                <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/ry<span class="token punctuation">?</span>useUnicode=true<span class="token important">&amp;characterEncoding=utf8&amp;zeroDateTimeBehavior=convertToNull&amp;useSSL=true&amp;serverTimezone=GMT%2B8</span>
                <span class="token key atrule">username</span><span class="token punctuation">:</span> root
                <span class="token key atrule">password</span><span class="token punctuation">:</span> password
            <span class="token comment"># \u8BA2\u5355\u5E931</span>
            <span class="token key atrule">order1</span><span class="token punctuation">:</span>
                <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
                <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/ry<span class="token punctuation">-</span>order1<span class="token punctuation">?</span>useUnicode=true<span class="token important">&amp;characterEncoding=utf8&amp;zeroDateTimeBehavior=convertToNull&amp;useSSL=true&amp;serverTimezone=GMT%2B8</span>
                <span class="token key atrule">username</span><span class="token punctuation">:</span> root
                <span class="token key atrule">password</span><span class="token punctuation">:</span> password
            <span class="token comment"># \u8BA2\u5355\u5E932</span>
            <span class="token key atrule">order2</span><span class="token punctuation">:</span>
                <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
                <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/ry<span class="token punctuation">-</span>order2<span class="token punctuation">?</span>useUnicode=true<span class="token important">&amp;characterEncoding=utf8&amp;zeroDateTimeBehavior=convertToNull&amp;useSSL=true&amp;serverTimezone=GMT%2B8</span>
                <span class="token key atrule">username</span><span class="token punctuation">:</span> root
                <span class="token key atrule">password</span><span class="token punctuation">:</span> password
            <span class="token punctuation">...</span><span class="token punctuation">...</span><span class="token punctuation">...</span><span class="token punctuation">...</span><span class="token punctuation">...</span><span class="token punctuation">...</span>.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3-\u5B9E\u73B02-\u96C6\u6210" tabindex="-1"><a class="header-anchor" href="#_3-\u5B9E\u73B02-\u96C6\u6210" aria-hidden="true">#</a> 3. \u5B9E\u73B02\uFF08\u96C6\u6210\uFF09</h2><h3 id="_3-1-sharding-\u914D\u7F6E\u4FE1\u606F" tabindex="-1"><a class="header-anchor" href="#_3-1-sharding-\u914D\u7F6E\u4FE1\u606F" aria-hidden="true">#</a> 3.1 sharding \u914D\u7F6E\u4FE1\u606F</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ruoyi<span class="token punctuation">.</span>framework<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span><span class="token class-name">SQLException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">HashMap</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Map</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Properties</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span><span class="token class-name">DataSource</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>shardingsphere<span class="token punctuation">.</span>api<span class="token punctuation">.</span>config<span class="token punctuation">.</span>sharding<span class="token punctuation">.</span></span><span class="token class-name">KeyGeneratorConfiguration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>shardingsphere<span class="token punctuation">.</span>api<span class="token punctuation">.</span>config<span class="token punctuation">.</span>sharding<span class="token punctuation">.</span></span><span class="token class-name">ShardingRuleConfiguration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>shardingsphere<span class="token punctuation">.</span>api<span class="token punctuation">.</span>config<span class="token punctuation">.</span>sharding<span class="token punctuation">.</span></span><span class="token class-name">TableRuleConfiguration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>shardingsphere<span class="token punctuation">.</span>api<span class="token punctuation">.</span>config<span class="token punctuation">.</span>sharding<span class="token punctuation">.</span>strategy<span class="token punctuation">.</span></span><span class="token class-name">InlineShardingStrategyConfiguration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>shardingsphere<span class="token punctuation">.</span>shardingjdbc<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">ShardingDataSourceFactory</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Qualifier</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>condition<span class="token punctuation">.</span></span><span class="token class-name">ConditionalOnProperty</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>context<span class="token punctuation">.</span>properties<span class="token punctuation">.</span></span><span class="token class-name">ConfigurationProperties</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>druid<span class="token punctuation">.</span>pool<span class="token punctuation">.</span></span><span class="token class-name">DruidDataSource</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>druid<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span></span><span class="token class-name">DruidDataSourceBuilder</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>ruoyi<span class="token punctuation">.</span>framework<span class="token punctuation">.</span>config<span class="token punctuation">.</span>properties<span class="token punctuation">.</span></span><span class="token class-name">DruidProperties</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * sharding \u914D\u7F6E\u4FE1\u606F
 * 
 * <span class="token keyword">@author</span> ruoyi
 */</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ShardingDataSourceConfig</span>
<span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span><span class="token string">&quot;spring.datasource.druid.order1&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ConditionalOnProperty</span><span class="token punctuation">(</span>prefix <span class="token operator">=</span> <span class="token string">&quot;spring.datasource.druid.order1&quot;</span><span class="token punctuation">,</span> name <span class="token operator">=</span> <span class="token string">&quot;enabled&quot;</span><span class="token punctuation">,</span> havingValue <span class="token operator">=</span> <span class="token string">&quot;true&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">DataSource</span> <span class="token function">order1DataSource</span><span class="token punctuation">(</span><span class="token class-name">DruidProperties</span> druidProperties<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">DruidDataSource</span> dataSource <span class="token operator">=</span> <span class="token class-name">DruidDataSourceBuilder</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> druidProperties<span class="token punctuation">.</span><span class="token function">dataSource</span><span class="token punctuation">(</span>dataSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span><span class="token string">&quot;spring.datasource.druid.order2&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ConditionalOnProperty</span><span class="token punctuation">(</span>prefix <span class="token operator">=</span> <span class="token string">&quot;spring.datasource.druid.order2&quot;</span><span class="token punctuation">,</span> name <span class="token operator">=</span> <span class="token string">&quot;enabled&quot;</span><span class="token punctuation">,</span> havingValue <span class="token operator">=</span> <span class="token string">&quot;true&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">DataSource</span> <span class="token function">order2DataSource</span><span class="token punctuation">(</span><span class="token class-name">DruidProperties</span> druidProperties<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">DruidDataSource</span> dataSource <span class="token operator">=</span> <span class="token class-name">DruidDataSourceBuilder</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> druidProperties<span class="token punctuation">.</span><span class="token function">dataSource</span><span class="token punctuation">(</span>dataSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;shardingDataSource&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">DataSource</span> <span class="token function">shardingDataSource</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">&quot;order1DataSource&quot;</span><span class="token punctuation">)</span> <span class="token class-name">DataSource</span> order1DataSource<span class="token punctuation">,</span> <span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">&quot;order2DataSource&quot;</span><span class="token punctuation">)</span> <span class="token class-name">DataSource</span> order2DataSource<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">DataSource</span><span class="token punctuation">&gt;</span></span> dataSourceMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        dataSourceMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;order1&quot;</span><span class="token punctuation">,</span> order1DataSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
        dataSourceMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;order2&quot;</span><span class="token punctuation">,</span> order2DataSource<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// sys_order \u8868\u89C4\u5219\u914D\u7F6E</span>
        <span class="token class-name">TableRuleConfiguration</span> orderTableRuleConfig <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TableRuleConfiguration</span><span class="token punctuation">(</span><span class="token string">&quot;sys_order&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;order$-&gt;{1..2}.sys_order_$-&gt;{0..1}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u914D\u7F6E\u5206\u5E93\u7B56\u7565 </span>
        orderTableRuleConfig<span class="token punctuation">.</span><span class="token function">setDatabaseShardingStrategyConfig</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InlineShardingStrategyConfiguration</span><span class="token punctuation">(</span><span class="token string">&quot;user_id&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;order$-&gt;{user_id % 2 + 1}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u914D\u7F6E\u5206\u8868\u7B56\u7565</span>
        orderTableRuleConfig<span class="token punctuation">.</span><span class="token function">setTableShardingStrategyConfig</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InlineShardingStrategyConfiguration</span><span class="token punctuation">(</span><span class="token string">&quot;order_id&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;sys_order_$-&gt;{order_id % 2}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u5206\u5E03\u5F0F\u4E3B\u952E</span>
        orderTableRuleConfig<span class="token punctuation">.</span><span class="token function">setKeyGeneratorConfig</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">KeyGeneratorConfiguration</span><span class="token punctuation">(</span><span class="token string">&quot;SNOWFLAKE&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;order_id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// \u914D\u7F6E\u5206\u7247\u89C4\u5219</span>
        <span class="token class-name">ShardingRuleConfiguration</span> shardingRuleConfig <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ShardingRuleConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        shardingRuleConfig<span class="token punctuation">.</span><span class="token function">getTableRuleConfigs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>orderTableRuleConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u83B7\u53D6\u6570\u636E\u6E90\u5BF9\u8C61</span>
        <span class="token class-name">DataSource</span> dataSource <span class="token operator">=</span> <span class="token class-name">ShardingDataSourceFactory</span><span class="token punctuation">.</span><span class="token function">createDataSource</span><span class="token punctuation">(</span>dataSourceMap<span class="token punctuation">,</span> shardingRuleConfig<span class="token punctuation">,</span> <span class="token function">getProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> dataSource<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * \u7CFB\u7EDF\u53C2\u6570\u914D\u7F6E
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">Properties</span> <span class="token function">getProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">Properties</span> shardingProperties <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        shardingProperties<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;sql.show&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> shardingProperties<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6CE8\u610F\u8FD9\u91CC\u914D\u7F6E\u7684\u5206\u5E93\u5206\u8868\u89C4\u5219</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// sys_order \u8868\u89C4\u5219\u914D\u7F6E</span>
        <span class="token class-name">TableRuleConfiguration</span> orderTableRuleConfig <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TableRuleConfiguration</span><span class="token punctuation">(</span><span class="token string">&quot;sys_order&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;order$-&gt;{1..2}.sys_order_$-&gt;{0..1}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u914D\u7F6E\u5206\u5E93\u7B56\u7565 </span>
        orderTableRuleConfig<span class="token punctuation">.</span><span class="token function">setDatabaseShardingStrategyConfig</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InlineShardingStrategyConfiguration</span><span class="token punctuation">(</span><span class="token string">&quot;user_id&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;order$-&gt;{user_id % 2 + 1}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u914D\u7F6E\u5206\u8868\u7B56\u7565</span>
        orderTableRuleConfig<span class="token punctuation">.</span><span class="token function">setTableShardingStrategyConfig</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InlineShardingStrategyConfiguration</span><span class="token punctuation">(</span><span class="token string">&quot;order_id&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;sys_order_$-&gt;{order_id % 2}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_4-6\u3001\u6D4B\u8BD5\u9A8C\u8BC1" tabindex="-1"><a class="header-anchor" href="#_4-6\u3001\u6D4B\u8BD5\u9A8C\u8BC1" aria-hidden="true">#</a> 4. 6\u3001\u6D4B\u8BD5\u9A8C\u8BC1</h2><p>\u8BBF\u95EE<code>http://localhost/order/add/1</code>\u5165\u5E93\u5230<code>ry-order2</code></p><p>\u8BBF\u95EE<code>http://localhost/order/add/2</code>\u5165\u5E93\u5230<code>ry-order1</code></p><p>\u540C\u65F6\u6839\u636E\u8BA2\u5355\u53F7<code>order_id % 2</code>\u5165\u5E93\u5230<code>sys_order_0</code>\u6216\u8005<code>sys_order_1</code></p><h2 id="\u53C2\u8003\u6587\u7AE0" tabindex="-1"><a class="header-anchor" href="#\u53C2\u8003\u6587\u7AE0" aria-hidden="true">#</a> \u53C2\u8003\u6587\u7AE0</h2>`,23),r={href:"http://doc.ruoyi.vip/ruoyi/document/cjjc.html#%E9%9B%86%E6%88%90sharding-jdbc%E5%AE%9E%E7%8E%B0%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8",target:"_blank",rel:"noopener noreferrer"};function k(d,m){const s=i("ExternalLinkIcon");return t(),p("div",null,[u,n("p",null,[n("a",r,[e("\u96C6\u6210sharding-jdbc\u5B9E\u73B0\u5206\u5E93\u5206\u8868"),o(s)])])])}const g=a(l,[["render",k],["__file","sharding-jdbc-x-sub-database-sub-table.html.vue"]]);export{g as default};
